'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[8],{1532:function(D,I,c){c.r(I);c.d(I,"RtcUtils",function(){return k});D=c(0);var l=c(7),e=c(1562),a=c(34);class k{static E7e(x,y=e.RealtimeChannel.jPf){let m;try{m=a.c(x)}catch(t){throw x=String.format("Failed to JSON-serialize payload : {0}",t),l.ULS.sendTraceTag(18637072,500,10,x),Error.argument("payload",x);}if(m.length>y)throw x=String.format("Payload exceeds maximum length: {0} > {1}.",m.length,y),l.ULS.sendTraceTag(18637074,
500,10,x),Error.argument("payload",x);return m}static deserialize(x,y,m){if(!x)return null;if(Object.getType(x)!==String){var t=String.format("Failed to deserialize [{0}] - object is not of type [String] and is instead of type [{1}]. ExtraInfo: [{2}].",y,Object.getType(x).getName(),m);l.ULS.sendTraceTag(18637075,500,10,t);return null}t=null;try{t=a.a(x)}catch(z){x=String.format("Failed to deserialize [{0}]. Exception deserializing the object : [{1}]. ExtraInfo: [{2}].",y,z,m),l.ULS.sendTraceTag(18637077,
500,10,x)}return t}static Bgc(x){if(!x)return"";if("string"===typeof x)return x.toString();try{return a.c(x)}catch(y){return x.toString()}}static DAl(x){let y,m,t;y=0;t=m=null;if(!x)return{Lpi:y,Npi:m,exception:t};try{const z=x.source;z&&Object.getType(z)===String&&(t=z);const v=x.context;v&&(x=v,y=x.status?x.status:0,m=x.statusText?x.statusText:null)}catch(z){}return{Lpi:y,Npi:m,exception:t}}}Object(D.a)(k,"RtcUtils",null,[])},1552:function(D,I,c){c.r(I);D=c(0);var l=c(7),e=c(54),a=c(85),k;(function(t){t[t.SendNotification=
0]="SendNotification";t[t.SendPersistentState=1]="SendPersistentState";t[t.FindSession=2]="FindSession";t[t.Last=3]="Last"})(k||(k={}));Object(D.b)("ApiType",k);var x;(function(t){t[t.AttemptCount=0]="AttemptCount";t[t.SuccessCount=1]="SuccessCount";t[t.DropCount=2]="DropCount";t[t.FailedCount=3]="FailedCount";t[t.LatencyOverThresholdCount=4]="LatencyOverThresholdCount";t[t.LatencyUnderThresholdCount=5]="LatencyUnderThresholdCount";t[t.ThrottledCount=6]="ThrottledCount";t[t.Last=7]="Last"})(x||(x=
{}));Object(D.b)("EventCountType",x);var y=c(1653);c.d(I,"FrequentLoggingMetrics",function(){return m});class m{constructor(t){this.sIh=this.C0h=null;this.cOi=this.x3h=0;this.eu=null;this.r6g=this.lKe=0;this.$f=t;this.EBm();this.$Ae=this.TVg=this.VKe=!1;this.Ryc=0}get Wzl(){return this.$Ae}RCo(t){this.r6g=t;window.setInterval(Object(e.a)(this,this.wNf,"logMetricsBatchAndReset"),t);this.lKe=(new Date).getTime()}tP(t,z){this.yro(t)&&!this.TVg||this.Wzl||!window.navigator.onLine||this.$f.yRa||(this.eu[t][z]++,
this.VKe=!0)}EBm(){this.eu=Array(3);for(let t=0;3>t;t++){this.eu[t]=Array(7);for(let z=0;7>z;z++)this.eu[t][z]=0}}oOk(){const t={};for(let z=0;3>z;z++)for(let v=0;7>v;v++)this.uXm(z,v)&&(t[k[z]+x[v]]=this.eu[z][v]);t.FSDomain=this.C0h;t.ConnectionDomain=this.sIh;t.FSRetryInterval=this.x3h;t.MaxPayloadSize=this.cOi;t.LogNumber=this.Ryc;1===this.Ryc&&(t.FSLatencies=y.a.instance.mYl(),t.ConLatencies=y.a.instance.OSl());return t}uXm(t,z){return 2===t&&3!==z&&0!==z?!1:!0}yro(t){return 2===t?!1:!0}wNf(){if(this.VKe){this.Ryc++;
if((new Date).getTime()-this.lKe<5E3+this.r6g){var t=a.a.toJSON(this.oOk());l.ULS.sendTraceTag(50644352,500,15,t)}this.lKe=(new Date).getTime();for(t=0;3>t;t++)for(let z=0;7>z;z++)this.eu[t][z]=0;this.VKe=!1}}W$m(){this.TVg=!0}static get instance(){return m._instance}static create(t){m.instance||(m._instance=new m(t));return m.instance}}m._instance=null;Object(D.a)(m,"FrequentLoggingMetrics",null,[880])},1562:function(D,I,c){c.r(I);D=c(0);var l=c(7),e=c(54),a=c(462),k=c(888),x=c(83),y=c(2);class m{constructor(xa,
fa){this.status=xa;this.Rec=fa}}Object(D.a)(m,"UserStatusInfo",null,[]);var t=c(45),z=c(1653);class v{constructor(xa,fa){this.data=xa;this.timeStamp=fa}}Object(D.a)(v,"PresenceData",null,[]);class H{constructor(xa){this.JCa=!1;this.Rzb=0;this.Ywe=!1;this.setTimeout=H.bef;this.clearTimeout=H.Vdf;this.t8m=Object(e.a)(this,this.x7m,"logRtcConnectingUsageStatement");this.dw=xa}Umn(){this.JCa||(this.Rzb=this.setTimeout(()=>{this.JCa=!1;this.uLi()},8E3),this.JCa=!0,this.Ywe=!1)}Onn(){this.V_()}Wun(){this.uLi()}uLi(){this.V_();
this.Ywe||(this.Ywe=!0,this.t8m())}x7m(){l.ULS.sendTraceTag(4539720,500,50,"Usage statement for the Rtc_ConnectedEver KPI for [{0}]",this.dw)}V_(){this.JCa&&this.clearTimeout(this.Rzb);this.Rzb=0;this.JCa=!1}static bef(xa,fa){return window.setTimeout(xa,fa)}static Vdf(xa){window.clearTimeout(xa)}}Object(D.a)(H,"ConnectedUsageKpiLogger",null,[903]);class F{constructor(){this.i8i=this.f6f;this.l8i=this.i6f;this.k8i=this.h6f;this.p8i=this.k6f;this.o8i=this.j6f;this.v6f=this.w6f;this.e6c=this.t6f;this.IOb=
this.r6f;this.JOb=this.s6f;this.j8i=this.g6f;this.T5a=this.iTf;this.VLb=this.jTf}f6f(){}i6f(){}h6f(){}k6f(){}j6f(){}t6f(){}s6f(){}r6f(){}w6f(){}g6f(){}iTf(){}jTf(){}}Object(D.a)(F,"NoopRealtimeChannelMetrics",null,[891,238]);class G{}G.Edd="presenceUpdated";G.updateNotification="updateNotification";G.l2i="persistentStateCleared";G.updatePersistentState="persistentStateUpdated";Object(D.a)(G,"RtcClientMethodNames",null,[]);class M{}M.owm="realtimeChannelHub";M.Edd="UpdatePresence";M.qN="SendUpdateNotification";
M.jpf="GetCompletePersistentStateWithMetadata";M.updatePersistentState="UpdatePersistentState";M.Prb="UpdateClientInfo";Object(D.a)(M,"RtcHubMethodNames",null,[]);class K{constructor(xa){this.hw=xa}EXn(xa){this.hw.on(G.Edd,xa)}zYn(xa){this.hw.on(G.updateNotification,xa)}DXn(xa){this.hw.on(G.updatePersistentState,xa)}CXn(xa){this.hw.on(G.l2i,xa)}YSo(xa){this.hw.off(G.Edd,xa)}hTo(xa){this.hw.off(G.updateNotification,xa)}XSo(xa){this.hw.off(G.updatePersistentState,xa)}WSo(xa){this.hw.off(G.l2i,xa)}Edd(xa){return this.hw.invoke(M.Edd,
xa)}Prb(xa){return this.hw.invoke(M.Prb,xa)}qN(xa,fa){return this.hw.invoke(M.qN,xa,fa)}jpf(xa){return this.hw.invoke(M.jpf,xa)}updatePersistentState(xa,fa){return this.hw.invoke(M.updatePersistentState,xa,fa)}}Object(D.a)(K,"RealtimeChannelProxy",null,[896,897,898]);class L{constructor(){this.wue=this.IMg=!1;this.uue=0;this.nwe=this.VSe=this.USe=this.vte=!1;this.BBe=0;this.Ceh=!1;this.Beh=this.Aeh=0;this.nRe=!1;this.uRe=this.sRe=this.wRe=this.oRe=0;this.tRe=!1}get wJk(){return this.wue}get vJk(){return this.uue}get UBk(){return this.vte}get dto(){return this.USe}get eto(){return this.VSe}get RZk(){return this.nwe}get MOd(){return this.BBe}get i$n(){return this.Ceh}get wgj(){return this.Aeh}get h$n(){return this.Beh}get d$n(){return this.nRe}get e$n(){return this.oRe}get Cgj(){return this.wRe}get xgj(){return this.sRe}get zgj(){return this.uRe}get ygj(){return this.tRe}static createInstance(xa){const {RealtimeChannel:fa}=
c(1562);return xa?Object.assign(new L,{IMg:xa.$("AwayStatusManagerIsEnabled"),wue:xa.$("AwayStatusOneMinuteTimeoutIsEnabled"),uue:xa.mc("AwayCoauthorThresholdMs",9E5),vte:xa.$("RtcAllowCrossDomainAccessEnabled"),USe:xa.$("ShouldLogOnContentNotification"),VSe:xa.$("ShouldLogOnHostSubscriptionNotification"),nwe:xa.$("RtcClientMetricsEnabled"),BBe:xa.mc("RtcFindSessionRequestTimeoutInMS",6E4),Ceh:xa.$("RtcJsClientFrequentlyLogsMetrics"),Aeh:xa.mc("RtcJsClientFrequentMetricsLatencyThresholdInMS",1E3),
Beh:xa.mc("RtcJsClientFrequentMetricsLogIntervalInMS",3E5),nRe:xa.$("RtcClientMessageTelemetryEnabled"),oRe:xa.mc("RtcClientMessageTelemetrySampleSize",5),wRe:xa.mc("RtcSendTelemetryMessageIntervalInMS",3E5),sRe:xa.mc("RtcLogClientMessageMetricsTimeOutInMs",2E4),uRe:xa.mc("RtcMaxPayloadSizeInCharactersOverride",fa.jPf),tRe:xa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.RTCLogSignalrHeartBeatMessages",!1)}):Object.assign(new L,{IMg:!1,wue:!1,uue:9E5,vte:!1,USe:!1,VSe:!0,nwe:!1,BBe:9E4,nRe:!1,
oRe:5,wRe:3E5,sRe:2E4,uRe:fa.jPf,tRe:!1})}}Object(D.a)(L,"RealtimeChannelSettings",null,[895]);var R=c(1787),S=c(69),N=c(152);class O{constructor(xa){this.oEc=null;this.dUa=0;this.KEb=!1;this.zm=xa;this.zm.Iua(Object(e.a)(this,this.aja,"onConnectionStateChanged"))}aja(xa,fa){this.dUa=fa.newState}Cvn(){l.ULS.sendTraceTag(18637070,500,15,"Too many undelivered messages. Restarting RTC connection.");this.zm.Kce()}$zm(xa){this.oEc.init(xa)}}Object(D.a)(O,"ARtcMessageHandler",null,[]);var W=c(357);class V{constructor(){this.Presence=
null;this.TimeStamp=0}}Object(D.a)(V,"PresenceDataEntryForClients",null,[]);var Q=c(85);class Y{constructor(xa,fa=""){this.Kik=xa;this.yta=fa}send(){return this.Kik()}get messageId(){return this.yta}}Object(D.a)(Y,"MessageHandler",null,[908]);var ba=c(1680);class Z extends Sys.EventArgs{constructor(xa,fa,Ka,lb){super();this.G9f=xa;this.reconnectDelay=fa;this.reason=Ka;this.Zbg=lb}}Object(D.a)(Z,"RefreshConnectionReconnectArgs",Sys.EventArgs,[]);var ea=c(1738);class ha{constructor(){this.nUe=this.ki=
null}get oi(){return this.ki?this.nUe?this.nUe.getTime()-this.ki.getTime():(new Date).getTime()-this.ki.getTime():0}start(){this.ki=new Date}stop(){this.nUe=new Date}}Object(D.a)(ha,"SimpleStopwatch",null,[]);var ka=c(1739),ua;(function(xa){xa[xa.contentUpdate=0]="contentUpdate";xa[xa.editorsTableUpdate=1]="editorsTableUpdate";xa[xa.fileNameUpdate=2]="fileNameUpdate";xa[xa.wetContentUpdate=3]="wetContentUpdate";xa[xa.persistedContentUpdate=4]="persistedContentUpdate";xa[xa.clientRtcReconnectRequest=
5]="clientRtcReconnectRequest";xa[xa.replicationTelemetry=6]="replicationTelemetry";xa[xa.lockUpdate=7]="lockUpdate";xa[xa.collabServiceContentUpdate=8]="collabServiceContentUpdate";xa[xa.trackChangeSettingUpdate=9]="trackChangeSettingUpdate";xa[xa.saveTargetUpdate=10]="saveTargetUpdate";xa[xa.uploadToOcsUpdate=11]="uploadToOcsUpdate";xa[xa.labelUpdate=12]="labelUpdate";xa[xa.hostNotificationSubscriptionStatus=13]="hostNotificationSubscriptionStatus";xa[xa.subscribeOrExtend=14]="subscribeOrExtend";
xa[xa.elapsedBootTelemetry=15]="elapsedBootTelemetry";xa[xa.clientToClientTelemetryMessage=16]="clientToClientTelemetryMessage";xa[xa.clientToClientResponseMessage=17]="clientToClientResponseMessage";xa[xa.verifyNotificationPipeline=18]="verifyNotificationPipeline";xa[xa.hostNotificationHeartbeat=19]="hostNotificationHeartbeat";xa[xa.secondaryMetadataUpdate=20]="secondaryMetadataUpdate";xa[xa.last=21]="last"})(ua||(ua={}));Object(D.b)("UpdateNotificationType",ua);var sa=c(767),Da=c(604),Pa=c(605);
class Ra extends O{constructor(xa,fa,Ka,lb,Xa,kb,Bb,Ja,Ma,fb){super(Bb);this.hw=null;this.f6g=this.h6g=!1;this.yta=0;this.qOe=new N.a;this.r$j=Ra.pTl();this.yNe=y.AFrameworkApplication.K.kb("OwningFeatureCrewForRtcNotificationKpis");this.Wf=xa;this.Q8g=this.P8g=0;this.oEc=fa;this.oEc.sCd(Object(e.a)(this,this.Cvn,"onTooManyUndeliveredMessages"));this._clientId=Ka;this.mgk=Xa;this.zm.mzk(Object(e.a)(this,this.Vsn,"onRefreshProxyRequired"));this.zm.kzk(Object(e.a)(this,this.Tsn,"onRefreshAllPersistentStateRequest"));
this.zm.uzk(Object(e.a)(this,this.qN,"sendUpdateNotification"));this.zm.jxk(Object(e.a)(this,this.dqn,"onInternalPresenceUpdated"));this.zm.kxk(Object(e.a)(this,this.eqn,"onInternalUpdateNotificationReceived"));this.zm.ixk(Object(e.a)(this,this.cqn,"onInternalPersistentStateUpdated"));this.zm.hxk(Object(e.a)(this,this.bqn,"onInternalPersistentStateCleared"));this.zm.szk(Object(e.a)(this,this.Hkc,"sendPersistentState"));this.zm.Hzk(Object(e.a)(this,this.Prb,"updateClientInfo"));this.je=kb;this.dw=
lb;this.eu=Ja;this.uW=Ma;this.ozc=fb;this.Uea=Object(S.a)(String,y.AFrameworkApplication.sessionStartInfoSettings.Application)||""}Vsn(xa,fa){this.hw=this.mgk(fa.hubConnection);this.oEc.reset();this.hw.EXn(Object(e.a)(this,this.r5,"onPresenceUpdated"));this.hw.DXn(Object(e.a)(this,this.TSa,"onPersistentStateUpdated"));this.hw.CXn(Object(e.a)(this,this.Ygc,"onPersistentStateCleared"));this.hw.zYn(Object(e.a)(this,this.m1,"onUpdateNotificationReceived"))}aja(xa,fa){this.dUa=fa.newState;2===fa.newState&&
this.yeo()}yeo(){for(let xa of this.qOe)this.qN(null,new ea.a(xa.key,xa.value,!1,new a.a));this.qOe=new N.a}Tsn(xa,fa){fa.i8e();for(xa=0;3>xa;++xa)this.$do(xa,fa)}$do(xa,fa){try{this.hw.jpf(xa).done(Ka=>{fa.npc(fa.e$e,"GetCompletePresenceSuccess")&&(fa.A4k.Wun(),l.ULS.sendTraceTag(3249540,500,50,"Successfully retrieved complete session state for [{0}] of type [{1}]",this.dw,xa),this.zm.UOn(),this.csn(xa,Ka),this.zm.jOn(Ka),fa.hZh.nb(xa)&&this.zm.f7i(xa,fa.hZh.J(xa),new a.a))}).fail(Ka=>{const {RtcUtils:lb}=
c(1532);fa.npc(fa.e$e,"GetCompletePresenceFail")&&(l.ULS.sendTraceTag(3249541,500,15,"Failed to retrieve complete session state : {0} for [{1}] of type [{2}]",lb.Bgc(Ka),this.dw,xa),this.zm.Kce())}).always(()=>{fa.YA&&fa.YA.stop()})}catch(Ka){l.ULS.sendTraceTag(595132428,500,10,"Exception thrown while calling hub method GetCompletePersistentStateWithMetadata. Promise not even created. Current event token: {0}, Exception message: {1}",fa.e$e,Ka.message)}}Hkc(xa,fa){var {RtcUtils:Ka}=c(1532);xa=fa.presence;
let lb;const Xa=fa.L8a;this.uW.tP(1,0);try{lb=Ka.E7e(xa,this.ozc)}catch(Bb){this.uW.tP(1,3);l.ULS.sendTraceTag(574407636,500,10,"Exception thrown while trying to serialize presence. Exception message: {0}",Bb.message);Xa.setException(Bb);return}Ka=new x.a;Ka.Z(this._clientId,Object.assign(new V,{Presence:xa,TimeStamp:(new Date).getTime()}));this.zm.m7i(fa.type,Ka);if(2!==this.dUa)this.eu.IOb(),this.uW.tP(1,2),Xa.Dg(null);else{var kb=this.yta.toString();++this.yta;xa=new Y(()=>this.Aeo(fa.type,lb,
kb),kb);xa=this.xzj(0,fa.type).add(xa);xa.W7d(Bb=>{2===Bb&&this.uW.tP(1,6);Xa.Dg(null)});xa.V7d(()=>{})}}Aeo(xa,fa,Ka){let lb=null;const Xa=new ha,kb=new ba.a;l.ULS.sendTraceTag(3249501,500,50,"Sending presence update for [{0}] of type [{1}]",this.dw,xa);if(2!==this.dUa)return this.eu.IOb(),this.uW.tP(1,2),l.ULS.sendTraceTag(7934171,500,15,"Connection is lost - unable to send the message for [{0}] of type [{1}]",this.dw,xa),kb.VOf(),kb;this.je&&20>this.P8g&&(lb=this.je.Zf("WebServiceCall","Send Presence Message"),
this.P8g++);Xa.start();kb.d0c(1);try{this.hw.updatePersistentState(xa,fa).done(()=>{this.eu.e6c();this.uW.tP(1,1);l.ULS.sendTraceTag(3249502,500,50,"Successfully delivered presence update message [{0}] for [{1}] of type [{2}]",Ka,this.dw,xa);kb.Lmb(1);Xa&&(Xa.stop(),Xa.oi>this.Wf.wgj?this.uW.tP(1,4):this.uW.tP(1,5))}).fail(Bb=>{const {RtcUtils:Ja}=c(1532);this.KEb||(this.eu.IOb(),this.uW.tP(1,3),l.ULS.sendTraceTag(3249503,500,15,"Server failed to process the presence update message [{0}]: [{1}] for [{2}]",
Ka,Ja.Bgc(Bb),this.dw));kb.Lmb(2)}).always(()=>{lb&&lb.stop()})}catch(Bb){l.ULS.sendTraceTag(593072906,500,15,"Exception when invoking hub method UpdatePersistentState, error: {1}",Bb.message),this.uW.tP(1,3),kb.Lmb(2)}return kb}Prb(xa,fa){({RtcUtils:xa}=c(1532));const Ka=fa.QZk,lb=fa.L8a;let Xa;try{Xa=xa.E7e(Ka,this.ozc)}catch(kb){l.ULS.sendTraceTag(544318999,500,10,"Exception thrown while trying to serialize clientInfo. Exception message: {0}",kb.message);lb.setException(kb);return}try{this.hw.Prb(Xa).done(()=>
{l.ULS.sendTraceTag(544319E3,500,50,"Successfully delivered clientInfo.")}).fail(kb=>{const {RtcUtils:Bb}=c(1532);this.KEb||l.ULS.sendTraceTag(544319001,500,15,"Server failed to process udpate clientInfo: {0}.",Bb.Bgc(kb));lb.Dg(null)})}catch(kb){l.ULS.sendTraceTag(544319002,500,15,"Exception when invoking hub method UpdateClientInfo: error: {0}",kb.message),lb.Dg(null)}}qN(xa,fa){({RtcUtils:xa}=c(1532));const Ka=fa.type,lb=fa.NL,Xa=fa.Hll,kb=fa.L8a;let Bb;this.uW.tP(0,0);try{Bb=xa.E7e(lb,this.ozc)}catch(Ma){this.uW.tP(0,
3);l.ULS.sendTraceTag(574407637,500,10,"Exception thrown while trying to serialize updateHint. Exception message: {0}",Ma.message);kb.setException(Ma);return}if(2!==this.dUa)Xa?this.qOe.Z(Ka,lb):(this.eu.IOb(),this.uW.tP(0,2)),kb.Dg(null);else{var Ja=this.yta.toString();++this.yta;fa=new Y(()=>this.rfo(Ka,Bb,Ja),Ja);fa=this.xzj(1,Ka).add(fa);fa.W7d(Ma=>{2===Ma&&this.uW.tP(0,6);kb.Dg(null)});fa.V7d(()=>{})}}rfo(xa,fa,Ka){let lb=null;const Xa=new ha,kb=new ba.a;l.ULS.sendTraceTag(3249505,500,50,"Sending update notification for [{0}] of type [{1}]",
this.dw,xa);if(2!==this.dUa)return this.eu.IOb(),this.uW.tP(0,2),l.ULS.sendTraceTag(7934172,500,15,"Connection is lost - unable to send the message for [{0}]",this.dw),kb.VOf(),kb;this.je&&3===xa&&20>this.Q8g&&(lb=this.je.Zf("WebServiceCall","Send WetContent Update"),this.Q8g++);Xa.start();kb.d0c(1);this.hw.qN(xa,fa).done(()=>{this.eu.e6c();this.uW.tP(0,1);l.ULS.sendTraceTag(3249506,500,50,"Successfully delivered update notification message [{0}] for [{1}] of type [{2}]",Ka,this.dw,xa);kb.Lmb(1);
Xa&&(Xa.stop(),Xa.oi>this.Wf.wgj?this.uW.tP(0,4):this.uW.tP(0,5))}).fail(Bb=>{const {RtcUtils:Ja}=c(1532);this.KEb||(this.eu.IOb(),this.uW.tP(0,3),l.ULS.sendTraceTag(3249507,500,15,"Server failed to process the update notification message [{0}] : [{1}] for [{2}]",Ka,Ja.Bgc(Bb),this.dw));kb.Lmb(2)}).always(()=>{lb&&lb.stop()});return kb}o6(){this.hw.YSo(Object(e.a)(this,this.r5,"onPresenceUpdated"));this.hw.XSo(Object(e.a)(this,this.TSa,"onPersistentStateUpdated"));this.hw.WSo(Object(e.a)(this,this.Ygc,
"onPersistentStateCleared"));this.hw.hTo(Object(e.a)(this,this.m1,"onUpdateNotificationReceived"))}dqn(xa,fa){this.r5(fa.Zra,fa.vLd)}r5(xa){this.eu.JOb();this.TSa(0,xa)}cqn(xa,fa){this.TSa(fa.type,fa.Zra)}csn(xa,fa){const Ka={};for(let lb in fa)Ka[lb]=fa[lb].Presence;this.kXi(xa,Ka,fa)}TSa(xa,fa){this.eu.JOb();this.kXi(xa,fa)}kXi(xa,fa,Ka=null){var {RtcUtils:lb}=c(1532);if(l.ULS.R$(500,100))for(var Xa in fa);delete fa[this._clientId];if(!Q.a.isEmpty(fa)){for(var kb in fa)Xa=kb,fa[Xa]=lb.deserialize(fa[kb],
"Presence",Xa,!1,this.ozc);lb=new x.a;kb=(new Date).getTime();for(let Bb in fa){Xa=fa[Bb];let Ja=Bb,Ma;Ka?(Ma=Ka[Ja],Ma.Presence=Xa):Ma=Object.assign(new V,{Presence:Xa,TimeStamp:kb});lb.Z(Ja,Ma)}this.zm.m7i(xa,lb);switch(xa){case 0:this.h6g||(l.ULS.sendTraceTag(4539734,500,50,"Raising first presence update notification for [{0}]",this.dw),this.h6g=!0,y.AFrameworkApplication.Og&&y.AFrameworkApplication.Og.P$m());this.zm.Z6i(fa,[]);break;case 2:this.f6g||(l.ULS.sendTraceTag(508867081,500,50,"Raising first live meeting update notification for [{0}]",
this.dw),this.f6g=!0);this.zm.X6i(xa,fa);break;default:this.zm.X6i(xa,fa)}}}bqn(xa,fa){this.Ygc(fa.DGd)}Ygc(xa){this.eu.JOb();if(l.ULS.R$(500,100))for(let fa=0;fa<xa.length;++fa);xa.length&&(this.zm.jPn(xa),this.zm.KOn(xa),this.zm.Z6i({},xa))}eqn(xa,fa){this.m1(fa.type,fa.NL)}m1(xa,fa=null){this.Wf.dto&&0===xa&&l.ULS.sendTraceTag(40128990,500,50,"Received ContentUpdate notification from the server");if(0===xa&&this.yNe&&0<this.yNe.length){var Ka=Object.assign(new sa.a,{topLevelKpiName:"ContentUpdateNotificationReceived",
featureName:"RtcNotification",crewAlias:this.yNe,vetoPillar:"RealTimeCoauth"});(Ka=W.a.getInstance(Ka))&&Ka.logKpiUsage(this.r$j)}this.Wf.eto&&13===xa&&l.ULS.sendTraceTag(575221780,500,50,String.format("Received HostSubscription notification from the server : {0}",fa||"<none>"));this.eu.JOb();5===xa?(fa=(xa=this.oBn(fa))?String.format("Received client reconnection request from the server. Reason: {0}, Backoff time: {1} ",xa.reason,xa.reconnectDelay):"Received client reconnection request from the server without params.",
l.ULS.sendTraceTag(18637071,500,50,fa),this.zm.Kce(xa)):(fa=c(1532).RtcUtils.deserialize(fa,String.format("UpdateNotification-{0}",ua[xa]),null,!1,this.ozc),this.zm.iPn(xa,fa))}oBn(xa){try{if(!xa||""===xa)return null;const fa=JSON.parse(xa);return new Z(fa[ka.a.Jag],fa[ka.a.c$n],fa[ka.a.g$n],fa[ka.a.Zbg])}catch(fa){return l.ULS.sendTraceTag(593844380,500,15,"Error when parsing reconnect hint: {0}",fa.message),null}}xzj(xa,fa){return this.oEc.aim(this.bim(xa,fa))}bim(xa,fa){return xa+","+fa}static pTl(){var xa=
new Map;xa.set("SkipAria","True");xa=Object.assign(new Da.a,{extendedProperties:xa});return Object.assign(new Pa.a,{kpiName:"ContentUpdateNotificationReceived",kpiType:0,optionalProperties:xa,blockFutureEmissionDurationInMs:3E5})}}Object(D.a)(Ra,"RtcMessageHandler",O,[]);class Ga{UMh(xa,fa=""){const {MaxOutstandingThrottler:Ka}=c(1735);return Ka.createInstance(xa,fa)}ncl(xa,fa=""){const {MaxRateThrottler:Ka}=c(1737);return Ka.createInstance(xa,fa)}}Object(D.a)(Ga,"ThrottlerFactory",null,[893]);var ta=
c(81),va=c(1740);class ia{constructor(xa){this.Wf=null;this.Zh=!1;this.sa=new ta.a;this.GKe=new x.a;this.EKe=new x.a;this.QVe=xa;this.AXb=this.QVe.UMh(fa=>fa.send(),"GlobalMaxOustandingThrottler");this.AXb.sCd(()=>{this.sa.raiseEvent("TMUDM")})}init(xa){this.Zh||(this.Wf=xa,this.AXb.init(this.Wf.rrb,this.Wf.smm),this.Zh=!0)}aim(xa){var {MaxRateThrottler:fa}=c(1737),{MaxOutstandingThrottler:Ka}=c(1735);this.Zh||this.init(new va.a(fa.oQh,Ka.SQh,Ka.zQh,ia.Abn));({value:fa}=this.GKe.Fc(xa)).returnValue||
(({value:fa}=this.EKe.Fc(xa)).returnValue||(fa="MaxOutstandingThrottler-"+xa,fa=this.QVe.UMh(Object(e.a)(this.AXb,this.AXb.add,"add"),fa),fa.init(this.Wf.rrb,this.Wf.zbn),fa.sCd(()=>{this.sa.raiseEvent("TMUDM")}),this.EKe.add(xa,fa)),Ka="MaxRateThrottler-"+xa,fa=this.QVe.ncl(Object(e.a)(fa,fa.add,"add"),Ka),fa.init(this.Wf.xdn),this.GKe.add(xa,fa));return fa}reset(){for(let xa of this.GKe)xa.value.u6f();for(let xa of this.EKe)xa.value.u6f(),xa.value.reset();this.AXb.u6f();this.AXb.reset()}sCd(xa){this.sa.addHandler("TMUDM",
xa)}}ia.Abn=1E3;Object(D.a)(ia,"ThrottlerManager",null,[892]);var qa;(function(xa){xa[xa.unspecified=0]="unspecified";xa[xa.word=1]="word";xa[xa.excel=2]="excel";xa[xa.powerPoint=3]="powerPoint";xa[xa.test=4]="test";xa[xa.wacFrontEnd=5]="wacFrontEnd";xa[xa.oneNote=6]="oneNote";xa[xa.visio=7]="visio";xa[xa.officeMobile=8]="officeMobile";xa[xa.cosmosDBChangefeed=9]="cosmosDBChangefeed";xa[xa.last=10]="last"})(qa||(qa={}));Object(D.b)("RtcClientAppName",qa);const pa=(xa,fa,Ka,lb,Xa,kb,Bb,Ja,Ma=null,
fb=null,hc=null,cc=null)=>{const mb=L.createInstance(y.AFrameworkApplication.K),Hb=y.AFrameworkApplication.buildVersion?y.AFrameworkApplication.buildVersion:"1.0",Ua=Fa(xa,fa,Bb,Hb),Ya=mb.RZk?c(1896).RealtimeChannelMetrics.createInstance(Ua):new F;var Fb=c(1552).FrequentLoggingMetrics.create(Xa);mb.i$n&&Fb.RCo(mb.h$n);var Wa="";Wa=Ma&&""!==Ma?Ma:"/rtc2/";Fb.C0h=t.a.aY(Wa);const yb=Wa+"signalr";Ma=Wa+"findsession";const Yb=M.owm;Wa=new Ga;hc=hc||R.a.getInstance();l.ULS.shipAssertTag(556867617,500,
mb.zgj<=c(1562).RealtimeChannel.dOi,"Client attempting to override max payload size beyond absolute limit");const qc=Math.min(mb.zgj,c(1562).RealtimeChannel.dOi);Fb.cOi=qc;Fb=new Ra(mb,new ia(Wa),xa,Ua,Hc=>new K(Hc.createHubProxy(Yb)),Ja,hc,Ya,Fb,qc);fb||(fb=c(1791).FindSessionStrategy.createInstance(fa,Xa,Ma,Ja,Hb,Bb,xa,Ua,hc,kb,lb,cc));fb.MOd=mb.MOd;fa=new H(Ua);Ka=Ka?Ka.split(","):null;xa=new (c(1562).RealtimeChannel)(xa,Ka,Ua,Ja,()=>$.hubConnection(yb),fb,Fb,fa,hc,Ya,mb,Xa);xa.init();return xa},
Fa=(xa,fa,Ka)=>String.format("ClientID={0}, App={1}, ClientType={2}, SessionId={3}",xa,za(qa[Ka]),za("browser"),fa),za=xa=>xa?xa.charAt(0).toLocaleUpperCase()+xa.substring(1,xa.length):xa;c.d(I,"RealtimeChannel",function(){return Oa});class Oa{constructor(xa,fa,Ka,lb,Xa,kb,Bb,Ja,Ma,fb,hc,cc){this.lUe=!1;this.N6=null;this.s3=new x.a;this.Nsc=1;this.cfa=null;this.lm=!1;this.JIe=(new Date(0)).getTime();this.dhh=0;this._clientId=xa;this.Gzd=fa;this.uaa=0;this.je=lb;this.Xwe=Ja;this.kik=Bb;this.GUj=Ma;
this.WZj=Xa;this.v$a=kb;this.dw=Ka;this.eu=fb;this.Wf=hc;this.$f=cc;this.mkk=1>100*Math.random()}get oSa(){return this.v$a.oSa}set oSa(xa){this.v$a.oSa=xa}get spb(){return this.kik}get zm(){return this.GUj}init(){this.zm.lzk(Object(e.a)(this,this.uLd,"disconnectAndCreateNewConnection"));this.zm.Kzk(Object(e.a)(this,this.Xvn,"onUpdatePersistentStateRequestReceivedInternal"));this.zm.Jzk(Object(e.a)(this,this.Wvn,"onUpdatePersistentStateClearedRequestReceived"));this.$f.y2b(this.eu);y.AFrameworkApplication.qI(()=>
{const {FrequentLoggingMetrics:xa}=c(1552);this.eu.v6f();xa.instance&&xa.instance.wNf()});this.mNh();this.Tol();this.zm.wzk(Object(e.a)(this,this.iVo,"updateConnectionQueryString"))}Tol(){try{const Ka=$.signalR;if(!Ka)throw Error.invalidOperation("Failed to retrieve Signalr object");const lb=Ka.version;if(!lb)throw Error.invalidOperation("Signalr object is missing version information");if("2.1.1"===lb){var xa=Ka.transports;if(!xa)throw Error.invalidOperation("Failed to retrieve transports object");
var fa=xa.longPolling;if(!fa)throw Error.invalidOperation("Failed to retrieve longPolling object");if(!fa.supportsKeepAlive)throw Error.invalidOperation("LongPolling object does not have a field called supportsKeepAlive");fa.supportsKeepAlive=this.Nel()}}catch(Ka){l.ULS.sendTraceTag(6432339,500,15,"Failed to disable longPolling KeepAlives: {0}",Ka.message)}}Nel(){return()=>!1}mNh(){const xa=++this.Nsc;this.JIe=(new Date(0)).getTime();this.cfa=this.WZj();this.zm.ROn(this.cfa);this.cfa.stateChanged(fa=>
{this.Ymn(fa,xa)});this.cfa.connectionSlow(Object(e.a)(this,this.Mun,"onSlowConnection"));this.cfa.error(Object(e.a)(this,this.Dun,"onSignalRError"));this.cfa.log=Object(e.a)(this,this.Eun,"onSignalRLog")}npc(xa,fa){return xa!==this.Nsc?(l.ULS.sendTraceTag(4309017,500,50,"ConnectionToken verification failed for {0}",fa),!1):!0}connect(){2!==this.uaa&&1!==this.uaa&&(l.ULS.sendTraceTag(4539721,500,50,"Starting a new RTC connection for client [{0}]",this.dw),this.Xwe.Umn(),z.a.instance.SCo(),this.aja(1,
this.uaa),this.uvj())}uvj(){const xa=this.Nsc;this.lUe=!1;this.eu.i8i();this.v$a.Gcm(Object(e.a)(this,this.y4k,"connectSignalrConnection"),Object(e.a)(this,this.oVi,"onFailureToConnect"),Object(e.a)(this.spb,this.spb.$zm,"initThrottlerManager"),Object(e.a)(this,this.npc,"verifyConnectionToken"),xa)}oVi(xa=null){this.eu.k8i();let fa=null;!xa||"documentsessiondeleted"!==(fa=xa.toLowerCase())&&"documentsessionexpired"!==fa?this.uLd():(l.ULS.sendTraceTag(41788292,500,15,"In RealtimeChannel method OnFailureToConnect: Disconnect was called for [{0}], due to non-retriable RtcErrorCode:{1}",
this.dw,xa),this.disconnect())}uLd(xa,fa=null){l.ULS.sendTraceTag(4309018,500,50,"Disconnecting the connection [{0}]",this.N6);xa=(xa=2===this.uaa||1===this.uaa)&&!this.spb.KEb;let Ka=!0,lb=0;fa&&Object.getType(fa)!==Object.getType(Sys.EventArgs.Empty)&&fa.G9f&&""!==fa.G9f&&(xa=!0,this.v$a.kno(fa.G9f),Ka=fa.Zbg,lb=fa.reconnectDelay);xa&&this.aja(1,this.uaa);++this.Nsc;this.spb.o6();this.gEo(Ka);this.v$a.tql();this.mNh();xa&&window.setTimeout(Object(e.a)(this,this.uvj,"startConnecting"),Math.min(lb,
3E4))}iVo(){let xa=null;const fa=({correlationId:xa}=this.v$a.X9h()).returnValue;this.cfa.qs=fa;l.ULS.sendTraceTag(40768457,500,50,"Connection parameters refresh finished for client [{0}], CorrelationId:{1}",this.dw,xa)}y4k(xa){const {FrequentLoggingMetrics:fa}=c(1552);this.JIe=(new Date).getTime();let Ka=null;this.cfa.qs=({correlationId:Ka}=this.v$a.X9h()).returnValue;this.Wf.UBk&&(this.cfa.url=xa,fa.instance&&(fa.instance.sIh=t.a.aY(xa)));let lb=null;this.je&&(lb=this.je.Zf("WebServiceCall","ConnectToServer"));
l.ULS.sendTraceTag(3290048,500,50,"Connecting to server for client [{0}]",this.dw);xa={};this.Gzd&&(xa.transport=1===this.Gzd.length?this.Gzd[0]:this.Gzd);xa.pingInterval=null;z.a.instance.d6c(1,0);xa.waitForPageLoad=!1;this.cfa.start(xa,null).done(Xa=>{this.eu.l8i();z.a.instance.d6c(1,1,!0);l.ULS.sendTraceTag(3457857,500,50,"Successfully connected to server using connection [{0}], CorrelationId:{1}",Xa.id,Ka)}).fail(Xa=>{l.ULS.sendTraceTag(3457858,500,15,"Failed to connect to server : connection string: {0}, CorrelationId:{1},  ClientDetails: [{2}]",
this.v$a.CX,Ka,this.dw);this.oVi();this.eu.j8i(Xa);z.a.instance.d6c(1,1,!1);this.zm.c7i(0,{["CorrelationId"]:Ka,["ErrorDetails"]:Xa,["ConnectionState"]:k.a[this.uaa]})}).always(()=>{const {FrequentLoggingMetrics:Xa}=c(1552);lb&&lb.stop();Xa.instance&&(Xa.instance.$Ae=!1)})}disconnect(){const {FrequentLoggingMetrics:xa}=c(1552);0===this.uaa?l.ULS.sendTraceTag(36545632,500,50,"Disconnect for [{0}] was called but the channel is already Disconnected",this.dw):(this.eu.o8i(),xa.instance&&(xa.instance.$Ae=
!0),l.ULS.sendTraceTag(36545633,500,50,"Starting explicit disconnect for [{0}]",this.dw),this.spb.KEb=!0,this.Xwe.Onn(),this.aja(0,this.uaa),this.uLd(),this.spb.KEb=!1)}gEo(xa){const fa=this.bSk(),Ka=this.cfa,lb=this.N6,Xa=()=>{if(this.lUe)l.ULS.sendTraceTag(591692192,500,15,"Stop connection was called twice, possibly on the same connection.");else try{this.lUe=!0,Ka.stop(!0,xa)}catch(kb){l.ULS.sendTraceTag(591692191,500,15,"Stopping connection failed: {0}",kb.message)}};0<fa?(l.ULS.sendTraceTag(4309020,
500,50,"Waiting to stop connection [{0}]: [{1}] ms.",lb,fa),window.setTimeout(Xa,fa)):(l.ULS.sendTraceTag(36804372,500,50,"Stopping connection [{0}].",lb),Xa())}bSk(){let xa=0;0===this.cfa.state&&(xa=this.JIe+Oa.b4o-(new Date).getTime(),0>xa&&(xa=0));return xa}get connectionState(){return this.uaa}Iua(xa){this.zm.Iua(xa)}ujc(xa){this.zm.ujc(xa)}Jjj(xa){this.Hkc(0,xa)}Hkc(xa,fa){const Ka=new a.a;this.zm.f7i(xa,fa,Ka);return Ka.task}D_a(xa){this.zm.D_a(xa)}dPb(xa){this.zm.dPb(xa)}fGc(xa){this.zm.fGc(xa)}$6c(xa){this.zm.$6c(xa)}pCd(xa){this.zm.pCd(xa)}Qde(xa){this.zm.Qde(xa)}kSc(xa){return this.Xjm(xa)}CFb(){return this.i9b(0)}i9b(xa){const fa=
{};for(let Ka of this.s3)Ka.value.nb(xa)&&(fa[Ka.key]=Ka.value.J(xa).data);return fa}Xjm(xa){return this.s3.nb(xa)&&this.s3.J(xa).nb(0)?this.s3.J(xa).J(0).data:null}Xvn(xa,fa){for(let Ka of fa.c0o)this.s3.nb(Ka.key)||this.s3.Z(Ka.key,new N.a),xa=Ka.value,this.s3.J(Ka.key).Z(fa.type,new v(xa.Presence,new Date(xa.TimeStamp))),Ka.key===this._clientId&&0===fa.type&&this.zm.wOn(xa.Presence)}Wvn(xa,fa){for(const Ka of fa.DGd)this.s3.remove(Ka)}pNl(){const xa=new N.a;if(!this.s3.nb(this._clientId))return xa;
for(let fa of this.s3.J(this._clientId))xa.Z(fa.key,fa.value.data);return xa}qN(xa,fa=null,Ka=!1){const lb=new a.a;this.zm.D5f(xa,fa,Ka,lb);return lb.task}T3(xa){this.zm.T3(xa)}ePb(xa){this.zm.ePb(xa)}Ejb(xa){let fa,Ka;return({value:fa}=this.s3.Fc(xa)).returnValue&&({value:Ka}=fa.Fc(0)).returnValue?new m(this.bkm(Ka),Ka.timeStamp):null}yPc(){const xa={};for(let fa of this.s3)fa.value.Fc(0).returnValue&&(xa[fa.key]=this.Ejb(fa.key));return xa}Prb(xa){const fa=new a.a;this.zm.l7i(xa,fa);return fa.task}get clientId(){return this._clientId}get ezo(){return this.mkk}dispose(){const {FrequentLoggingMetrics:xa}=
c(1552);this.lm||(this.spb.o6(),this.$f.h8f(this.eu),this.eu.v6f(),xa.instance&&xa.instance.wNf(),this.lm=!0)}Ymn(xa,fa){this.npc(fa,"StateChangedSignalR")&&this.aja(this.dKh(xa.newState),this.dKh(xa.oldState))}aja(xa,fa){var {FrequentLoggingMetrics:Ka}=c(1552),{ClientToClientMessageTelemetry:lb}=c(1801);if((1!==this.uaa||0!==fa||1!==xa)&&this.uaa!==fa){const Xa=String.format.apply(null,["Unexpected connection state change : Current state is '{0}' while the event indicates ('{1}'->'{2}') transition"].concat([this.uaa,
fa,xa]));l.ULS.sendTraceTag(3290053,500,10,Xa)}if(this.uaa!==xa){switch(xa){case 2:Ka.instance&&Ka.instance.W$m();this.N6=this.cfa.id;l.ULS.sendTraceTag(3249539,500,50,"Established connection [{0}] for client [{1}]",this.N6,this.dw);this.e8m(this.cfa);l.ULS.sendTraceTag(4298369,500,50,"Retrieving complete session state");Ka=null;this.je&&(Ka=this.je.Zf("WebServiceCall","Receive First Presence"));lb=this.Nsc;this.zm.QOn(Object(e.a)(this,this.npc,"verifyConnectionToken"),lb,this.Xwe,Object(e.a)(this,
this.i8e,"clearExistingPersistentState"),this.pNl(),Ka);this.Wf.d$n&&(Ka=100*Math.random()<=this.Wf.e$n,c(1801).ClientToClientMessageTelemetry.t$b(this.zm,this.Wf,Ka).start());break;case 1:2===fa&&l.ULS.sendTraceTag(4298644,500,50,"Lost connection [{0}] to the server ...trying to re-establish it",this.N6);break;case 0:if(lb.instance&&lb.instance.stop(),this.spb.KEb)l.ULS.sendTraceTag(3249543,500,50,"Connection [{0}] has been explicitly closed",this.N6);else{1===fa&&(l.ULS.sendTraceTag(7672737,500,
50,"Signalr detected an unexpected disconnect event while attempting to re-establish connection [{0}]. Kicking off global reconnect logic ...",this.N6),this.eu.p8i());2===fa&&l.ULS.sendTraceTag(36574532,500,50,"Signalr detected a disconnect event triggered by a period of client inactivity for connection [{0}]. Kicking off global reconnect logic ...",this.N6);this.uLd();return}}this.uaa=xa;this.zm.VNn(xa,fa)}}e8m(xa){if(xa&&xa.transport&&xa.transport.name){xa=xa.transport.name;var fa=xa.toLowerCase();
"websockets"===fa?l.ULS.sendTraceTag(4290723,500,50,"Transport name - {0} for [{1}]",xa,this.dw):"serversentevents"===fa?l.ULS.sendTraceTag(4290752,500,50,"Transport name - {0} for [{1}]",xa,this.dw):"foreverframe"===fa?l.ULS.sendTraceTag(4290753,500,50,"Transport name - {0} for [{1}]",xa,this.dw):"longpolling"===fa?l.ULS.sendTraceTag(4290754,500,50,"Transport name - {0} for [{1}]",xa,this.dw):"mocktransport"!==fa&&l.ULS.sendTraceTag(4290755,500,15,"Unknown transport protocol encountered - '{0}'",
xa)}else l.ULS.sendTraceTag(4290722,500,10,"Transport protocol name is missing")}Mun(){if(this.Wf.ygj){const xa=t.a.kP(this.oSa,"mid");l.ULS.sendTraceTag(3249544,500,15,"Detected that the connection [{0}] is slow for target machine [{1}]",this.N6,xa)}else l.ULS.sendTraceTag(522716053,500,50,"Detected that the connection [{0}] is slow",this.N6)}Dun(){l.ULS.sendTraceTag(3249545,600,15,"SignalR ERROR for connection [{0}];",this.N6)}Eun(xa){xa=c(1532).RtcUtils.Bgc(xa);if(this.Wf.ygj&&xa.startsWith("Keep alive timed out.")){const fa=
t.a.kP(this.oSa,"mid");l.ULS.sendTraceTag(522716054,500,15,"SignalR lib: {0}. Target Machine: {1}",xa,fa)}else this.ezo&&2E3>this.dhh&&!xa.startsWith("Invok")&&!xa.startsWith("Trigger")&&(l.ULS.sendTraceTag(578950464,500,50,"SignalR lib: {0}",xa),this.dhh++)}i8e(){let xa;const fa=[];({value:xa}=this.s3.Fc(this._clientId)).returnValue&&this.s3.remove(this._clientId);for(let Ka of this.s3.keys)Array.add(fa,Ka);for(const Ka of fa)this.s3.remove(Ka);xa&&this.s3.Z(this._clientId,xa);this.zm.qOn(fa)}dKh(xa){switch(xa){case 0:return 1;
case 2:return 1;case 1:return 2;case 4:return 0;default:throw Error.argumentOutOfRange("state",xa,"Unknown SignalR state");}}bkm(xa){return xa&&xa.timeStamp?(new Date).getTime()-xa.timeStamp.getTime()>(this.Wf.wJk?6E4:this.Wf.vJk)?2:1:1}static createInstance(xa,fa,Ka,lb,Xa,kb,Bb,Ja=null,Ma=null,fb=null,hc=null,cc=null,mb=null){return pa(xa,fa,Ka,mb,lb,Xa,kb,Bb,Ja,Ma,fb,cc,hc)}}Oa.dOi=31E3;Oa.jPf=8E3;Oa.b4o=15E3;Object(D.a)(Oa,"RealtimeChannel",null,[864,865])},1653:function(D,I,c){c.d(I,"a",function(){return l});
D=c(0);class l{constructor(){this.gih=!1;this.qyb=null;this.dRg=0;this.zBe=this.FOh();this.Eid=this.FOh();this.Dtb=this.uXb=0;this.nq=()=>new Date}get vFo(){return this.gih}FOh(){const e=Array(6);for(let a=0;a<e.length;a++)e[a]=0;return e}mYl(){return this.zBe.toString()}OSl(){return this.Eid.toString()}SCo(){this.qyb=this.nq()}d6c(e,a,k=!1){this.vFo||(k&&(this.gih=!0),k=this.nq(),0===e&&5<this.uXb||1===e&&5<this.Dtb||(this.dRg<e?(1===this.uXb%2&&(this.zBe[this.uXb]=-1,this.uXb++),this.dRg=e,1===
a&&(this.Eid[this.Dtb]=-1,this.Dtb++),this.Eid[this.Dtb]=this.Gjg(k),this.Dtb++):0===e?(this.zBe[this.uXb]=this.Gjg(k),this.uXb++):(this.Eid[this.Dtb]=this.Gjg(k),this.Dtb++)))}Gjg(e){const a=e.getTime()-this.qyb.getTime();this.qyb=e;return a}static get instance(){l._instance||(l._instance=new l);return l._instance}static set instance(e){l._instance=e}}l._instance=null;Object(D.a)(l,"LatencyMetrics",null,[])},1680:function(D,I,c){D=c(0);class l{constructor(){this.TNg=this.Rwe=!1;this.callback=null}b2c(a){this.callback=
a;this.wBj()}vNi(a){this.Rwe||(this.Rwe=!0,this.OZj=a,this.wBj())}wBj(){this.Rwe&&this.callback&&!this.TNg&&(this.TNg=!0,this.callback(this.OZj))}}Object(D.a)(l,"CompletionTask",null,[]);c.d(I,"a",function(){return e});class e{constructor(){this.s7g=new l;this.q7g=new l}W7d(a){this.s7g.b2c(a)}V7d(a){this.q7g.b2c(a)}d0c(a){this.s7g.vNi(a)}Lmb(a){this.q7g.vNi(a)}VOf(){this.d0c(2);this.Lmb(2)}}Object(D.a)(e,"MessageStatus",null,[907])},1735:function(D,I,c){c.r(I);c.d(I,"MaxOutstandingThrottler",function(){return k});
D=c(0);var l=c(54),e=c(81);I=c(1736);var a=c(1680);class k extends I.a{constructor(x,y=""){super(x,y);this.Nfc=this.rrb=0;this.sa=new e.a;this.BYb=!1;this.qsd=this.fjd=this.Fid=this.PVe=0;this.J3=[];this.clearTimeout=k.Vdf}add(x){this.CYb||this.init(k.SQh,k.zQh);this.Vzb++;const y=new a.a;this.odc?this.She(x,y):this.qsd<this.Nfc?this.a9c(x,y):(this.She(x,y),this.BYb=!1);return y}a9c(x,y){x=this.zfh(x);const m=this.setTimeout(Object(l.a)(this,this.Yqn,"onMessageWaitTimeExpired"),this.rrb);++this.qsd;
Array.add(this.J3,m);const t=this.Fid;x.W7d(z=>{y.d0c(z)});x.V7d(z=>{this.Fid===t&&(this.Xqn(t,m),y.Lmb(z))})}Xqn(x,y){this.Fid===x&&(--this.qsd,this.clearTimeout(y),Array.remove(this.J3,y),this.odc&&this.dfo())}dfo(){this.odc&&!this.BYb&&(this.PVe=this.setTimeout(Object(l.a)(this,this.efo,"sendThrottledMessageFromTimer"),0),this.BYb=!0)}efo(){this.BYb=!1;if(this.odc){const x=this.ezd,y=this.d1b;this.OIc(!1);this.a9c(x,y)}}Yqn(){++this.fjd;this.fjd>Math.floor(this.Nfc/2)&&(this.fjd=-1E9,this.sa.raiseEvent("TMUDM"))}sCd(x){this.sa.addHandler("TMUDM",
x)}reset(){this.Vzb=this.nEc=this.Auc=this.fjd=0;++this.Fid;for(const x of this.J3)this.clearTimeout(x);this.qsd=0;this.J3=[];this.OIc(!0);this.BYb&&(this.clearTimeout(this.PVe),this.PVe=0,this.BYb=!1)}init(x,y){this.CYb||(this.rrb=x,this.Nfc=y,this.CYb=!0)}static createInstance(x,y=""){return new k(x,y)}static Vdf(x){window.clearTimeout(x)}}k.SQh=15E3;k.zQh=5;Object(D.a)(k,"MaxOutstandingThrottler",I.a,[904,905])},1736:function(D,I,c){c.d(I,"a",function(){return e});D=c(0);var l=c(7);class e{constructor(a,
k=""){this.Auc=this.nEc=0;this.JGe=!1;this.d1b=this.ezd=null;this.CYb=!1;this.zfh=a;this.yzj=k;this.setTimeout=e.bef;this.Vzb=this.nEc=this.Auc=0}u6f(){0<this.Vzb&&0<this.Auc&&l.ULS.sendTraceTag(36545635,500,50,"Throttler [{0}] dropped [{1}] messages out of [{2}]",this.yzj,this.Auc,this.Vzb);0<this.Vzb&&0<this.nEc&&l.ULS.sendTraceTag(36545634,500,50,"Throttler [{0}] throttled [{1}] messages out of [{2}]",this.yzj,this.nEc,this.Vzb)}get odc(){return this.JGe}She(a,k){this.nEc++;this.OIc(!0);this.JGe=
!0;this.ezd=a;this.d1b=k}OIc(a){this.JGe=!1;this.d1b&&a&&(this.Auc++,this.d1b.VOf());this.d1b=this.ezd=null}static bef(a,k){return window.setTimeout(a,k)}}Object(D.a)(e,"ThrottlerBase",null,[])},1737:function(D,I,c){c.r(I);c.d(I,"MaxRateThrottler",function(){return a});D=c(0);var l=c(54);I=c(1736);var e=c(1680);class a extends I.a{constructor(k,x=""){super(k,x);this.Vfc=0;this.tyc=(new Date(0)).getTime();this.currentTime=()=>(new Date).getTime()}init(k){this.CYb||(this.Vfc=k,this.CYb=!0)}add(k){this.CYb||
this.init(a.oQh);this.Vzb++;const x=this.currentTime(),y=new e.a;this.tyc>x&&(this.tyc=x);this.odc?(this.OIc(!0),this.She(k,y)):this.tyc+this.Vfc<=x?this.a9c(k,y):(this.She(k,y),this.setTimeout(Object(l.a)(this,this.cfo,"sendThrottledMessage"),this.tyc+this.Vfc-x));return y}cfo(){if(this.odc){const k=this.ezd,x=this.d1b;this.OIc(!1);this.a9c(k,x)}}a9c(k,x){this.tyc=this.currentTime();k=this.zfh(k);k.W7d(y=>{x.d0c(y)});k.V7d(y=>{x.Lmb(y)})}static createInstance(k,x=""){return new a(k,x)}}a.oQh=200;
Object(D.a)(a,"MaxRateThrottler",I.a,[906,905])},1738:function(D,I,c){c.d(I,"a",function(){return l});D=c(0);class l extends Sys.EventArgs{constructor(e,a,k,x){super();this.type=e;this.NL=a;this.Hll=k;this.L8a=x}}Object(D.a)(l,"SendUpdateNotificationEventArgs",Sys.EventArgs,[])},1739:function(D,I,c){c.d(I,"a",function(){return l});D=c(0);class l{}l.Jag="rr";l.g$n="rd";l.c$n="rbp";l.Zbg="sa";Object(D.a)(l,"RtcReconnectParams",null,[])},1740:function(D,I,c){c.d(I,"a",function(){return l});D=c(0);class l{constructor(e,
a,k,x){this.xdn=e;this.rrb=a;this.zbn=k;this.smm=x}}Object(D.a)(l,"ThrottlerManagerSettings",null,[])},1787:function(D,I,c){D=c(0);class l extends Sys.EventArgs{constructor(N,O){super();this.newState=N;this.oldState=O}}Object(D.a)(l,"ChangedConnectionStateEventArgs",Sys.EventArgs,[]);class e extends Sys.EventArgs{constructor(N,O){super();this.QZk=N;this.L8a=O}}Object(D.a)(e,"ClientInfoEventArgs",Sys.EventArgs,[]);class a extends Sys.EventArgs{constructor(N){super();this.presence=N}}Object(D.a)(a,
"MyPresenceUpdatedEventArgs",Sys.EventArgs,[]);var k=c(1898),x=c(1897),y=c(1895);class m extends Sys.EventArgs{constructor(N,O=null){super();this.fk=N;this.Vnk=O}get type(){return this.fk}get NL(){return this.Vnk}}Object(D.a)(m,"UpdateNotificationEventArgs",Sys.EventArgs,[]);class t extends Sys.EventArgs{constructor(){super()}}Object(D.a)(t,"GotCompletePersistentStateWithMetadataEventArgs",Sys.EventArgs,[]);class z extends Sys.EventArgs{constructor(N,O,W,V,Q,Y){super();this.npc=N;this.e$e=O;this.A4k=
W;this.hZh=Q;this.i8e=V;this.YA=Y}}Object(D.a)(z,"RefreshAllPersistentStateEventArgs",Sys.EventArgs,[]);class v extends Sys.EventArgs{constructor(N){super();this.hubConnection=N}}Object(D.a)(v,"RefreshProxyEventArgs",Sys.EventArgs,[]);class H extends Sys.EventArgs{constructor(N,O){super();this.tha=N;this.errorMessage=O}}Object(D.a)(H,"RtcConnectFailedEventArgs",Sys.EventArgs,[]);class F extends Sys.EventArgs{constructor(N,O,W){super();this.type=N;this.presence=O;this.L8a=W}}Object(D.a)(F,"SendPersistentStateEventArgs",
Sys.EventArgs,[]);var G=c(1738);class M extends Sys.EventArgs{constructor(){super()}}Object(D.a)(M,"SessionPropertiesChangedEventArgs",Sys.EventArgs,[]);class K extends Sys.EventArgs{constructor(N){super();this.DGd=N}}Object(D.a)(K,"UpdatePersistentStateClearedRequestEventArgs",Sys.EventArgs,[]);class L extends Sys.EventArgs{constructor(N,O){super();this.type=N;this.c0o=O}}Object(D.a)(L,"UpdatePersistentStateRequestEventArgs",Sys.EventArgs,[]);var R=c(81);c.d(I,"a",function(){return S});class S{constructor(){this.sa=
new R.a}VNn(N,O){this.sa.raiseEvent("CSC",new l(N,O))}ROn(N){this.sa.raiseEvent("RP",new v(N))}Kce(N){this.sa.raiseEvent("RC",N)}UOn(){this.sa.raiseEvent("RMID")}QOn(N,O,W,V,Q,Y){this.sa.raiseEvent("RPS",new z(N,O,W,V,Q,Y))}m7i(N,O){this.sa.raiseEvent("UPSR",new L(N,O))}Z6i(N,O){this.sa.raiseEvent("PU",new y.a(N,O))}wOn(N){this.sa.raiseEvent("MPU",new a(N))}D5f(N,O,W,V){this.sa.raiseEvent("SUN",new G.a(N,O,W,V))}iPn(N,O){this.sa.raiseEvent("UNR",new m(N,O))}f7i(N,O,W){this.sa.raiseEvent("SP",new F(N,
O,W))}X6i(N,O){this.sa.raiseEvent("PSU",new x.a(N,O))}KOn(N){this.sa.raiseEvent("PSC",new k.a(N))}qOn(N){this.sa.raiseEvent("IPSC",new k.a(N))}jPn(N){this.sa.raiseEvent("UPSC",new K(N))}WOn(N,O){this.sa.raiseEvent("SPC",new M(N,O))}c7i(N,O){this.sa.raiseEvent("RCF",new H(N,O))}jOn(N){this.sa.raiseEvent("CPSWM",new t(N))}l7i(N,O){this.sa.raiseEvent("UCI",new e(N,O))}Iua(N){this.sa.addHandler("CSC",N)}ujc(N){this.sa.removeHandler("CSC",N)}mzk(N){this.sa.addHandler("RP",N)}lzk(N){this.sa.addHandler("RC",
N)}pzk(N){this.sa.addHandler("RMID",N)}kzk(N){this.sa.addHandler("RPS",N)}Kzk(N){this.sa.addHandler("UPSR",N)}D_a(N){this.sa.addHandler("PU",N)}dPb(N){this.sa.removeHandler("PU",N)}jxk(N){this.sa.addHandler("IPU",N)}Hzk(N){this.sa.addHandler("UCI",N)}uzk(N){this.sa.addHandler("SUN",N)}kxk(N){this.sa.addHandler("IUNR",N)}T3(N){this.sa.addHandler("UNR",N)}ePb(N){this.sa.removeHandler("UNR",N)}fGc(N){this.sa.addHandler("PSU",N)}$6c(N){this.sa.removeHandler("PSU",N)}ixk(N){this.sa.addHandler("IPSU",N)}pCd(N){this.sa.addHandler("PSC",
N)}Qde(N){this.sa.removeHandler("PSC",N)}hxk(N){this.sa.addHandler("IPSC",N)}Jzk(N){this.sa.addHandler("UPSC",N)}szk(N){this.sa.addHandler("SP",N)}wzk(N){this.sa.addHandler("SPC",N)}static getInstance(){return S._instance||(S._instance=new S)}}S._instance=null;Object(D.a)(S,"RtcEventHub",null,[894])},1791:function(D,I,c){c.r(I);D=c(0);var l=c(7),e=c(54),a=c(75),k=c(888);class x{}x.Vfc="throttling_messageDelay";x.PXc="enabled";x.rrb="throttling_timeToWaitForResponse";x.Nfc="throttling_maxNumberOfOutstandingMessages";
x.hli="throttling_globalMaxNumberOfOutstandingMessages";x.errorMessage="errorMessage";x.Gtj="url";x.eIa="queryString";x.CX="connectionString";Object(D.a)(x,"RtcFindSessionOutputFieldNameConstants",null,[]);var y=c(2),m=c(45),t=c(39),z=c(314),v=c(1397),H=c(85),F=c(19),G=c(139);class M{constructor(){this.ili=this.aOi=this.bOi=this.gOi=0;this.E0d=!1;this.correlationId=this.CX=this.eIa=this.f$e=this.errorMessage=null}get v3k(){return this.f$e+"?"+this.eIa}}Object(D.a)(M,"FindSessionResponse",null,[]);
var K=c(595);class L{constructor(Z,ea,ha,ka,ua,sa){this.aZa=null;const {FindSessionStrategy:Da}=c(1791);this.vgk=Z;Z=String.format("{0}={1}",K.a.clientId,F.a.Gj(ka));Z=String.format("{0}&{1}={2}",Z,K.a.userSessionId,F.a.Gj(ua));Z=String.format("{0}&{1}={2}",Z,K.a.cJj,F.a.Gj(ha.toString()));Z=String.format("{0}&{1}={2}",Z,K.a.userType,F.a.Gj("1"));Z=String.format("{0}&{1}={2}",Z,K.a.mJj,F.a.Gj(ea));Z=String.format("{0}&{1}={2}",Z,K.a.AFh,F.a.Gj(Da.SZk));(ea=L.nof(ha,sa))&&(Z=String.format("{0}&{1}",
Z,ea));this.YZj=Z}n9i(){this.aZa=this.vgk()}generate(){this.aZa&&""!==this.aZa||(this.n9i(),l.ULS.sendTraceTag(575784194,500,this.aZa&&""!==this.aZa?50:15,"Query signature delegate called for refresh returned: {0} ",this.aZa));const Z=String.format("{0}={1}",K.a.wOb,F.a.Gj(this.aZa));return String.format("{0}&{1}",Z,this.YZj)}static nof(Z,ea){return 4===Z?String.format("{0}={1}",K.a.DRi,"1"):ea?ea.fki():null}}Object(D.a)(L,"FindSessionQueryStringGenerator",null,[]);var R=c(1552),S=c(1653),N=c(1532),
O=c(1740);class W{}W.$El="FSType";Object(D.a)(W,"RtcFindSessionRequestHeaders",null,[]);class V{}V.gQn="polling";Object(D.a)(V,"RtcFindSessionTypes",null,[]);var Q=c(1739);class Y{}Y.P2o="RTC-TokenProofkey";Y.PXm="RTC-IsWacJsBootFsRequest";Object(D.a)(Y,"RtcRequestHeaders",null,[]);c.d(I,"FindSessionStrategy",function(){return ba});class ba{constructor(Z,ea,ha,ka,ua,sa,Da,Pa,Ra,Ga,ta,va,ia=null){this.m4g=(new Date(0)).getTime();this.y6g=0;this.grd=!1;this.Mfh=null;this.L6f=36E5;this.OVb=ba.Nri;this.avc=
0;this.sPb=null;this.dUa=0;this.ikc=this.uIh=null;this.zhk=[x.PXc,x.errorMessage,x.Gtj,x.CX,x.eIa,x.hli,x.Nfc,x.rrb,x.Vfc];this.yhk=[x.PXc,x.errorMessage];this.CX=this.oSa=null;this.LVg=new L(ta?ta:()=>y.AFrameworkApplication.em,ua,sa,Da,Z,ea);this.bsc=va;this.je=ka;this.$f=ea;this.DBe=ha;this.dw=Pa;this.zm=Ra;this.tvc=ia;this.MVg=!1;this.MOd=9E4;Ga&&Ga.execute(qa=>{qa.A_a(()=>{l.ULS.sendTraceTag(40768456,500,50,"Connection parameters refresh requested for client [{0}]",this.dw);this.LVg.n9i()})});
2>=100*Math.random()&&(this.L6f=3E5);R.FrequentLoggingMetrics.instance&&(R.FrequentLoggingMetrics.instance.x3h=this.L6f)}kno(Z){this.ikc=Z}init(){this.zm.pzk(Object(e.a)(this,this.o6n,"resetGetMachineIdDelay"));this.zm.Iua(Object(e.a)(this,this.aja,"onConnectionStateChanged"))}aja(Z,ea){this.dUa=ea.newState;2===ea.newState&&(this.avc=0)}X9h(){let Z;Z=this.sPb.correlationId;return{returnValue:String.format("{0}&{1}={2}",this.sPb.eIa,ba.RKh,F.a.Gj(Z)),correlationId:Z}}Gcm(Z,ea,ha,ka,ua){this.Ydo(()=>
{ka(ua,"GetMachineIdSuccess")&&(l.ULS.sendTraceTag(17956951,500,50,"Successfully retrieved Rtc MachineId [{0}] for [{1}]",this.CX,this.dw),Z(this.Mfh),ha(this.cim()))},sa=>{ka(ua,"GetMachineIdFailure")&&(l.ULS.sendTraceTag(4060129,500,15,"Failed to retrieve Rtc MachineId for [{0}]",this.dw),ea(sa))},ka,ua)}tql(){this.gFh();this.uym()}Ydo(Z,ea,ha,ka){l.ULS.sendTraceTag(17956952,500,50,"Retrieving Rtc MachineId from server. Getting from last findsession, connectionString is [{0}]",this.CX);if(this.CX)Z();
else{var ua=this.hRk();window.setTimeout(()=>{this.sendFindSessionRequestToServerInternal(Z,ea,ha,ka)},ua)}}sendFindSessionRequestToServerInternal(Z,ea,ha,ka){ha(ka,"RequestMachineId")&&(this.m4g=(new Date).getTime(),ha=t.a.$e(),this.PRd(ua=>{const sa=t.a.$e();this.W0i(ua);this.$dg();Z();ua=t.a.$e()-sa;l.ULS.sendTraceTag(577356039,345,50,"SFSRTS Success - TimeElapsed: {0}",ua)},ua=>{const sa=t.a.$e();this.gFh();R.FrequentLoggingMetrics.instance&&R.FrequentLoggingMetrics.instance.tP(2,3);ea(ua);ua=
t.a.$e()-sa;l.ULS.sendTraceTag(577356040,345,50,"SFSRTS Failure - TimeElapsed: {0}",ua)},!1),ha=t.a.$e()-ha,l.ULS.sendTraceTag(577599296,345,50,"SFSRTS - TimeElapsed: {0}",ha))}uym(){this.OVb+=ba.n4l;this.OVb=Math.min(this.OVb,ba.ibn)}hRk(){var Z=(new Date).getTime();Z=this.m4g+this.OVb-Z;0>Z&&(Z=0);return Z}W0i(Z){try{this.sPb=Z,this.oSa=Z.v3k,this.CX=Z.CX,this.uIh=Z.eIa,this.Mfh=Z.f$e}catch(ea){l.ULS.sendTraceTag(17956953,500,10,"FindSession response contains invalid fields. Exception {0}, is thrown",
ea.toString())}}gFh(){this.CX=null;this.hFh()}$dg(){this.hFh();this.grd=!0;this.y6g=window.setTimeout(Object(e.a)(this,this.pUn,"refreshMachineId"),this.L6f)}hFh(){this.grd&&(window.clearTimeout(this.y6g),this.grd=!1)}pUn(){this.grd=!1;this.PRd(Z=>{const ea=this.uIh!==Z.eIa,ha=this.CX!==Z.CX,ka=this.CX;this.W0i(Z);0!==this.dUa&&(ha?(l.ULS.sendTraceTag(17956955,500,15,"Recycling RTC connection due to RTC machine id change. old={0}, new={1}",ka||"null",Z.CX),this.zm.Kce()):(this.zm.WOn(ea,ha),this.$dg()))},
()=>{R.FrequentLoggingMetrics.instance&&R.FrequentLoggingMetrics.instance.tP(2,3);this.$dg()},!0)}o6n(){this.OVb=ba.Nri}cim(){return new O.a(this.sPb.gOi,this.sPb.bOi,this.sPb.aOi,this.sPb.ili)}ONo(Z){if(Object.getType(Z)!==Object)return null;for(let ea in Z);return this.zal(Z)}zal(Z){if(!(x.PXc in Z))return null;const ea=Z[x.PXc];var ha=ea?this.zhk:this.yhk;for(const ka of ha)if(!(ka in Z))return null;ha=Object.assign(new M,{E0d:Z[x.PXc],errorMessage:Z[x.errorMessage],correlationId:G.a.create().toString()});
ea&&(ha.f$e=Z[x.Gtj],ha.eIa=Z[x.eIa],ha.CX=Z[x.CX],ha.ili=Z[x.hli],ha.aOi=Z[x.Nfc],ha.bOi=Z[x.rrb],ha.gOi=Z[x.Vfc]);return ha}nYl(Z,ea){l.ULS.sendTraceTag(50448152,500,50,"Using FindSessionUtils find session response");this.tvc.D0h.continueWith(()=>{this.tvc.D0h.result?(l.ULS.sendTraceTag(50448153,500,50,"FindSessionUtils find Session resulted in success"),Z(this.tvc.E0h)):(l.ULS.sendTraceTag(50448154,500,15,"FindSessionUtils find Session resulted in error"),ea(this.tvc.E0h))})}dej(Z,ea,ha,ka,ua=
!1){return sa=>{S.a.instance.d6c(0,1);Z&&Z.stop();this.bsc=this.ikc=null;this.rLi(sa.data,!0,ea);var Da=N.RtcUtils.deserialize(sa.data.se,"FindSession",null);if(Da)if(Da=this.ONo(Da)){if(Da.E0d&&Da.eIa&&Da.CX){l.ULS.sendTraceTag(4317446,500,50,"Successfully retrieved MachineId from server for [{0}]",this.dw);this.R4m(sa.data);ha(Da);return}ea.FindSessionFailureReason="FindSessionInvalidResponse";ea.IsRtcEnabled=Da.E0d;ea.IsQueryStringEmpty=!Da.eIa;ea.IsConnectionStringEmpty=!Da.CX;l.ULS.sendTraceTag(4290720,
500,15,"Response did not contain valid MachineId [ConnectionUrl and/or QueryString] for [{0}]; IsRtcEnabled:{1}; IsQueryStringEmpty:{2}; IsConnectionStringEmpty:{3}",this.dw,Da.E0d,!Da.eIa,!Da.CX)}else ea.FindSessionFailureReason="FindSessionTranslateServerResponseFailed",l.ULS.sendTraceTag(8745097,500,15,"Could not translate server response to findSession response for [{0}]",this.dw);else ea.FindSessionFailureReason="FindSessionDeserializeServerResponseFailed",l.ULS.sendTraceTag(7372827,500,10,"Could not deserialize response data for [{0}]",
this.dw);this.d7i(ea,ua);ka(null)}}Ydj(Z,ea,ha,ka=!1){return ua=>{S.a.instance.d6c(0,1);Z&&Z.stop();this.bsc=this.ikc=null;this.rLi(ua.data,!1,ea);let sa=null;var Da="unknown";let Pa="unknown";ua.data&&((Da=ua.data.Dj)&&ba.q8c in Da&&(sa=Da[ba.q8c].toString()),Da=v.a[ua.data.status],Pa=ua.data.Se.toString());ea.FindSessionFailureReason="FindSessionRequestFailed";ea.HttpErrorCode=Pa;ea.HttpErrorStatus=Da;ea[ba.q8c]=sa;l.ULS.sendTraceTag(4290721,500,15,"Request for MachineId failed with Status='{0}'; HttpStatus='{1}' for [{2}]; RtcErrorCode='{3}'. Polling: '{4}' '",
Da,Pa,this.dw,sa,ka);this.d7i(ea,ka);ha(Pa)}}PRd(Z,ea,ha=!1){let ka=null;l.ULS.sendTraceTag(4317445,500,50,"Getting MachineId from server for [{0}]",this.dw);const ua={};var sa=this.LVg.generate();ua[z.a.$Q]=G.a.create().toString();this.ikc&&""!==this.ikc?sa=String.format("{0}&{1}={2}",sa,Q.a.Jag,this.ikc):this.bsc&&""!==this.bsc&&(sa=String.format("{0}&{1}={2}",sa,Q.a.Jag,this.bsc),ua[Y.P2o]="True",ua[Y.PXm]="True");sa=this.DBe+"?"+sa;ha&&(ua[W.$El]=V.gQn);const Da={};Da.IsNetworkOfflineBeforeSendRequest=
this.$f.yRa;Da.HasAvailableConnectionsBeforeSendRequest=this.$f.eWd;Da.MaxConnectionsAllowed=this.$f.Kfc;Da.IsRefreshMachineId=ha;this.tvc&&!this.MVg?(this.nYl(this.dej(null,Da,Z,ea,ha),this.Ydj(null,Da,ea,ha)),this.MVg=!0):(this.je&&(ka=this.je.Zf("WebServiceCall","GetMachineIdFromTheServer")),R.FrequentLoggingMetrics.instance&&R.FrequentLoggingMetrics.instance.tP(2,0),0>this.$f.QAb(sa,1,null,ua,[ba.RId,ba.q8c,ba.I1c,ba.Iag,ba.AQi,ba.fTi,ba.eTi],1,this.dej(ka,Da,Z,ea,ha),this.Ydj(ka,Da,ea,ha),null,
!1,null,this.MOd,"3",null,!0)&&(5<this.avc&&200>this.avc&&l.ULS.sendTraceTag(578166985,500,15,"FindSession request not scheduled due to expired token. Manually triggered failure callback {0} times.",this.avc),window.setTimeout(()=>{this.avc++;ea("-1")},1E3)))}rLi(Z,ea,ha){ha||(ha={});ha.IsNetworkOfflineAfterRequestComplete=this.$f.yRa;ha.IsRequestSucceeded=ea;Z&&(ha.EnqueueTime=Z.oPa,ha.InvokedTime=Z.$H,ha.CompletedTime=Z.aU,Z.Dj&&(ba.RId in Z.Dj&&(ha.CorrelationId=Z.Dj[ba.RId]),ba.I1c in Z.Dj&&(ha[ba.I1c]=
Z.Dj[ba.I1c])));l.ULS.sendTraceTag(38633565,500,ea?50:15,N.RtcUtils.Bgc(ha))}d7i(Z,ea){Z||(Z={});Z.ConnectionState=k.a[this.dUa];ea||this.zm.c7i(1,Z)}R4m(Z){try{var ea=!1,ha=!1,ka=Z.Dj,ua=m.a.aY(Z.request.get_url());if(ka&&ba.Iag in ka){const Ga=ka[ba.Iag].toString().toLocaleLowerCase();ha="true"===Ga;ea="false"===Ga}ka=!1;const Ra=0<=ua.toLocaleLowerCase().indexOf("collab");ha&&!Ra?ka=!0:ea&&Ra&&(ka=!0);if(ka){ea={};ea.HostName=ua;ea.Status=v.a[Z.status];ea.HttpStatus=Z.Se.toString();var sa=Z.request.get_headers();
for(let Ga in sa){var Da=sa[Ga];(ua=Ga)&&0<ua.length&&(ha=0,Da&&(ha=Da.toString().length),ea["r_"+ua]=ha)}if(Z.Dj){const Ga=new a.a;Ga.add(ba.RId);Ga.add(ba.I1c);Ga.add(ba.q8c);Ga.add(ba.fTi);Ga.add(ba.eTi);Ga.add(ba.AQi);ba.Suk(ea,Z.Dj,Ga)}ba.Duk(Z.request.get_url(),ea);var Pa=H.a.toJSON(ea);l.ULS.sendTraceTag(559437006,500,15,Pa)}}catch(Ra){l.ULS.sendTraceTag(559437007,500,10,"DomainLandingIncorretDC exception[{0}]",Ra.toString())}}static createInstance(Z,ea,ha,ka,ua,sa,Da,Pa,Ra,Ga,ta,va=null){return ba.Cbl(Z,
ea,ha,ka,ua,sa,Da,Pa,Ra,Ga,ta,va)}static Cbl(Z,ea,ha,ka,ua,sa,Da,Pa,Ra,Ga,ta,va=null){Z=Z||G.a.create().toString();Z=new ba(Z,ea,ha,ka,ua,sa,Da,Pa,Ra,Ga,null,ta,va);Z.init();return Z}static Suk(Z,ea,ha){for(let ka of ha)ka in ea&&(Z[ka]=ea[ka])}static Duk(Z,ea){if(Z){var ha=Z.indexOf("?");if(-1!==ha)for(Z=Z.substr(ha+1).split("&"),ha=0;ha<Z.length;++ha){var ka=Z[ha].split("=");if(2===ka.length){const ua=ka[0];if(ua&&0<ua.length){let sa=0;if(ka=ka[1])sa=ka.length;ea["q_"+ua]=sa}}}}}}ba.n4l=3E3;ba.ibn=
3E5;ba.SZk="1.0";ba.Nri=1E3;ba.RId="X-CorrelationId";ba.RKh="corrid";ba.q8c="RtcErrorCode";ba.I1c="X-OfficeCluster";ba.Iag="X-NewEnv";ba.AQi="X-MSEdge-Ref";ba.eTi="X-OFFICEFD";ba.fTi="X-OfficeFE";Object(D.a)(ba,"FindSessionStrategy",null,[890])},1801:function(D,I,c){c.r(I);D=c(0);var l=c(7),e=c(54),a=c(462),k=c(60),x=c(75);class y{constructor(t){this.messageId=t;this.gfo=(new Date).getTime();this.mKf=new x.a}}Object(D.a)(y,"MessageLatencyDetails",null,[]);c.d(I,"ClientToClientMessageTelemetry",function(){return m});
class m{constructor(t,z,v){this.tMa=null;this.mKe=this.qSe=0;this.Wf=z;this.t7g=v;this.bDc=!1;this.zm=t;this.zm.T3(Object(e.a)(this,this.FQn,"receiveMessage"))}start(){if(this.t7g&&!this.bDc){const t=this.Wf.Cgj;this.mKe=this.Wf.xgj;t<=this.mKe?(l.ULS.sendTraceTag(570975114,500,15,"LogMetrics cannot be started because configuration values are incorrect. RtcSendTelemetryMessageIntervalInMS({0}) should be greater than RtcLogClientMessageMetricsTimeOutInMs({1})",this.Wf.Cgj,this.Wf.xgj),this.t7g=!1):
(this.bDc=!0,this.qSe=window.setInterval(Object(e.a)(this,this.sendMessage,"sendMessage"),t))}}sendMessage(){if(this.bDc){const t=k.a.create().toString();this.tMa=new y(t);this.zm.D5f(16,t,!1,new a.a);window.setTimeout(()=>{this.D6m(t)},this.mKe)}}D6m(t){this.tMa&&this.tMa.messageId===t&&(0<this.tMa.mKf.count?(t=this.tMa.mKf.toArray().join(","),l.ULS.sendTraceTag(571339719,500,15,"ClientMessageLatencies:[{0}]",t)):l.ULS.sendTraceTag(562312150,500,50,"No client message latencies recorded"),this.tMa=
null)}stop(){this.qSe&&(window.clearInterval(this.qSe),this.bDc=!1)}FQn(t,z){16===z.type?this.zm.D5f(17,z.NL,!1,new a.a):17===z.type&&this.bDc&&z.NL&&this.processMessage(z.NL)}processMessage(t){t&&this.tMa&&t.toString()===this.tMa.messageId&&(t=(new Date).getTime()-this.tMa.gfo,this.tMa.mKf.add(t))}static get instance(){return m._instance}static t$b(t,z,v){return m.instance||(m._instance=new m(t,z,v))}}m._instance=null;Object(D.a)(m,"ClientToClientMessageTelemetry",null,[])},1895:function(D,I,c){c.d(I,
"a",function(){return l});D=c(0);class l extends Sys.EventArgs{constructor(e,a){super();this.Zra=e;this.vLd=a}}Object(D.a)(l,"PresenceUpdatedEventArgs",Sys.EventArgs,[])},1896:function(D,I,c){c.r(I);c.d(I,"RealtimeChannelMetrics",function(){return x});D=c(0);var l=c(7),e=c(201),a=c(85),k=c(1532);class x{constructor(){this.$8g=this.a9g=this.b9g=this.W8g=this.V8g=this.X8g=this.Yzc=this.$Le=0;this.zLa=this.iJe=this.vyc=this.VIe=this.cYa=this.IIe=this.icb=this.gyc=this.LYb=this.HIe=this.Kld=this.hXb=
null;this.yKe=this.nzc=this.Kfh=this.$Og=0;this.u7g=!1;this.i8i=this.f6f;this.l8i=this.i6f;this.k8i=this.h6f;this.p8i=this.k6f;this.o8i=this.j6f;this.v6f=this.w6f;this.e6c=this.t6f;this.IOb=this.r6f;this.JOb=this.s6f;this.j8i=this.g6f;this.T5a=this.iTf;this.VLb=this.jTf}f6f(){this.$Le++;this.HIe=new Date;this.hXb||(this.hXb=new Date)}i6f(){this.Yzc++;this.icb=new Date;this.Kld||(this.Kld=this.icb);this.vyc=this.icb;this.P3k()}h6f(){this.X8g++;this.IIe=new Date}k6f(){this.V8g++;this.LYb=new Date}j6f(){this.W8g++;
this.gyc=new Date}t6f(){this.cYa=new Date;this.b9g++}s6f(){this.zLa||(this.zLa=new Date);this.a9g++}r6f(){this.VIe=new Date;this.$8g++}w6f(){!this.u7g&&this.$Le&&(l.ULS.sendTraceTag(39321871,500,15,a.a.toJSON(this.F0k())),this.u7g=!0)}g6f(y){let m,t;({Lpi:y,Npi:m,exception:t}=k.RtcUtils.DAl(y));y&&y!==e.a.Zz&&(l.ULS.sendTraceTag(40157596,500,15,a.a.toJSON({["HttpErrorCode"]:y,["HttpErrorStatus"]:m,["Exception"]:t})),e.a.PDf(y)&&this.$Og++,e.a.UHf(y)&&this.Kfh++)}iTf(){this.iJe=new Date}jTf(){this.LYb=
this.vyc=new Date}F0k(){return{["numberOfConnectionAttempts"]:this.$Le,["numberOfSuccessfulConnections"]:this.Yzc,["numberOfFailedConnections"]:this.X8g,["numberOfDisconnectedConnections"]:this.V8g,["numberOfExplicitDisconnectedConnections"]:this.W8g,["numberOfSentMessages"]:this.b9g,["numberOfReceivedMessages"]:this.a9g,["numberOfLostMessages"]:this.$8g,["firstConnectionAttempt"]:this.hXb?this.hXb:null,["firstMessageReceived"]:this.zLa?this.zLa:null,["firstConnectionSuccess"]:this.Kld?this.Kld:null,
["lastConnectionAttempt"]:this.HIe?this.HIe:null,["lastConnectionSuccess"]:this.icb?this.icb:null,["lastConnectionFailure"]:this.IIe?this.IIe:null,["lastMessageSent"]:this.cYa?this.cYa:null,["lastMessageLost"]:this.VIe?this.VIe:null,["lastDisconnect"]:this.LYb?this.LYb:null,["lastExplicitDisconnect"]:this.gyc?this.gyc:null,["lastTimeOnline"]:this.vyc?this.vyc:null,["lastTimeOffline"]:this.iJe?this.iJe:null,["maxDisconnectedTimeMs"]:this.nzc,["maxExplicitDisconnectedTimeMs"]:this.yKe,["clientConnectionErrors"]:this.$Og,
["serverConnectionErrors"]:this.Kfh}}P3k(){this.hXb&&1===this.Yzc&&(this.nzc=Math.max(this.nzc,this.icb.getTime()-this.hXb.getTime()));this.LYb&&1<this.Yzc&&(this.nzc=Math.max(this.nzc,this.icb.getTime()-this.LYb.getTime()));this.gyc&&1<this.Yzc&&(this.yKe=Math.max(this.yKe,this.icb.getTime()-this.gyc.getTime()))}static createInstance(y){x._instance||(x._instance=new x,l.ULS.sendTraceTag(39321870,500,50,"RealtimeChannelMetrics initialized for client {0}",y));return x._instance}}x._instance=null;Object(D.a)(x,
"RealtimeChannelMetrics",null,[891,238])},1897:function(D,I,c){c.d(I,"a",function(){return l});D=c(0);class l extends Sys.EventArgs{constructor(e,a){super();this.type=e;this.Zra=a}}Object(D.a)(l,"PersistentStateUpdateEventArgs",Sys.EventArgs,[])},1898:function(D,I,c){c.d(I,"a",function(){return l});D=c(0);class l extends Sys.EventArgs{constructor(e){super();this.DGd=e}}Object(D.a)(l,"PersistentStateClearedEventArgs",Sys.EventArgs,[])},2095:function(D,I,c){c.r(I);var l=c(0),e=c(54);class a{constructor(Ca,
zb){this.Sfa=null;this.gBc=Ca;this.tfk=zb}init(){this.gBc.continueWith(()=>{this.Sfa=this.gBc.result;this.Sfa.O2b(Object(e.a)(this,this.Kda,"onUsersUpdated"))})}Kda(){a.Y2e(this.Sfa.h2a())&&(this.Sfa.V8f(Object(e.a)(this,this.Kda,"onUsersUpdated")),this.tfk.IsRealCoauthSession=!0)}get iTm(){return this.Sfa?a.Y2e(this.Sfa.h2a()):!1}static Y2e(Ca){let zb=null;for(const pc of Ca)if(pc)if(Ca=pc.isAnonymous||!pc.email?pc.clientId:pc.email.toUpperCase(),!zb)zb=Ca;else if(zb!==Ca)return!0;return!1}}Object(l.a)(a,
"CoauthTelemetry",null,[731]);var k=c(7),x=c(462),y=c(69),m=c(2),t;(function(Ca){Ca[Ca.badStatePreventedTelemetry=0]="badStatePreventedTelemetry";Ca[Ca.notImplemented=1]="notImplemented";Ca[Ca.renderHandled=2]="renderHandled";Ca[Ca.renderHandledWithVeto=3]="renderHandledWithVeto"})(t||(t={}));Object(l.b)("CoauthorGalleryTelemetryEndResult",t);var z=c(86),v=c(85),H=c(131);class F{constructor(Ca,zb,pc,Dc,dc,he,Rc,qe,bf){this.$ah=this.vPg=this.ED=null;this.y6=Ca;this.Sxd=new x.a;this.Ca=pc;this.Bwe=
zb;this.BZ=Dc;this.Vf=dc;this.uOe=he;this.adb=Rc;this.tWj=qe;this.BYg=this.uYg=!1;this.kzd=0;this.tPg=1;this.ktb=bf;this.ZEc=this.Ca.$("PeoplesWellExtraButtonInfoIsEnabled");this.Uea=Object(y.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get Yvj(){return this.Sxd.task}init(){H.Task.WAA.call(null,this.adb,this.Bwe,this.uOe).continueWith(()=>{this.ED=this.adb.result;this.vPg=this.Bwe.result;this.$ah=this.uOe.result;H.Task.WAA.call(null,this.Bwe.result.V4b,this.uOe.result.Hzj).continueWith(()=>
{this.tPg=this.vPg.V4b.result;this.kzd=this.$ah.Hzj.result;this.ED.O2b(Object(e.a)(this,this.d9d,"onUsersUpdatedEventListener"));this.ED.h2a().length&&this.Kda()})})}d9d(){this.Kda()}Kda(){this.tWj(this.ED.h2a())?(this.ED.V8f(Object(e.a)(this,this.d9d,"onUsersUpdatedEventListener")),this.Aon(this.uYg)):this.Sxd.vS(1);this.uYg=!0}Aon(Ca){this.BYg?this.Yvj.continueWith(()=>{k.ULS.sendTraceTag(42062996,325,15,"We already attempted to log a render of coauthor gallery: {0}",t[this.Yvj.result])}):(this.BYg=
!0,this.XJn(0===this.tPg&&!Ca))}XJn(Ca){Ca?this.BZ.pk(4,Object(e.a)(this,this.jXf,"onInteractiveReady")):this.Sxd.vS(1)}jXf(){const Ca=this.Vf.pF("AppInitStatus_interactivityReady");k.ULS.shipAssertTag(42259235,325,!!this.kzd);const zb=this.kzd-Ca,pc={};pc.InteractiveTime=Ca;pc.ReactRenderComplete=this.kzd;pc.HadTabSwitch=this.ktb();pc.IsModernGallery=this.ZEc;k.ULS.sendTraceTag(594883104,325,50,v.a.toJSON(pc));this.ZEc?(k.ULS.sendTraceTag(42062997,325,15,zb.toString()),this.Sxd.vS(this.m3o(zb)?3:
2)):k.ULS.sendTraceTag(594883103,325,15,zb.toString())}m3o(Ca){const zb=Ca>this.Ca.mc("CoauthorGalleryTimeToRenderDurationMs",1E4),pc="Word"===this.Uea;if(this.ktb())return k.ULS.sendTraceTag(50455714,325,50,zb.toString()),!1;pc&&z.Health.instance.recordKpiUsage("CoauthGalleryExperienceDegraded",0,"wordcollabrel",null);zb&&(pc&&z.Health.instance.recordKpiFailure("CoauthGalleryExperienceDegraded","CoauthorGalleryTimeToRenderDurationIsTooLong",!1,!0,null),k.ULS.sendTraceTag(42062998,325,15,Ca.toString()));
return zb}}Object(l.a)(F,"CoauthorGalleryTelemetry",null,[730]);class G{constructor(Ca){this.ED=null;this.fid={};this.Vtd={};this.Uwc=null;this.adb=Ca}STd(Ca){const zb=new x.a;this.init().continueWith(()=>{Ca in this.fid?zb.vS(this.fid[Ca]):this.Vtd[Ca]=zb});return zb.task}init(){if(this.Uwc)return this.Uwc.task;this.Uwc=new x.a;this.adb.continueWith(()=>{this.ED=this.adb.result;this.ED.O2b(Object(e.a)(this,this.Kda,"onUsersUpdated"));this.xHj();this.Uwc.Dg(null)});return this.Uwc.task}xHj(){const Ca=
this.ED.h2a();Ca.sort(Object(e.a)(this,this.n3k,"comparePresenceUsers"));this.fid={};for(let zb=0;zb<Ca.length&&Ca[zb]&&Ca[zb].VRa;zb++)this.vuk(this.fid,Ca[zb].clientId,zb)}vuk(Ca,zb,pc){Ca[zb]=pc;zb in this.Vtd&&(this.Vtd[zb].vS(pc),delete this.Vtd[zb])}Kda(){this.xHj()}n3k(Ca,zb){return Ca.VRa>zb.VRa?1:Ca.VRa<zb.VRa?-1:0}}Object(l.a)(G,"CoauthorPositionFinder",null,[729]);var M=c(596),K=c(359),L=c(503),R=c(75),S=c(139);class N{constructor(){this.QCa=null;this.Lrc=Array(32)}xor(Ca){if(!Ca)throw Error.argumentNull("Guid argument cannot be null");
const zb=new N,pc=new Sys.StringBuilder;for(let Dc=0;Dc<Ca.Lrc.length;Dc++){const dc=this.Lrc[Dc]^Ca.Lrc[Dc];zb.Lrc[Dc]=dc;pc.append(dc.toString(16));7!==Dc&&11!==Dc&&15!==Dc&&19!==Dc||pc.append("-")}zb.QCa=S.a.If(pc.toString());return zb}toString(){return this.QCa.toString()}equals(Ca){if(!Ca)throw Error.argumentNull("Guid argument cannot be null");return this.QCa.equals(Ca.QCa)}static $8b(Ca){if(!Ca)throw Error.argumentNull("String input cannot be null");const zb=new N;zb.QCa=S.a.If(Ca);const pc=
zb.QCa.toString();let Dc=0;for(let he=0;he<pc.length;he++){var dc=Ca.charAt(he);if(N.fOm(dc))dc=N.num(dc,Ca.charCodeAt(he)),zb.Lrc[Dc++]=dc;else if(!N.BNm(dc))throw Error.argument("String contains characters not valid in Guids");}return zb}static fOm(Ca){return"0"<=Ca&&"9">=Ca||"A"<=Ca&&"F">=Ca||"a"<=Ca&&"f">=Ca}static BNm(Ca){return"{"===Ca||"}"===Ca||"-"===Ca}static num(Ca,zb){if("0"<=Ca&&"9">=Ca)return zb-48;if("A"<=Ca&&"F">=Ca)return zb-65+10;if("a"<=Ca&&"f">=Ca)return zb-97+10;throw Error.argument("Char is not valid hex digit");
}}Object(l.a)(N,"Guid",null,[]);class O{constructor(Ca,zb,pc,Dc){this.Sfa=null;this.PRg=this.a8g=!1;this.a5g=0;this.gBc=Ca;this.WUe=zb;this.Ca=pc;this.tZb=Dc;this.OVj=m.AFrameworkApplication.rTb||m.AFrameworkApplication.bqa;this.j6g=new M.a(K.a.ih())}get ldf(){return this.Ca.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1)}init(){this.gBc.continueWith(()=>{this.Sfa=this.gBc.result;this.Sfa.O2b(Object(e.a)(this,this.Kda,"onUsersUpdated"))})}Kda(){this.C0k(this.Sfa.h2a())}C0k(Ca){var zb=
0;const pc=new L.a(K.a.ih());for(const Dc of Ca)if(Dc&&Dc.isAnonymous){m.AFrameworkApplication.oe("70eb6120;2gfeb930");if(pc.nb(Dc.userName))pc.J(Dc.userName).add(Dc.clientId);else{let dc;pc.add(Dc.userName,(dc=new R.a,dc.add(Dc.clientId),dc))}Dc.clientId!==this.tZb?(zb++,2<=zb&&!this.a8g&&this.I6m()):!this.PRg&&this.ldf&&"Guest"===Dc.userName&&(k.ULS.sendTraceTag(509726851,302,50,"User was assigned 'Guest' name"),this.PRg=!0)}if(this.ldf&&this.a5g!==zb){k.ULS.sendTraceTag(512553562,302,50,"Total guests updated to: {0}",
zb+(this.OVj?1:0));this.a5g=zb;for(let Dc of pc.keys)2<=pc.J(Dc).count&&(Ca=this.AWl(pc.J(Dc)),this.j6g.contains(Ca)||(zb={},zb.guestsWithSameName=pc.J(Dc).count,zb.identifier=Ca,k.ULS.sendTraceTag(526394833,302,50,"Duplicate guest friendly name detected: {0}",zb),this.j6g.add(Ca)))}}I6m(){k.ULS.sendTraceTag(525112603,302,50,"Multiple guests simultaneously coauthoring");this.a8g=!0;this.ldf&&this.WUe&&this.WUe.continueWith(()=>{window.setTimeout(()=>{this.WUe.result.logActivity("MultipleGuestsCoauthoring",
null)},15E3)})}AWl(Ca){if(!Ca||1>=Ca.count)return"";let zb=N.$8b(Ca.J(0));for(let pc=1;pc<Ca.count;pc++)zb=zb.xor(N.$8b(Ca.J(pc)));return zb.toString()}}Object(l.a)(O,"GuestCoauthTelemetry",null,[]);var W=c(249);class V{constructor(){this.id=null;this.d=this.tp=this.mp=this.st=this.et=0;this.ct=null;this.vc=!1}}Object(l.a)(V,"PL",null,[]);var Q=c(34);class Y{constructor(){this.ct=this.vt=this.d=0}static Zjj(Ca,zb,pc){const Dc=new Y;Dc.d=Ca;Dc.vt=zb;Dc.ct=pc;return Q.c(Dc)}}Object(l.a)(Y,"VD",null,
[]);var ba=c(117);class Z{constructor(Ca,zb,pc,Dc,dc,he,Rc,qe,bf,Cf,bh){this.Tfh=!1;this._id=Ca;this.ki=zb;this.Fhh=pc;this.ys=Dc;this.sLe=dc;this.MVe=he;this.oAb=Rc;this.aub=qe;this.aZj=bf;this.ktb=Cf;this.glh=bh;this.Uea=Object(y.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||""}spe(Ca){const zb=[this.sLe,this.MVe];this.glh&&zb.push(this.Fhh);H.Task.WAA.apply(null,zb).continueWith(()=>{if(this.sLe.result<=this.MVe.result)Ca.vS(!1);else{this.glh&&(this.ki=this.Fhh.result);
var pc=this.ys-this.ki,Dc=new V;Dc.id=this._id;Dc.et=this.ys;Dc.st=this.ki;Dc.d=this.ys-this.ki;Dc.mp=this.sLe.result;Dc.tp=this.MVe.result;Dc.ct=this.GRl(this.aZj);Dc.vc=this.ktb();var dc=Q.c(Dc),he="Word"===this.Uea,Rc="PowerPoint"===this.Uea;k.ULS.sendTraceTag(42078597,302,15,dc);if(he){const qe=new Map;qe.set("data",dc);z.Health.instance.recordKpiUsage("PresenceExperienceDegraded",0,"wordcollabrel",qe)}pc>this.oAb.value&&!this.Tfh&&!Dc.vc&&(this.Tfh=!0,Ca.vS(!0),Dc=Object.assign(new ba.a,{inStaging:!0,
extendedProperties:new Map}),Dc.extendedProperties.set("data",dc),he&&z.Health.instance.recordKpiFailure("PresenceExperienceDegraded","PresenceRenderDurationIsTooLong",!1,!0,Dc),pc<this.aub.value&&(k.ULS.sendTraceTag(42078598,302,15,Y.Zjj(pc,this.oAb.value,this.aub.value)),pc=m.AFrameworkApplication.K.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.PPTClientThumbnailPresenceRenderLatencyQoSError"),Rc&&pc&&z.Health.instance.recordQosError("PresenceRenderDurationIsTooLong",["PresenceExperienceDegraded"],
!1,!0,!0,!1,Dc)));Ca.task.isCompleted||Ca.vS(!1)}})}GRl(Ca){switch(Ca){case 2:return"NonWac";case 0:return"Unknown";case 1:return"Wac";default:return"Unknown"}}}Object(l.a)(Z,"PresenceLatencyActivityLogger",null,[]);class ea{constructor(Ca,zb,pc){this.jOg=this.rPg=this.Lhd=this.eid=this.yUb=0;this._id=Ca;this.oAb=zb;this.aub=pc;this.Uea=Object(y.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get ssh(){return this.yUb}set ssh(Ca){this.yUb=Ca;this.D7e()}get dGh(){return this.eid}set dGh(Ca){this.eid=
Ca;this.D7e()}get gCh(){return this.Lhd}set gCh(Ca){this.Lhd=Ca;this.D7e()}get eGh(){return 0!==this.rPg}get hCh(){return 0!==this.jOg}D7e(){!this.eGh&&this.yUb&&this.eid&&(this.rPg=this.spe(this.eid,"CoauthGalleryLightupDurationTooLong"));!this.hCh&&this.yUb&&this.Lhd&&(this.jOg=this.spe(this.Lhd,"CanvasPresenceLightupDurationTooLong"))}spe(Ca,zb){const pc=Ca-this.yUb;var Dc=new V;Dc.id=this._id;Dc.et=Ca;Dc.st=this.yUb;Dc.d=pc;var dc=Q.c(Dc),he="Word"===this.Uea;Ca="PowerPoint"===this.Uea;Dc="CanvasPresenceLightupDurationTooLong"===
zb?"PresenceExperienceDegraded":"CoauthGalleryExperienceDegraded";"CanvasPresenceLightupDurationTooLong"===zb?k.ULS.sendTraceTag(572289499,302,15,dc):k.ULS.sendTraceTag(571524118,302,15,dc);if(he){var Rc=new Map;Rc.set("data",dc);z.Health.instance.recordKpiUsage(Dc,0,"wordcollabrel",Rc)}return pc>this.oAb.value?(Rc=Object.assign(new ba.a,{inStaging:!0,extendedProperties:new Map}),Rc.extendedProperties.set("data",dc),dc=pc<this.aub.value,Rc.extendedProperties.set("cash",dc?"true":"false"),he&&z.Health.instance.recordKpiFailure(Dc,
zb,!1,!0,Rc),he=m.AFrameworkApplication.K.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.PPTClientRenderLatencyQoSError"),Ca&&he&&z.Health.instance.recordQosError(zb,[Dc],!1,!0,!0,!1,Rc),k.ULS.sendTraceTag(572289500,302,15,Y.Zjj(pc,this.oAb.value,this.aub.value)),dc?2:1):3}}Object(l.a)(ea,"PresenceLightupLatencyLogger",null,[]);var ha=c(49),ka=c(171);class ua{constructor(Ca,zb,pc,Dc,dc,he,Rc,qe=null,bf=null,Cf=null){this.fch={};this.Awe={};this.F3g=new R.a;this.thd=this.Vwc=this.ED=
this.kj=null;this.bUe=this.ZTe=0;this.oAb=new W.a(()=>qe.xU("PresenceBootLatencyThreshold",1E4));this.aub=new W.a(()=>qe.xU("PresenceBootLatencyCutoffThreshold",6E4));this.Mok=new W.a(()=>qe.xU("PresenceLightupLatencyThreshold",2E3));this.f0j=new W.a(()=>qe.xU("PresenceLightupLatencyCutoffThreshold",1E4));this.BZ=Dc;this.Ca=qe;this.Afk=dc;this.uPg=Ca;this.Feh=zb;this.adb=pc;this.Vf=he;this.tZb=bf;this.ktb=Rc;this.JYg=Cf;this.Pue=!1;this.init()}lNc(Ca,zb,pc=null,Dc=0){pc&&(k.ULS.shipAssertTag(42274970,
302,!this.tZb||this.tZb===pc,"_myClientId is already set and you are trying to update it to something different"),this.tZb=pc);const dc=new x.a;this.init().continueWith(()=>{this.tsn(Ca);this.Zvl(dc,Ca,zb,Dc)})}get TSf(){return this.tZb||"{"+m.AFrameworkApplication.userSessionId+"}"}init(){if(this.Vwc)return this.Vwc.task;this.Vwc=new x.a;this.ktb()&&k.ULS.sendTraceTag(50951700,302,15,"TabSwitched Session");this.uPg.continueWith(()=>{const Ca=this.uPg.result,zb=Ca.V4b,pc=Ca.Qen;pc.continueWith(()=>
{zb.continueWith(()=>{this.JYg&&this.JYg.addQosPillar("RealTimeCoauth");this.sjg(zb.result,pc.result);this.Vwc.Dg(null)})})});this.Feh.continueWith(()=>{this.kj=this.Feh.result;this.kj.Iua(Object(e.a)(this,this.Jtn,"onRtcConnection"));this.kj.T3(Object(e.a)(this,this.xmn,"onCoauthorBootReceived"))});this.adb.continueWith(()=>{this.ED=this.adb.result;this.ED.O2b(Object(e.a)(this,this.d9d,"onUsersUpdatedEventListener"));0<this.ED.h2a().length&&this.Kda()});return this.Vwc.task}Z6h(){return this.Vf.Pga(ha.a.A9a)?
this.Vf.pF(ha.a.A9a):ka.a.Cfb?window.performance.timing.fetchStart:-1}fbi(){this.thd||(this.thd=new x.a,this.BZ.pk(4,()=>{this.thd.vS(this.Vf.pF("AppInitStatus_interactivityReady"))}));return this.thd.task}Jtn(Ca,zb){if(!this.Pue&&2===zb.newState)if(this.Soe){const pc=this.fbi();pc.continueWith(()=>{var Dc=pc.result;Dc=Date.now()-Dc;const dc={};dc.clientId=this.TSf;dc.bootTime=Dc;this.Pue=!0;this.kj.qN(15,dc)})}else Ca=this.Z6h(),Ca=Date.now()-Ca,zb={},zb.clientId=this.TSf,zb.bootTime=Ca,this.Pue=
!0,this.kj.qN(15,zb)}xmn(Ca,zb){if(15===zb.type){Ca=Date.now();zb=zb.NL;var pc=zb.bootTime;this.asf(zb.clientId).ssh=Ca-pc}}d9d(){this.Kda()}Kda(){const Ca=Date.now();var zb=this.ED.h2a();const pc=new R.a;for(const Dc of zb)this.F3g.contains(Dc.clientId)||(this.F3g.add(Dc.clientId),pc.add(Dc.clientId));if(0<pc.count)for(let Dc of pc)zb=this.asf(Dc),zb.eGh||(zb.dGh=Ca)}tsn(Ca){Ca=this.asf(Ca);Ca.hCh||(Ca.gCh=Date.now())}asf(Ca){return Ca in this.Awe?this.Awe[Ca]:this.Awe[Ca]=new ea(Ca,this.Mok,this.f0j)}sjg(Ca,
zb=0){this.ZTe=Ca;this.bUe=zb?zb:(new Date).getTime()}Zvl(Ca,zb,pc,Dc){pc=pc?pc.getTime():(new Date).getTime();if(zb in this.fch)Ca.Cka();else{const dc=this.Soe?0:this.kfm(),he=this.Soe?this.lfm():null;Dc=new Z(zb,dc,he,pc,this.STd(this.TSf),this.STd(zb),this.oAb,this.aub,Dc,this.ktb,this.Soe);this.fch[zb]=Dc;Dc.spe(Ca)}}kfm(){return 1===this.ZTe?this.bUe:this.Z6h()}lfm(){return 1===this.ZTe?H.Task.A4(this.bUe):this.fbi()}STd(Ca){return this.Afk.STd(Ca)}get Soe(){return this.Ca.$("UseAppInteractiveBootTimeForPresenceTelemetry")}}
Object(l.a)(ua,"PresenceBootTelemetry",null,[728]);var sa=c(133),Da=c(185),Pa=c(235),Ra=c(22),Ga=c(634);class ta{get name(){return"Common.App.CoauthTelemetry"}wc(Ca){Ca.register(a,"Common.App.CoauthTelemetry.CoauthTelemetry").as("Common.App.CoauthTelemetry.ICoauthTelemetry").ha().Ud(()=>new a(Ga.a.Gp(Ca.Ta("Common.IPeopleInfoProvider")),m.AFrameworkApplication.Og));Ca.register(F,"Common.App.CoauthTelemetry.CoauthorGalleryTelemetry").as("Common.ICoauthorGalleryTelemetry").ha().Ud(()=>new F(m.AFrameworkApplication.va,
Ga.a.Gp(Ca.Ta("Common.ICoauthoringTelemeryInfoProvider")),m.AFrameworkApplication.K,sa.a.get_instance(),Pa.a.instance,Ga.a.Gp(Ca.Ta("Common.IPeoplesWell")),Ga.a.Gp(Ca.Ta("Common.IPeopleInfoProvider")),a.Y2e,()=>this.Wyh()));Ca.register(ua,"Common.App.CoauthTelemetry.PresenceBootTelemetry").as("Common.App.CoauthTelemetry.IPresenceBootTelemetry").ha().Ud(()=>new ua(Ga.a.Gp(Ca.Ta("Common.ICoauthoringTelemeryInfoProvider")),Ga.a.Gp(Ca.Ta("Common.IRealtimeChannelBasic")),Ga.a.Gp(Ca.Ta("Common.IPeopleInfoProvider")),
sa.a.get_instance(),Ca.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"),Pa.a.instance,()=>this.Wyh(),m.AFrameworkApplication.K,null,z.Health.instance));Ca.register(G,"Common.App.CoauthTelemetry.CoauthorPositionFinder").as("Common.App.CoauthTelemetry.ICoauthorPositionFinder").ha().Ud(()=>new G(Ga.a.Gp(Ca.Ta("Common.IPeopleInfoProvider"))));Ca.register(O,"Common.App.CoauthTelemetry.GuestCoauthTelemetry").ha().Ud(()=>new O(Ga.a.Gp(Ca.Ta("Common.IPeopleInfoProvider")),Ga.a.Gp(Ca.Ta("Common.ISystemInitiatedFeedback")),
m.AFrameworkApplication.K,"{"+m.AFrameworkApplication.userSessionId+"}"))}init(){m.AFrameworkApplication.K.Nn(()=>{Ra.a.instance.resolve("Common.App.CoauthTelemetry.CoauthTelemetry").init();Ra.a.instance.resolve("Common.App.CoauthTelemetry.GuestCoauthTelemetry").init();m.AFrameworkApplication.K.$("CoauthorGalleryTelemetryIsEnabled")&&Ra.a.instance.resolve("Common.ICoauthorGalleryTelemetry").init();m.AFrameworkApplication.K.$("CashTelemetryIsEnabled")&&(Ra.a.instance.resolve("Common.App.CoauthTelemetry.IPresenceBootTelemetry"),
Ra.a.instance.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"))})}dispose(){}Wyh(){return ka.a.Cfb&&Pa.a.instance.Pga(ha.a.hed)?0<Pa.a.instance.pF(ha.a.hed)[ha.a.tKj]:!1}static main(){Da.a.instance.Gc(new ta)}}Object(l.a)(ta,"CoauthTelemetryPackage",null,[1,2]);class va extends Sys.EventArgs{constructor(){super()}}Object(l.a)(va,"RtcHostNotificationEventArgs",Sys.EventArgs,[]);var ia;(function(Ca){Ca[Ca.notYetStarted=0]="notYetStarted";Ca[Ca.polling=1]="polling";Ca[Ca.subscribed=2]="subscribed";
Ca[Ca.blocked=3]="blocked";Ca[Ca.permanentlyStopped=4]="permanentlyStopped"})(ia||(ia={}));Object(l.b)("RtcHostNotificationSubscriptionState",ia);var qa=c(93),pa=c(1432),Fa=c(81);class za{constructor(Ca,zb,pc,Dc,dc,he,Rc,qe,bf){this.Oh=!1;this.mba=this.t_b=this.gga=this.mZa=null;this.RDc=za.tse;this.sa=new Fa.a;this.$db=new pa.a(0);this.$db.D0e(Object(e.a)(this,this.Sun,"onStateMachineChanged"));this.jik=Ca;this.iwd=zb;this.iik=pc;this.qRe=Dc;this.Ib=dc;this.rf=he;Rc.execute(Cf=>{this.Oh||(this.t_b=
Cf,this.t_b.T3(Object(e.a)(this,this.m1,"onUpdateNotificationReceived")),this.start())});qe.execute(Cf=>{this.Oh||(this.mba=Cf,Cf.A_a(Object(e.a)(this,this.fja,"onTokenRefreshed")))});this.hzd=bf}get Jmc(){return this.$db.currentState}get NCi(){return!this.rf||this.rf.Yxa}get iDi(){return 2===this.Jmc&&this.hzd()<this.RDc}start(){0!==this.Jmc?k.ULS.sendTraceTag(573100178,502,15,"HostNotifications: Tried starting poll when in state {0}",ia[this.Jmc]):(this.$db.event(1),this.pcg(null))}pcg(){this.mZa=
null;if(this.NCi){k.ULS.sendTraceTag(573100181,502,50,"HostNotifications: Send event when connected.  Current state: {0}",ia[this.Jmc]);let Ca=null;this.qRe&&this.qRe.length&&(Ca={},Ca.etts=this.qRe);this.t_b.qN(14,Ca,!0);this.Rhj(this.jik)}else this.$db.event(3)}Rhj(Ca){this.mZa=qa.a.B8(1E3*Ca,Object(e.a)(this,this.pcg,"sendSubscribeEvent"),this.iwd,192,"RtcHostNotificationSubscribe");this.Ib.Wb(this.mZa)}ybo(Ca){Ca=1E3*(Ca+this.iik);const zb=this.hzd().getTime()+Ca;this.RDc=new Date(zb);Ca-=this.iwd;
this.gga?this.Ib.A1(this.gga,Ca):(this.gga=qa.a.B8(Ca,Object(e.a)(this,this.HNo,"transitionToPollingEvent"),this.iwd/2,194,"RtcHostNotificationTransitionToPolling"),this.Ib.Wb(this.gga))}HNo(){this.gga=null;2===this.Jmc&&(this.$db.event(1),k.ULS.shipAssertTag(573100185,502,!!this.mZa,"Missing task to ensure that we re-subscribe."))}fja(){this.Wnm()}Wnm(){3===this.Jmc&&this.NCi&&(this.$db.event(this.iDi?2:1),this.pcg(null))}m1(Ca,zb){if(13===zb.type&&(Ca=zb.NL,k.ULS.sendTraceTag(573100183,502,50,"HostNotifications: Subscription status: {0}",
{["SerializableHostNotificationSubscription"]:Ca,["DurationBeforeExpirationToResubscribeInSec"]:this.iwd}),zb=Ca.cts,!this.qQo(zb))){if(Ca.sb){var pc=2;this.ybo(Ca.cts)}else pc=1,this.RDc=za.tse,this.gga&&(this.Ib.ff(this.gga),this.gga=null);this.$db.event(pc);this.mZa?this.Ib.A1(this.mZa,1E3*zb):this.Rhj(zb)}}qQo(Ca){if(!isNaN(Ca)&&isFinite(Ca)&&0<Ca)return!1;this.mwj(!1);return!0}mwj(Ca){this.mZa&&(this.Ib.ff(this.mZa),this.mZa=null);this.gga&&(this.Ib.ff(this.gga),this.gga=null);this.t_b&&(this.t_b.ePb(Object(e.a)(this,
this.m1,"onUpdateNotificationReceived")),this.t_b=null);this.mba&&(this.mba.cPb(Object(e.a)(this,this.fja,"onTokenRefreshed")),this.mba=null);Ca||this.$db.event(4)}Sun(Ca,zb){Ca=zb.newState;const pc=zb.G2f,Dc={};Dc.NewState=ia[Ca];Dc.PreviousState=ia[pc];Dc.PreviousStateHits=zb.H2f;Dc.PreviousStateTransitionTime=zb.I2f.toISOString();Dc.IsSubscribed=this.iDi;this.RDc!==za.tse&&(Dc.SubscriptionExpiringTime=this.RDc.toISOString());k.ULS.sendTraceTag(572346515,502,4===Ca?15:50,"HostNotificationChanged: {0}",
Dc);this.sa.raiseEvent("HN",new va(pc,Ca))}dispose(){this.Oh||(this.Oh=!0,this.mwj(!0),this.gga&&(this.Ib.ff(this.gga),this.gga=null))}}za.tse=new Date(0);Object(l.a)(za,"RtcHostNotificationSubscriptionManager",null,[723,9]);var Oa=c(399);class xa{constructor(){this.Zh=this.Oh=!1}get name(){return"RtcHostNotificationSubscription"}wc(Ca){Ca.register(za,"Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").as("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager").ha().Ud(()=>
{const zb=m.AFrameworkApplication.K;return new za(zb.mc("RtcHostNotificationRetryIntervalIdeallyInSeconds",1800),zb.mc("RtcHostNotificationRetryIntervalBufferInSeconds",120),zb.mc("RtcHostNotificationSubscriptionLostBufferInSeconds",60),this.Xcm(zb),m.AFrameworkApplication.lc,Oa.SessionStatusManager.instance,Ca.Ta("Common.IRealtimeChannelBasic"),Ca.Ta("Common.ISessionExpirationManager"),()=>new Date)})}init(){m.AFrameworkApplication.K.Nn(()=>{!this.Oh&&m.AFrameworkApplication.K.$("RtcHostNotificationEnabled")&&
(this.Zh=!0,Ra.a.instance.resolve("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager"))})}dispose(){this.Oh||(this.Oh=!0,this.Zh&&Ra.a.instance.resolve("Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").dispose())}Xcm(Ca){return Ca.rw("RtcEventTypesToSubscribe")?Ca.DB("RtcEventTypesToSubscribe"):null}static main(){Da.a.instance.Gc(new xa)}}Object(l.a)(xa,"RtcHostNotificationSubscriptionPackage",null,[1,2]);var fa=c(470),Ka=c(647);
class lb{constructor(Ca,zb,pc,Dc,dc,he,Rc,qe,bf,Cf,bh){this.clientId=Ca;this.SkypeChatThreadId=pc;this.chatThreadDiscoveryUri=Dc;this.inChat=dc;this.localColbaltSessionId=zb;this.capabilities=he;this.email=Rc;this.isReadOnly=qe;this.userName=bf;this.isAnonymous=Cf;this.presenceStatus=bh}}Object(l.a)(lb,"SerializablePresenceUserData",null,[]);class Xa extends fa.a{constructor(Ca,zb,pc,Dc,dc=null,he=null,Rc=null,qe=null,bf=null,Cf=!1,bh=!1,Lg=!1,Th=null){super(Ca,zb,pc,Dc,he,Rc,qe,bf,Cf,bh,Lg);this.zP=
dc;this.presenceStatus=Th}getData(){return new lb(this.clientId,this.zP,this.qIc,this.chatThreadDiscoveryUri,this.inChat,this.capabilities.capabilities,this.email,this.isReadOnly,this.userName,this.isAnonymous,this.presenceStatus)}TTd(Ca){return(Ca=Ca.value)?Ca.user:null}clone(){return new Xa(this.clientId,this.userName,this.color,this.capabilities.clone(),this.zP,this.qIc,this.email,this.client,this.chatThreadDiscoveryUri,this.isAnonymous,this.inChat,this.isReadOnly,this.presenceStatus)}static dDb(Ca){return Ca.clientId?
new Xa(Ca.clientId,Ca.userName,null,new Ka.a(void 0===Ca.capabilities?0:Ca.capabilities),Ca.localColbaltSessionId,Ca.SkypeChatThreadId,Ca.email,null,Ca.chatThreadDiscoveryUri,Ca.isAnonymous,Ca.inChat,Ca.isReadOnly,Ca.presenceStatus):null}static oMh(Ca,zb,pc,Dc=null,dc=null,he=null,Rc=null,qe=null,bf=!1,Cf=!1,bh=!1,Lg=null){return Ca?new Xa(Ca,zb,null,new Ka.a(void 0===pc?0:pc),Dc,dc,he,Rc,qe,bh,bf,Cf,Lg):null}}Object(l.a)(Xa,"PresenceUser",fa.a,[1209,1210,23]);class kb extends Xa{constructor(){super();
this.wic=this.JMf=null}G5l(){const Ca=m.AFrameworkApplication.userName,zb=m.AFrameworkApplication.K.kb("UserPrincipalName"),pc=this.JMf?this.JMf.zP:null,Dc=m.AFrameworkApplication.rTb||m.AFrameworkApplication.bqa,dc=this.wic?this.wic.getStatus():null;return new Xa(this.clientId,Ca,this.color,this.capabilities,pc,this.qIc,zb,this.client,this.chatThreadDiscoveryUri,Dc,this.inChat,this.isReadOnly,dc)}}Object(l.a)(kb,"MyPresenceUser",Xa,[1275,23]);var Bb=c(219);class Ja{constructor(Ca,zb,pc,Dc,dc){this.Wf=
Ca;this._clientId=zb;this.h1j=dc;this.d5j=pc||(()=>null);this.e5j=Dc||(()=>null)}get id(){return this.Wf.id}get dBd(){return this.Wf.dBd}get hBd(){return this.Wf.hBd}get gBd(){return this.Wf.gBd}get fBd(){return this.Wf.fBd}get eBd(){return this.Wf.eBd}get jBd(){return this.Wf.jBd}get aZe(){return this.Wf.aZe}get kmc(){return this.Wf.kmc}get Nje(){return this.Wf.Nje}get C5d(){return this.Wf.C5d}get clientId(){return this._clientId}get kSc(){return this.d5j}get Ejb(){return this.e5j}get cql(){return this.h1j}static createInstance(Ca,
zb,pc,Dc,dc=!1){return new Ja(Ca,zb,pc,Dc,dc)}}Object(l.a)(Ja,"PeoplesWellSettings",null,[]);var Ma=c(10),fb=c(67),hc=c(176),cc=c(109),mb=c(208),Hb=c(164),Ua=c(401),Ya=c(340);class Fb extends mb.a{constructor(){super();this.JoinTimeInMS=0;this.IsAnonymous=!1;this.ImageUrl=null;this.CanJump=this.ActiveStatus=!1;this.Upn=null}get ControlType(){return 5}}Object(l.a)(Fb,"PeopleButtonProps",mb.a,[]);var Wa=c(413),yb=c(19),Yb=c(83);class qc{constructor(Ca){this.ied=new Yb.a;this.kdf=null;this.clientId=
Ca}mpo(Ca){this.wZn();this.Iho(Ca);for(const zb of Ca)zb.clientId!==this.clientId&&this.tqh(zb)}get drg(){const Ca=[];for(let zb of this.ied.values){const pc=this.Jij(zb);Array.add(Ca,pc)}return Ca}get snb(){return this.ied.count}S_e(Ca,zb){Ca=Ca.toUpperCase();let pc;({value:pc}=this.ied.Fc(Ca)).returnValue||(pc=[],this.ied.Z(Ca,pc));Array.add(pc,zb)}wZn(){this.ied=new Yb.a}Iho(Ca){for(const zb of Ca)if(zb.clientId===this.clientId){this.kdf=zb;break}}}Object(l.a)(qc,"UserTracker",null,[1001]);class Hc extends qc{constructor(Ca,
zb){super(Ca);this.f5j=zb}tqh(Ca){Ca.isAnonymous||!Ca.email?this.S_e(Ca.clientId,Ca):this.kdf&&K.a.ih().equals(this.kdf.email,Ca.email)||this.S_e(Ca.email,Ca)}Jij(Ca){let zb=new Date(0),pc=0<Ca.length?Ca[0]:null;for(const Dc of Ca)(Ca=this.f5j(Dc.clientId))&&zb.getTime()<Ca.Rec.getTime()&&(zb=Ca.Rec,pc=Dc);return pc}}Object(l.a)(Hc,"UniqueUserTracker",qc,[]);class $b extends qc{constructor(Ca){super(Ca)}tqh(Ca){this.S_e(Ca.clientId,Ca)}Jij(Ca){return Ca[0]}}Object(l.a)($b,"UserInstanceTracker",qc,
[]);const Ub=(Ca,zb,pc)=>pc?new Hc(Ca,zb):new $b(Ca);var mc=c(70),ic=c(609),ab=c(13);class bb{constructor(Ca,zb=null,pc=null){this.ED=null;this.VVe=new x.a;this.Wf=Ca;this.I$d=zb;pc&&pc.continueWith(()=>{this.ED=pc.result;this.ED.O2b(Object(e.a)(this,this.Kda,"onUsersUpdated"));this.ede()});new fa.a(this.settings.clientId,"Anonymous user","#cccccc",new Ka.a(7));this.oFf=this.KHe=!0;this.xDe=this.tOe=!1;this.tAa=Ub(this.settings.clientId,this.settings.Ejb,Ca.cql)}get settings(){return this.Wf}get HJm(){return m.AFrameworkApplication.K?
m.AFrameworkApplication.K.$("ColorPresenceHashIsEnabled"):!1}get DJm(){return m.AFrameworkApplication.K?m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"):!1}ETl(){let Ca;let zb,pc,Dc,dc;var he=this.FTl();this.tAa.snb?1===this.tAa.snb?(zb=!0,pc=this.settings.kmc.cluster,Dc=this.settings.kmc.RJd,dc=this.tAa.drg[0].color):(zb=!0,pc=this.settings.C5d.cluster,Dc=this.settings.C5d.RJd,dc=""):(zb=!1,dc=Dc=pc="");Ca=he[0];he=he.slice(1);return{byn:Ca,cyn:he,Yxn:zb,Zop:pc,$xn:Dc,Zxn:dc}}FTl(){if(2<=
this.tAa.snb)return[String.format(CommonUIStrings.l_PeoplesWellStateNumberOfOtherPeopleEditingHere,this.tAa.snb)];if(1===this.tAa.snb){const Ca=this.tAa.drg[0],zb=this.settings.Ejb(Ca.clientId);return zb&&2===zb.status?[CommonUIStrings.l_PeoplesWellStateUserIsInactive,Ca.userName]:[Ca.isReadOnly?CommonUIStrings.l_PeoplesWellStateUserIsAlsoViewing:CommonUIStrings.l_PeoplesWellStateUserIsAlsoEditing,Ca.userName]}return[CommonUIStrings.l_PeoplesWellStateYouAreAllByYourself]}ckm(Ca){return this.dkm(Ca)}JBh(Ca,
zb,pc){return zb?this.$Sk(zb)?(Ca=this.settings.Ejb(Ca))&&2===Ca.status?!1:!0:(pc&&k.ULS.sendTraceTag(4482394,325,50,"User has presence data but app can't use it"),!1):(pc&&k.ULS.sendTraceTag(4482393,325,50,"User does not have any presence data"),!1)}sfm(Ca){return Ca.isReadOnly?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOffline:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}dkm(Ca){if(!Ca.capabilities.MFa(1))return this.sfm(Ca);const zb=Ca.isReadOnly,pc=this.settings.Ejb(Ca.clientId);
Ca=this.settings.kSc(Ca.clientId);if(!pc)return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;switch(pc.status){case 1:return Ca?zb?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOnline:this.O7k(Ca)||CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;case 2:return CommonUIStrings.l_PeoplesWellUserStatusIsInactive;default:return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}}S0l(Ca){if(this.I$d.UYc)return this.I$d.tDb(Ca.email,
"O365",m.AFrameworkApplication.em,0)}Ojm(Ca){Ca=this.settings.Ejb(Ca.clientId);return!Ca||Ca&&1===Ca.status?!0:!1}Rjm(Ca){var zb=String.format("buttonPeoplesWellUser-{0}",Ca.clientId),pc=Ca.clientId,Dc=this.ckm(Ca);const dc=Ca.userName,he=Ca.color;var Rc=Object,qe=Rc.assign,bf=new Fb,Cf=this.settings.jBd.toString(),bh=this.settings.Nje.cluster,Lg=this.settings.Nje.RJd,Th=this.a9h(),ak=Ca.isAnonymous,Ih;if(Ih=[dc],Ih.length){var xj=new Sys.StringBuilder("STRARRY@");for(const Uh of Ih)xj.append(Uh?
Uh.length:0),xj.append(","),xj.append(Uh),xj.append(",");Ih=xj.toString().slice(0,-1)}else Ih=null;zb=qe.call(Rc,bf,{Id:zb,Command:Cf,LabelText:"{0}",Image32by32:bh,Image32by32Class:Lg,MenuItemId:pc,CommandValueId:pc,Alt:dc,DisplayMode:Th,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word",Description:Dc,ImageBackColor:he,IsAnonymous:ak,LabelTextUserGeneratedPlaceholderReplacements:Ih,Upn:Ca.email});m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")&&
this.I$d&&(pc=this.S0l(Ca),Dc=this.Ojm(Ca),zb.ImageUrl=pc,zb.ActiveStatus=Dc,zb.JoinTimeInMS=Ca.VRa,Ca=this.JBh(Ca.clientId,this.settings.kSc(Ca.clientId),!1),zb.CanJump=Ca,""===pc&&k.ULS.sendTraceTag(40969413,302,50,"ImageURL collection failed"));return zb}d_l(){return Object.assign(new mb.a,{Id:"BasicChat",Command:"2288458806",LabelText:CommonUIStrings.l_StartGroupChat,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word"})}a9h(){return this.HJm?"Initials":
"Menu32"}Sjm(Ca){const zb=[];for(const pc of Ca)Ca=this.Rjm(pc),Array.add(zb,Ca);return zb}FZd(){return 0<this.tAa.snb}iNn(Ca){if(!this.KHe)return!0;this.oFf||(Ca[ic.a.Visible]=!0);let zb,pc,Dc,dc,he;({byn:zb,cyn:pc,Yxn:Dc,$xn:dc,Zxn:he}=this.ETl());Ca[ic.a.LabelText]=zb;pc&&pc.length&&(Ca[ic.a.LabelTextUserGeneratedPlaceholderReplacements]=pc);Ca[ic.a.ImageIsVisible]=Dc;Ca[ic.a.Image16by16Class]=dc;Ca[ic.a.ImageBackColor]=he;this.KHe=!1;return!0}BEn(Ca){if(0>=this.tAa.snb)return!1;var zb=this.BAo(this.tAa.drg),
pc=this.Sjm(zb);zb=Object.assign(new Ua.a,{Id:"menuCoauthors",MaxWidth:"220px",MenuSectionList:[]});pc=Object.assign(new Ya.a,{Id:"msCoauthors",ControlsId:"msCoauthorsControls",DisplayMode:this.a9h(),ControlList:pc});m.AFrameworkApplication.K.$("WordEditorDisplayPeoplesWellLabelIsEnabled")&&this.I$d&&(pc.Title=CommonUIStrings.l_PeoplesWellFlyoutLabel,pc.TitleId="menuCoauthorsTitle",pc.Theme="Light");Array.add(zb.MenuSectionList,pc);m.AFrameworkApplication.K.$("DocChatIsEnabled")&&m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")&&
m.AFrameworkApplication.ua&&m.AFrameworkApplication.ua.Kb.Ir&&(pc=[],Array.add(pc,this.d_l()),pc=Object.assign(new Ya.a,{Id:"msGroupChat",ControlsId:"msGroupChatControl",ControlList:pc}),Array.add(zb.MenuSectionList,pc));m.AFrameworkApplication.ua&&m.AFrameworkApplication.ua.Kb.Ir?Ca.MenuItems=zb:Ca.PopulationXML=Hb.o(zb);return!0}arg(Ca){k.ULS.sendTraceTag(4482395,325,50,"PeoplesWell: Received user button click");Ca=Ca.MenuItemId;if(!Ca)return!1;const zb=this.settings.kSc(Ca);if(!this.JBh(Ca,zb,
!0))return!1;this.VYm(zb);return!0}gUn(){const Ca=this.JNl();this.tAa.mpo(Ca);this.oFf&&1<=this.tAa.snb&&(k.ULS.sendTraceTag(6092429,325,50,"PeoplesWell: User is no longer forever alone."),this.oFf=!1);this.KHe=!0}Kda(){this.xDe||(window.setTimeout(()=>{this.ede();this.xDe=!1},3E3),this.xDe=!0)}JNl(){let Ca;Ca=this.INl()||[];for(const zb of Ca)this.cao(zb);return Ca}cao(Ca){Ca.clientId||(Ca.clientId=S.a.create().toString());Ca.userName||(Ca.userName="Anonymous user");Ca.capabilities||(Ca.capabilities=
new Ka.a);Ca.color||(Ca.color="#cccccc");Ca.VRa||(Ca.VRa=0)}BAo(Ca){const zb=[];Array.addRange(zb,Ca);zb.sort(bb.Mxn);return zb}zXn(){m.AFrameworkApplication.K.$("CoauthorGalleryTelemetryIsEnabled")&&!this.tOe&&(m.AFrameworkApplication.va.l0(ab.a.pGh)&&Wa.a.isSharedUxGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.DoNotRegisterCoauthorsRenderedMultiplTimes")||m.AFrameworkApplication.va.fb(ab.a.pGh,mc.a.frame,Object(e.a)(this,this.ymn,"onCoauthorGalleryFirstRender"),96));this.AXn();this.tOe=
!0;this.ede()}ymn(Ca,zb,pc,Dc,dc){this.VVe.vS(dc.RenderTime);return 32}get Hzj(){return this.VVe.task}ede(){if(!this.tOe&&(this.VVe.vS((new Date).getTime()),k.ULS.sendTraceTag(42567504,325,50,"We are trying to render the coauthor gallery before we are ready to record the render time"),this.DJm))return;this.gUn();this.hUn()}dispose(){this.ED&&(this.ED.V8f(Object(e.a)(this,this.Kda,"onUsersUpdated")),this.ED=null)}static Mxn(Ca,zb){return Ca.capabilities.MFa(1)&&zb.capabilities.MFa(1)||!Ca.capabilities.MFa(1)&&
!zb.capabilities.MFa(1)?yb.a.localeCompare(Ca.userName,zb.userName):Ca.capabilities.MFa(1)?-1:1}}Object(l.a)(bb,"APeoplesWell",null,[927,9]);var Jb=c(12);const Eb=()=>!0;class hb extends bb{constructor(Ca,zb,pc=null,Dc=null){super(Ca,pc,Dc);this.uKm=(dc,he,Rc,qe,bf)=>this.n3a(Rc,bf,()=>this.FZd(),Eb);this.jNn=(dc,he,Rc,qe,bf)=>this.n3a(Rc,bf,Cf=>this.iNn(Cf),Eb);this.CEn=(dc,he,Rc,qe,bf)=>this.n3a(Rc,bf,Eb,Cf=>this.BEn(Cf));this.u1k=(dc,he,Rc,qe,bf)=>this.n3a(Rc,bf,Eb,Eb);this.t1k=(dc,he,Rc,qe,bf)=>
this.n3a(Rc,bf,Eb,Eb);this.m1o=(dc,he,Rc,qe,bf)=>this.n3a(Rc,bf,Eb,Cf=>this.arg(Cf));this.sCn=(dc,he,Rc,qe,bf)=>this.n3a(Rc,bf,Eb,()=>{this.ede();return!0});this.ga=zb}n3a(Ca,zb,pc,Dc){let dc=!1;switch(Ca){case 1:dc=pc(zb);break;case 2:dc=Dc(zb)}return dc?32:8}AXn(){this.ga.ra(this.settings.dBd,Jb.a.application,this.uKm);this.ga.fb(this.settings.hBd,Jb.a.application,this.jNn,96);this.ga.fb(this.settings.fBd,Jb.a.application,this.u1k,96);this.ga.fb(this.settings.eBd,Jb.a.application,this.t1k,96);this.ga.fb(this.settings.gBd,
Jb.a.application,this.CEn,96);this.ga.ra(this.settings.jBd,Jb.a.application,this.m1o);this.ga.fb(this.settings.aZe,Jb.a.application,this.sCn,96)}}Object(l.a)(hb,"ABox4PeoplesWell",bb,[]);var ob=c(3),Va=c(48),Qb=c(8),Vb=c(26),Sb=c(169);class nb{static isSupported(Ca){for(let zb=0;zb<nb.pxj.length;zb++)if(Ca===nb.pxj[zb])return!0;return!1}}nb.pxj=[1];Object(l.a)(nb,"RTTDataVersion",null,[]);var ac=c(1654);const zc=Ca=>{if("number"!==typeof Ca.RK||"number"!==typeof Ca.DK)return!1;let zb,pc=!1,Dc=!1,
dc=!1;switch(Ca.RK){case 0:Dc=zb=!0;break;case 1:dc=pc=Dc=zb=!0;break;case 2:if(null!=Ca.PE&&"number"!==typeof Ca.PE)return!1;zb=!0;break;case 4:zb=!0;break;case 3:Dc=zb=!0;break;case 5:pc=zb=!0;break;default:return!1}return zb&&("number"!==typeof Ca.PS||"number"!==typeof Ca.TS)||Dc&&("object"!==typeof Ca.OS||!Ca.OS||!ac.validateVersionedCpData(Ca.OS))||pc&&("number"!==typeof Ca.PE||"number"!==typeof Ca.TE)||dc&&("object"!==typeof Ca.OE||!Ca.OE||!ac.validateVersionedCpData(Ca.OE))?!1:!0},Ib=Ca=>{let zb=
"";if("number"!==typeof Ca.I)return{returnValue:!1,jia:"Invalid PacketId Type"};if("number"!==typeof Ca.O)return{returnValue:!1,jia:"Invalid Operation Type"};if("string"!==typeof Ca.A)return{returnValue:!1,jia:"Invalid ClientId Type"};if("object"!==typeof Ca.AN)return{returnValue:!1,jia:"Invalid Anchor Object Type"};if(!Ca.AN)return{returnValue:!1,jia:"Null AnchorObject"};if(!zc(Ca.AN)){let pc;try{pc=Q.c(Ca.AN)}catch(Dc){pc=String.format("Failed to JSON-serialize payload : {0}",Dc)}8E3<pc.length&&
(pc=String.format("Payload exceeds maximum length: {0} > {1}, not logging",pc.length,8E3));zb="Invalid AnchorObject: "+pc+", Client: "+Ca.C;return{returnValue:!1,jia:zb}}return!Ca.O&&Ca.AN.RK?(zb="Invalid RangeKind:"+Ca.AN.RK+" for Caret",{returnValue:!1,jia:zb}):2===Ca.O&&("number"!==typeof Ca.TF||"undefined"!==typeof Ca.TX&&"string"!==typeof Ca.TX||1!==Ca.AN.RK&&Ca.AN.RK)?{returnValue:!1,jia:"Invalid TypingData"}:3!==Ca.O||"object"===typeof Ca.AP&&Ca.AP&&"number"===typeof Ca.AP.TFA&&"number"===
typeof Ca.AP.PN&&"number"===typeof Ca.AP.TN&&2===Ca.AN.RK?6!==Ca.O||"object"===typeof Ca.MP&&Ca.MP&&"number"===typeof Ca.MP.PM&&"number"===typeof Ca.MP.TM&&5===Ca.AN.RK?4!==Ca.O||"object"===typeof Ca.SP&&Ca.SP&&"number"===typeof Ca.SP.PA&&"number"===typeof Ca.SP.TA&&"number"===typeof Ca.SP.PB&&"number"===typeof Ca.SP.TBS&&3===Ca.AN.RK&&(Ca.AN.PS===Ca.SP.PA||Ca.AN.PS===Ca.SP.PB)?7!==Ca.O||"object"===typeof Ca.SPS&&Ca.SPS&&"string"===typeof Ca.SPS.SF&&"boolean"===typeof Ca.SPS.SL?null!=Ca.ISS&&"number"!==
typeof Ca.ISS?{returnValue:!1,jia:"invalid StrictlySequentialId"}:{returnValue:!0,jia:zb}:{returnValue:!1,jia:"Invalid SymbolData"}:{returnValue:!1,jia:"Invalid SplitParaData"}:{returnValue:!1,jia:"Invalid RemoveParaData"}:{returnValue:!1,jia:"Invalid AddParaData"}};var ya=c(1625);class ib{constructor(Ca,zb=null,pc=null){this.V1=this.C_f=this.gmg=null;null!=Ca&&(this.gmg=Ca);null!=zb&&(this.C_f=zb);null!=pc&&(this.V1=pc)}}Object(l.a)(ib,"AddParaData",null,[]);class wb{constructor(Ca=null,zb=null){this.unc=
this.B_f=null;null!=Ca&&(this.B_f=Ca);null!=zb&&(this.unc=zb)}}Object(l.a)(wb,"MergeRemoveParaData",null,[]);class bc{constructor(Ca,zb,pc,Dc,dc,he,Rc=null,qe=null,bf=null,Cf=null,bh=null,Lg=null,Th=0,ak=null){this.rbd=this.text=this.bSb=this.uRb=this.G0c=this.z2b=this.Oka=null;this.packetId=Ca;this.client=pc;this.mt=Dc;this.clientId=zb.toLowerCase();this.PT=dc;this.version=Th;he&&(this.Oka=he);null!=Rc&&(this.bSb=Rc);void 0!==qe&&null!==qe&&(this.text=qe);bf&&(this.z2b=bf);Cf&&(this.G0c=Cf);bh&&
(this.uRb=bh);Lg&&(this.rbd=Lg);this.strictlySequentialId=ak}}Object(l.a)(bc,"RTTData",null,[]);class lc{constructor(Ca=null,zb=null,pc=null,Dc=null){this.fmg=this.A_f=this.cmg=this.z_f=null;null!=Ca&&(this.z_f=Ca);null!=zb&&(this.cmg=zb);null!=pc&&(this.A_f=pc);null!=Dc&&(this.fmg=Dc)}}Object(l.a)(lc,"SplitParaData",null,[]);class Kb{constructor(Ca=null,zb=null){this.Hkg=this.Gkg=null;Ca&&(this.Gkg=Ca);null!=zb&&(this.Hkg=zb)}}Object(l.a)(Kb,"SymbolData",null,[]);class Bc{constructor(Ca,zb=null,
pc=null){null!=Ca&&(this.TFA=Ca);null!=zb&&(this.PN=zb);null!=pc&&(this.TN=pc)}}Object(l.a)(Bc,"SerializableAddParaDataV1",null,[]);class Xc{constructor(Ca=null,zb=null){null!=Ca&&(this.PM=Ca);null!=zb&&(this.TM=zb)}}Object(l.a)(Xc,"SerializableMergeRemoveParaDataV1",null,[]);class vd{}Object(l.a)(vd,"SerializableRTTDataV1",null,[]);class vc{constructor(Ca=null,zb=null,pc=null,Dc=null){null!=Ca&&(this.PA=Ca);null!=zb&&(this.TA=zb);null!=pc&&(this.PB=pc);null!=Dc&&(this.TBS=Dc)}}Object(l.a)(vc,"SerializableSplitParaDataV1",
null,[]);class bd{constructor(Ca=null,zb=null){Ca&&(this.SF=Ca);null!=zb&&(this.SL=zb)}}Object(l.a)(bd,"SerializableSymbolDataV1",null,[]);const Sd=Ca=>{var zb;if(!({jia:zb}=Ib(Ca)).returnValue)return k.ULS.sendTraceTag(9188759,302,15,"Failed to parse RTT packet, InvalidFieldInfo {0}",zb),null;let pc=zb=null,Dc=null,dc=null,he=null,Rc=null,qe=null,bf=null;Ca.WD&&(zb=Ca.WD);null!=Ca.TF&&(pc=Ca.TF);void 0!==Ca.TX&&null!==Ca.TX&&(Dc=Ca.TX);Ca.AP&&(dc=new ib(Ca.AP.TFA,Ca.AP.PN,Ca.AP.TN));Ca.MP&&(he=new wb(Ca.MP.PM,
Ca.MP.TM));Ca.SP&&(Rc=new lc(Ca.SP.PA,Ca.SP.TA,Ca.SP.PB,Ca.SP.TBS));Ca.SPS&&(qe=new Kb(Ca.SPS.SF,Ca.SPS.SL));null!=Ca.ISS&&(bf=Ca.ISS);return new bc(Ca.I,Ca.A,Ca.C,Ca.O,ya.a(Ca.AN),zb,pc,Dc,dc,he,Rc,qe,1,bf)},pd=Ca=>{let zb=Ca;if("number"===typeof zb.V){if(1===zb.V)return Sd(Ca);k.ULS.sendTraceTag(9188758,302,15,"Unsupported Version");return null}let pc=0,Dc=null;for(let dc=0;dc<Ca.length;dc++)zb=Ca[dc],nb.isSupported(zb.V)&&zb.V>pc&&(pc=zb.V,Dc=Ca[dc]);return 1===pc?Sd(Dc):null},Tc=Ca=>{if(Ca){const zb=
new vd;zb.I=Ca.packetId;zb.V=1;zb.A=Ca.clientId;zb.C=Ca.client;zb.O=Ca.mt;zb.AN=ya.c(Ca.PT);Ca.Oka&&(zb.WD=Ca.Oka);null!=Ca.bSb&&(zb.TF=Ca.bSb);void 0!==Ca.text&&null!==Ca.text&&0<Ca.text.length&&(zb.TX=Ca.text);Ca.z2b&&(zb.AP=new Bc(Ca.z2b.gmg,Ca.z2b.C_f,Ca.z2b.V1));Ca.G0c&&(zb.MP=new Xc(Ca.G0c.B_f,Ca.G0c.unc));Ca.uRb&&(zb.SP=new vc(Ca.uRb.z_f,Ca.uRb.cmg,Ca.uRb.A_f,Ca.uRb.fmg));Ca.rbd&&(zb.SPS=new bd(Ca.rbd.Gkg,Ca.rbd.Hkg));zb.ISS=Ca.strictlySequentialId;Ca=zb}else Ca=null;return Ca};var Wc=c(60);
class Pc{constructor(Ca,zb,pc,Dc,dc,he,Rc,qe,bf){this.LocalCobaltSessionId=Ca;this.SkypeChatThreadId=zb;this.ChatThreadDiscoveryUri=pc;this.InChat=Dc;this.Capabilities=dc;this.Email=he;this.UserName=Rc;this.IsAnonymous=qe;this.PresenceStatus=bf}}Object(l.a)(Pc,"SerializableWacData",null,[]);class Xd{constructor(){this.Kxd=this.Jxd=0}w6l(){this.Kxd===Number.MAX_VALUE&&(this.Kxd=0);this.Kxd++;return this.Kxd}v6l(){this.Jxd===Number.MAX_VALUE&&(this.Jxd=0);this.Jxd++;return this.Jxd}static get instance(){return Xd.Rkk}}
Xd.Rkk=new Xd;Object(l.a)(Xd,"StrictlySequentialIdGenerator",null,[199]);var Dd=c(1550);class $e{constructor(Ca,zb,pc,Dc,dc,he,Rc,qe=0){this.Kta=null;this.dryDeletion=0;this.XI=Ca;this.JMa=he;this.ud=dc;this.CAb=Rc;this.Wc=zb;this.shapeId=qe;this.SHa=pc;this.o$=Rc.create(this,Dc,dc,he)}clone(){return new $e(this.XI,this.Wc,this.SHa,this.o$.qsb,this.ud,this.JMa,this.CAb,this.shapeId)}get paragraphId(){return this.Kta?this.Kta:this.XI.qjb(this.Wc)}hYf(){this.Kta||(this.Kta=this.paragraphId,this.o$.hYf())}isValid(){return 0<=
this.o$.cp}getData(){const Ca=this.o$.qsb;return Ca?new Dd.a(0,this.Wc,this.SHa,Ca,null,null,null,0,this.shapeId):null}static dDb(Ca,zb,pc,Dc,dc){return zb?new $e(zb,parseInt(Ca.cTa),Ca.M8a,Ca.bS,pc,Dc,dc,Ca.shapeId):null}}Object(l.a)($e,"WordPresenceIp",null,[172,72,173]);class se{constructor(Ca,zb,pc){this.IUa=this.jda=this.izc=!1;this.Tcb=Ca;this.MXa=pc;this.user=zb}get ip(){return this.MXa}get Jfc(){return this.izc}set Jfc(Ca){(this.izc=Ca)&&this.ip.hYf()}Buf(){const Ca=Xd.instance.v6l();return new bc(this.Tcb,
this.user.clientId,1,0,this.ip?this.ip.getData():null,new Pc(this.user.zP,this.user.qIc,this.user.chatThreadDiscoveryUri,this.user.inChat,this.user.capabilities.capabilities,this.user.email,this.user.userName,this.user.isAnonymous,this.user.presenceStatus),void 0,void 0,void 0,void 0,void 0,void 0,void 0,Ca)}Z$h(){return this.user.clientId+(this.ip?this.ip.paragraphId.toString():Wc.a.nil.toString())}isValid(){const Ca=!!this.user&&this.user.isValid(),zb=!this.ip||this.ip.isValid();return Ca&&zb}clone(){const Ca=
new se;Ca.Tcb=this.Tcb;Ca.izc=this.izc;Ca.user=this.user?this.user.clone():null;Ca.MXa=this.ip?this.ip.clone():null;Ca.jda=this.jda;Ca.IUa=this.IUa;return Ca}static jbf(Ca,zb,pc,Dc,dc){if(!Ca||!zb)return null;if(Ca.mt)return k.ULS.sendTraceTag(7685324,302,15,"Presence packet is of unexpected operationType {0}",Ca.mt),null;let he;he=void 0!==Ca.Oka&&null!==Ca.Oka?Xa.oMh(Ca.clientId,Ca.Oka.UserName,Ca.Oka.Capabilities,Ca.Oka.LocalCobaltSessionId,Ca.Oka.SkypeChatThreadId,Ca.Oka.Email,Ca.client,Ca.Oka.ChatThreadDiscoveryUri,
Ca.Oka.InChat,!1,Ca.Oka.IsAnonymous,Ca.Oka.PresenceStatus):Xa.oMh(Ca.clientId,null,0,void 0,void 0,void 0,Ca.client);return new se(Ca.packetId,he,$e.dDb(Ca.PT,zb,pc,Dc,dc))}}Object(l.a)(se,"WordPresenceInfo",null,[192,72]);class wc extends hb{constructor(Ca,zb,pc,Dc,dc,he,Rc,qe,bf,Cf,bh,Lg,Th,ak){super(Ca,he,ak,zb);this.CYj=pc;this.uik=Dc;this.Pgk=dc;this.hb=Rc;wc.gu=qe;this.XI=bf;this.ud=Cf;this.JMa=bh;this.EYe=Lg;this.MKa=Th}arg(Ca){this.MKa.rFi(Ca.CommandValueId);return super.arg(Ca)}VYm(Ca){let zb;
({s2f:zb}=this.gHf(Ca)).returnValue&&(this.uik(zb.ip.paragraphId,zb.ip.o$.cp),m.AFrameworkApplication.K.$("WordEditorMoveIpToUserLocationIsEnabled")&&(Ca=wc.Zdm(zb),void 0!==Ca&&null!==Ca?(k.ULS.sendTraceTag(20764574,325,50,"Attempting to move IP to the editing location of the selected user"),this.hb.Ac(Ca),fb.FocusManager.lK()&&fb.FocusManager.instance().mg(hc.AFrame.In)):k.ULS.sendTraceTag(20764575,325,50,"IP will not be moved since the selection is either null or undefined")),Ca=new qa.a(2,1,0,
()=>{this.ga.Qb(ob.a.mje,2,zb)}),cc.a.instance.Wb(Ca))}ifi(Ca){return Ca?(Ca=se.jbf(pd(Ca),this.XI,this.ud,this.JMa,this.EYe.instance))&&Ca.isValid()&&Ca.ip?Ca:null:null}$Sk(Ca){return this.LSm(Ca)?this.tTk(Ca)?!0:(k.ULS.sendTraceTag(41236613,325,50,"Cannot jump to user location because paragraph has not been loaded yet"),!1):(k.ULS.sendTraceTag(41236612,325,50,"Cannot jump to user location because presence is not valid"),!1)}LSm(Ca){return!!this.ifi(Ca)}gHf(Ca){Ca=this.ifi(Ca);return{returnValue:!!Ca,
s2f:Ca}}tTk(Ca){let zb;return({s2f:zb}=this.gHf(Ca)).returnValue?this.CYj(zb.ip.paragraphId,zb.ip.o$.cp):!1}INl(){if(!this.ED)return[];const Ca=[];for(const zb of this.ED.h2a())zb.userName?Ca.push(zb):k.ULS.sendTraceTag(592229832,304,15,"The looked up RTC User has no name");return Ca}O7k(Ca){let zb;return({s2f:zb}=this.gHf(Ca)).returnValue&&zb.user&&zb.user.presenceStatus&&"0"!==zb.user.presenceStatus?String.format(WordEditorIntl.WordEditorStrings.l_PresenceStatusOnPage,zb.user.presenceStatus):CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}hUn(){this.Pgk(this.settings.id)}static createInstance(Ca,
zb,pc,Dc,dc,he,Rc){const qe=Ma.App.za.jb,bf=m.AFrameworkApplication.va,Cf=Va.a.instance,bh=Ra.a.instance.resolve("Box4.ICoauthCashTelemetry");return new wc(Ca,zb,Lg=>qe.rc.Zi?qe.rc.K6e(Lg,!0):!1,(Lg,Th)=>{qe.rc.Zi&&qe.rc.gUa(Lg,Th,!0,!0,!1)},()=>{Ma.App.Hv.fJ.Ddd()},bf,Cf,qe,pc,Dc,dc,he,bh,Rc)}static Zdm(Ca){const zb=wc.gu.Zc.xd.Eb(Ca.ip.paragraphId);if(void 0===zb||null===zb)return k.ULS.sendTraceTag(20764576,325,15,"The node could not be obtained"),null;if(!Qb.ParagraphReader.Xb(zb))return k.ULS.sendTraceTag(20764577,
325,15,"The obtained node is not a paragraph node"),null;Ca=Vb.a.Rc(zb,Ca.ip.o$.cp);return new Sb.Selection([Ca],!0)}}wc.gu=null;Object(l.a)(wc,"WordEditorPeoplesWell",hb,[]);class cd{constructor(){this.Xx=()=>{m.AFrameworkApplication.K1i?cd.jra.aE().continueWith(this.F2c):k.ULS.sendTraceTag(23196872,325,50,"PeoplesWell control is explicitly disabled. Skipping initialization attempt")};this.F2c=()=>{cd.kj=cd.jra.aE().result;if(cd.kj){var Ca=()=>{const zb=Ma.App.za.jb;return zb?zb.Zc?zb.Zc.xd:(k.ULS.sendTraceTag(23196876,
325,15,"ActivePage is null"),null):(k.ULS.sendTraceTag(23196875,325,15,"Workspace is null"),null)};Ma.App.Uoa().continueWith(()=>{const zb=Ma.App.Uoa().result.qj,pc=Bb.CuiHelper.$9l(m.AFrameworkApplication.Ns,m.AFrameworkApplication.Ns,m.AFrameworkApplication.Ns,m.AFrameworkApplication.Ns),Dc=Ja.createInstance(pc,zb,Object(e.a)(cd.kj.efe,cd.kj.efe.kSc,"getUserPresence"),Object(e.a)(cd.kj.efe,cd.kj.efe.Ejb,"getUserStatusInfo"),m.AFrameworkApplication.K.$("WordEditorPresenceDedupeMultipleCoauthorInstances"));
Ra.a.instance.ia("RealtimePresenceUI.WordEditorPeoplesWell",()=>wc.createInstance(Dc,Ga.a.Gp(cd.W.Ta("Common.IPeopleInfoProvider")),cd.W.Oa("WordEditor.ParagraphWordIdMapping"),cd.W.Oa("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Ca,cd.W.Ta("WordEditor.Presence.IWordPresenceCpFactory"),cd.W.resolve("Common.App.People.IPeopleManager"))).as("Common.IPeoplesWell").ha();cd._instance=Ra.a.instance.resolve("Common.IPeoplesWell");cd._instance.zXn();k.ULS.sendTraceTag(23196877,325,50,
"PeoplesWellControl is fully initialized")})}else k.ULS.sendTraceTag(23196873,325,15,"Can't initialize the PeoplesWell control because can't get a handle to RtcProxy")}}get name(){return"WordEditor.PeoplesWellControl"}wc(Ca){cd.W=Ca}init(){m.AFrameworkApplication.K.Nn(this.Xx)}dispose(){cd._instance&&(cd._instance.dispose(),cd._instance=null)}static get jra(){return null!=cd.AGg?cd.AGg:cd.AGg=Ra.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}}cd._instance=null;cd.W=null;cd.kj=null;Object(l.a)(cd,
"WordEditorPeoplesWellControlPackage",null,[1,2]);var Jd=c(100),Qd=c(165);class yd{constructor(Ca,zb,pc,Dc,dc,he,Rc,qe,bf=!1){this.h$a=null;this.HBe=!0;this.XOe=this.Ll=this.vue=null;this.sa=new Fa.a;this.DMa=Ca;this.m_=zb;this.Ibh=pc;this.sBc=Dc;this.JMg=he;yd.Ib=dc;this.Rfk=Rc;this.A7=qe;this.Ygk=bf;H.Task.WAA(zb,pc).continueWith(Object(e.a)(this,this.Jzm,"initOnTaskReady"))}Nzk(Ca){this.sa.addHandler("u",Ca)}n7i(){this.sa.raiseEvent("u",null,this)}Jzm(){this.m_.result&&this.Ibh.result&&(this.Ll=
this.m_.result,this.XOe=this.Ibh.result,this.Ll.D_a(Object(e.a)(this,this.r5,"onPresenceUpdated")),this.vue=new qa.a(2,2,this.JMg,Object(e.a)(this,this.kUo,"updateAwayClientsTask"),88),yd.Ib.Wb(this.vue))}r5(Ca,zb){(this.HBe||this.JQn(zb.Zra))&&yd.Ib.A1(this.vue,0)}JQn(Ca){for(let pc in Ca){var zb=this.sBc.TTd({key:pc,value:Ca[pc]});if(zb&&zb.clientId&&(zb=zb.clientId.toLowerCase(),(zb=this.h$a[zb]||this.h$a[zb.toUpperCase()])&&2===zb.status))return!0}return!1}kUo(Ca){var zb=this.Ll.yPc();if(zb){var pc=
new Date,Dc=!1;if(this.HBe){this.h$a=zb;this.HBe=!1;var dc=this.h$a;for(var he in dc){zb=he;var Rc=dc[he];Rc.Rec<pc&&(pc=Rc.Rec);2===Rc.status&&(Dc=!0,this.XOe.T6c(zb))}Dc&&this.n7i();yd.Ib.A1(Ca,this.Yci(pc))}else{Rc=new R.a;he=!1;var qe=this.h$a;for(dc in qe){qe=dc;if(!(qe in this.h$a)||this.DMa.clientId===qe)continue;var bf=this.h$a[qe];const Cf=zb[qe];if(bf&&Cf){bf=bf.status;const bh=Cf.status;2===bf&&1===bh?(Rc.add(qe),k.ULS.sendTraceTag(38052609,392,50,qe+" returned from away")):1===bf&&2===
bh&&(he=Dc=!0,this.XOe.T6c(qe),k.ULS.sendTraceTag(38052610,392,50,qe+" went away"));1===bh&&Cf.Rec<pc&&(pc=Cf.Rec)}}this.h$a=zb;yd.Ib.A1(Ca,this.Yci(pc));(0<Rc.count||Dc)&&this.n7i();0<Rc.count&&!this.Ygk?(Ca=this.PRl(Rc),this.mLo(Ca)):Ca=new R.a;(he||0<Ca.count)&&this.Rfk(ab.a.QGd,2)}}}mLo(Ca){if(Ca.count)for(let zb of Ca)Ca=this.A7.Cva(String.format(CommonUIStrings.l_EditorsToastArriving,zb),!1),Ca.image=5,Ca.fpa="CoAuth_AuthorStatus_16x16x32",this.A7.sA(Ca)}PRl(Ca){const zb=this.Ll.CFb(),pc=new R.a;
for(let Dc in zb){const dc={key:Dc,value:zb[Dc]};if(Ca.contains(dc.key)){const he=this.sBc.TTd(dc);he&&(pc.add(he.userName),Ca.remove(dc.key))}}pc.count||k.ULS.sendTraceTag(38052611,392,10,"There were no coauthor names found");return pc}Yci(Ca){const zb=new Date;return Math.max(Ca.getTime()+this.JMg-zb.getTime(),0)}}yd.Ib=null;Object(l.a)(yd,"AwayManager",null,[]);var Le=c(780);class gf{constructor(Ca=0){this.updates=Ca}get ozf(){return 0!==this.updates}MFa(Ca){return!!(this.updates&Ca)}P7a(Ca){this.updates|=
Ca}toString(){if(this.MFa(0))return"none";const Ca=new R.a;this.MFa(1)&&Ca.add("user(s) joined");this.MFa(2)&&Ca.add("user(s) disconnected");this.MFa(4)&&Ca.add("user(s) updated");return Ca.toArray().join(", ")}}Object(l.a)(gf,"UserUpdateEvent",null,[]);var xh=c(35);class Qg{constructor(Ca,zb,pc,Dc,dc=null){this.sa=new Fa.a;this.vK=this.kj=null;this.e8g=this.B8g=this.lm=!1;this.Bq=new Yb.a;Ca.continueWith(()=>{this.kj=Ca.result;this.kj.D_a(Object(e.a)(this,this.kYi,"onRtcPresenceUpdate"));this.kj.Iua(Object(e.a)(this,
this.jYi,"onRtcConnectionChange"));this.zqg(null,null)});zb.continueWith(()=>{this.vK=zb.result;this.vK.Seb(Object(e.a)(this,this.i2c,"onEditorsTableUpdated"))});dc&&dc.continueWith(()=>{dc.result.Nzk(Object(e.a)(this,this.zqg,"updateUserStatus"));this.zqg(null,null)});this.VMa=pc;this.sBc=Dc}get users(){return this.Bq}O2b(Ca){this.sa.addHandler("UU",Ca)}V8f(Ca){this.sa.removeHandler("UU",Ca)}zqg(){if(this.kj){var Ca=!1,zb=this.kj.yPc();for(let Dc in zb){var pc=zb[Dc];const dc=Dc;this.users.nb(dc)&&
(pc=this.pBj(pc),Ca=this.users.J(dc).wCb!==pc||Ca,this.users.J(dc).wCb=pc)}Ca&&(Ca=new gf(4),this.fge(Ca))}}pBj(Ca){return 1===Ca.status?0:1}h2a(){this.users.count||(this.B8g||(xh.b(42316242,302,50,"No users available at PeopleInfoProvider.GetAllUsers call"),this.B8g=!0),this.$En());const Ca=[];for(let zb of this.users)Array.add(Ca,zb.value);return Ca}$En(){if(this.kj){var Ca=this.kj.CFb();this.JPf(Ca)}if(this.vK){Ca=this.vK.sPc();for(const zb of Ca)zb.Id&&(Ca=this.AOh(zb.Id),this.yqg(new gf,Ca))}}ZNf(Ca){({value:Ca}=
this.users.Fc(Ca));return Ca}dispose(){this.lm||(this.kj&&(this.kj.dPb(Object(e.a)(this,this.kYi,"onRtcPresenceUpdate")),this.kj.ujc(Object(e.a)(this,this.jYi,"onRtcConnectionChange"))),this.vK&&this.vK.Cbj(Object(e.a)(this,this.i2c,"onEditorsTableUpdated")),this.lm=!0)}jYi(Ca,zb){2===zb.newState&&(Ca=this.JPf(this.kj.CFb()),Ca.ozf&&this.fge(Ca))}i2c(Ca,zb){Ca=new gf;var pc=this.vK.sPc();k.ULS.sendTraceTag(561894485,302,50,"editorstablemanager coauthors count is {0}, editorstableupdate old count of coauthors is {1}, editorstableupdate new count of coauthors is {2}",
pc.length,zb.ikn,zb.jRi);const Dc=new Yb.a;for(var dc of pc){pc=dc.Id;const he=this.AOh(pc);this.yqg(Ca,he);Dc.Z(pc,he)}if((zb=zb.XKf)&&0<zb.length)for(dc=0;dc<zb.length;dc++)k.ULS.sendTraceTag(562415168,302,50,"{0} users in coauth gallery. User leaving the editor table: {1}",this.users.count,zb.J(dc).Id),({value:pc}=this.users.Fc(zb.J(dc).Id)).returnValue?pc?(this.users.remove(zb.J(dc).Id),Ca.P7a(2),Dc.Z(zb.J(dc).Id,pc)):k.ULS.sendTraceTag(561287839,302,50,"Empty entry in PIP users: {0}",zb.J(dc).Id):
k.ULS.sendTraceTag(570426140,302,15,"Disconnected user not found: {0}",zb.J(dc).Id);zb=this.kj.CFb();for(let he in zb)dc=this.sBc.TTd({key:he,value:zb[he]}),Dc.Z(dc.clientId,dc);for(let he of this.users)Dc.nb(he.value.clientId)||(k.ULS.sendTraceTag(561287840,302,15,"Coauth Gallery contains user not in Editors Table or RTC presence: {0}",he.key),this.users.remove(he.key),Ca.P7a(2));Ca.ozf&&this.fge(Ca)}kYi(Ca,zb){Ca=this.JPf(zb.Zra);for(const pc of zb.vLd)this.users.nb(pc)&&(Ca.P7a(2),this.users.J(pc).wCb=
2);Ca.ozf&&this.fge(Ca)}JPf(Ca){const zb=new gf;if(!Ca)return zb;for(let Dc in Ca){var pc=this.sBc.TTd({key:Dc,value:Ca[Dc]});pc&&(pc=pc.clone(),this.yqg(zb,pc))}return zb}yqg(Ca,zb){if(zb){var pc=zb.clientId;var Dc=this.E7n(zb);({value:zb}=this.users.Fc(pc)).returnValue?zb.equals(Dc)||(Ca.P7a(4),this.users.Z(pc,Dc)):(k.ULS.sendTraceTag(562415169,302,50,"{0} users in coauth gallery. User joining: {1}",this.users.count,pc),Ca.P7a(1),this.users.Z(pc,Dc))}}AOh(Ca){return this.users.nb(Ca)?this.users.J(Ca):
fa.a.Nal(Ca)}E7n(Ca){if(!Ca||!Ca.clientId||!this.vK)return Ca;const zb=Ca.clone();zb.wCb=this.ORl(Ca);if(Ca=this.vK.z9b(zb.clientId))zb.isReadOnly=zb.isReadOnly||Ca.IsReadOnly?!0:!1,zb.userName=this.D7n(zb,Ca),zb.capabilities=this.kdn(zb.capabilities,Ca.Capabilities),zb.email=zb.email||Ca.SIPAddress||Ca.EmailAddress,Ca.JoinCoauthTime&&(zb.VRa=Ca.JoinCoauthTime);zb.color=this.VMa.jac(new Le.a(zb.email,void 0,zb.userName,void 0,zb.isAnonymous,zb.clientId),3);return zb}ORl(Ca){if(!this.kj)return 2;if(Ca&&
Ca.clientId){const zb=this.kj.yPc();if(Ca.clientId in zb)return this.pBj(zb[Ca.clientId])}return 2}f3k(Ca,zb){zb.Name&&Ca.userName&&zb.Name!==Ca.userName&&!this.e8g&&(this.e8g=!0,xh.b(42316243,302,15,"User names in EditorsTable and RTC don't match"))}kdn(Ca,zb){Ca=Ca||new Ka.a;zb&&(zb.SupportsRealtimeChannel&&Ca.P7a(1),zb.SupportsRename&&Ca.P7a(2),zb.SupportsChat&&Ca.P7a(4));return Ca}D7n(Ca,zb){this.f3k(Ca,zb);return zb.Name||Ca.userName||(Ca.isAnonymous||zb.IsAnonymous?CommonUIStrings.l_GuestUserName:
null)}fge(Ca){k.ULS.sendTraceTag(42316245,302,100,"PeopleInfoProvider update detected: {0}",Ca.toString());this.sa.raiseEvent("UU")}}Object(l.a)(Qg,"PeopleInfoProvider",null,[946,9]);var Ng;(function(Ca){Ca[Ca.multipleBrowsersImageClassName=0]="multipleBrowsersImageClassName";Ca[Ca.peopleImageClassName=1]="peopleImageClassName";Ca[Ca.peopleImageClusterPath=4]="peopleImageClusterPath";Ca[Ca.multipleBrowserImageClusterPath=5]="multipleBrowserImageClusterPath";Ca[Ca.imageDimension=6]="imageDimension";
Ca[Ca.rtl=8]="rtl";Ca[Ca.pointerInputManager=9]="pointerInputManager";Ca[Ca.clickInputManager=10]="clickInputManager";Ca[Ca.vertical=11]="vertical";Ca[Ca.zIndex=12]="zIndex";Ca[Ca.contextMenuInputManager=13]="contextMenuInputManager";Ca[Ca.imageDomElement=14]="imageDomElement";Ca[Ca.useIdleTooltip=15]="useIdleTooltip";Ca[Ca.viewportBoundsCallback=16]="viewportBoundsCallback";Ca[Ca.flipHorizontalDirection=17]="flipHorizontalDirection";Ca[Ca.fixRemoveFadeOutElementCrash=18]="fixRemoveFadeOutElementCrash";
Ca[Ca.ignoreEventOnExpandedTooltip=19]="ignoreEventOnExpandedTooltip";Ca[Ca.ipWidthAdjustForFlyout=20]="ipWidthAdjustForFlyout"})(Ng||(Ng={}));Object(l.b)("PresenceTooltipSettingKeys",Ng);class zg{constructor(){this.Bu={}}get(Ca,zb=null){Ca=Ng[Ca];return"number"===typeof zb?(zb=this.Bu[Ca])?Number.parseInvariant(zb.toString()):0:this.Bu[Ca]}add(Ca,zb){this.Bu[Ng[Ca]]=zb}VNa(Ca,zb){Ng[Ca]in this.Bu||(this.Bu[Ng[Ca]]=zb)}remove(Ca){delete this.Bu[Ng[Ca]]}}Object(l.a)(zg,"PresenceTooltipSettings",null,
[]);class Jf extends Fa.a{constructor(Ca){super();this._element=null;this.element=Ca}get element(){return this._element}set element(Ca){this._element=Ca}get visible(){return"visible"===this.element.style.visibility}set visible(Ca){this.element.style.visibility=Ca?"visible":"hidden"}get rtl(){return"rtl"===this.element.dir.toLowerCase()}set rtl(Ca){this.element.dir=Ca?"rtl":"ltr"}get zIndex(){return this.element.style.zIndex}set zIndex(Ca){this.element.style.zIndex=String(Ca)}dispose(){this.element&&
this.element.parentNode&&this.element.parentNode.removeChild(this.element);this.element=null;super.dispose()}createElement(Ca){return this.element.ownerDocument.createElement(Ca)}pka(){return!0}static PNh(Ca){return"prControl"+(Ca?"Rtl":"")}}Object(l.a)(Jf,"BasePresenceControl",Fa.a,[9,956]);class fc extends Sys.EventArgs{constructor(Ca,zb){super();this.type=Ca;this.Qo=zb}}fc.NU="InteractivityChanged";Object(l.a)(fc,"InteractivityChangedEventArgs",Sys.EventArgs,[]);class Fc{static YUl(Ca){return Fc.ZUl(Ca)}static ZUl(Ca){const zb=
document.createElementNS(Fc.$sg,"svg");zb.setAttribute("viewBox",String.format(Fc.Rhl,Fc.jKj,Fc.iKj));zb.appendChild(Fc.jgm(Ca));return zb}static jgm(Ca){const zb=Fc.jKj/Ca,pc=2*zb,Dc=Fc.iKj/2;Ca=(Ca-12-8)*zb/2;const dc=document.createElementNS(Fc.$sg,"g");Sys.UI.DomElement.addCssClass(dc,Fc.Qhl);for(let he=1;3>=he;he++)dc.appendChild(Fc.ARl(he,pc,Ca+(6*he-2)*zb,Dc));return dc}static ARl(Ca,zb,pc,Dc){const dc=document.createElementNS(Fc.$sg,"circle");Sys.UI.DomElement.addCssClass(dc,String.format("{0}-{1}",
Fc.GXk,Ca));dc.setAttribute("cx",String.format("{0}",pc));dc.setAttribute("cy",String.format("{0}",Dc));dc.setAttribute("r",String.format("{0}",zb));return dc}}Fc.$sg="http://www.w3.org/2000/svg";Fc.Qhl="prDancingDots";Fc.GXk="prAnimateCircle";Fc.Rhl="0 0 {0} {1}";Fc.iKj=40;Fc.jKj=120;Object(l.a)(Fc,"ModernPresenceTooltipDancingDots",null,[]);var id=c(96),ld=c(91),hd=c(11),Be=c(28),Ke=c(143),Me=c(56);class jf extends Jf{constructor(Ca,zb){super(Ca);this.rlh=this.abb=this.hwe=this._img=this.yE=this.Bs=
this.ig=null;this.nNa=zb.get(8,!1);this.Gab=zb.get(6,0);this.kok=zb.get(15,!1);this.Wf=zb;this.ZUg=0;this.element=Ca;this.element.className=jf.Rlf;this._span=document.createElement("span");this.element.appendChild(this._span);this.I1j=Fc.YUl(zb.get(6,0));this.fC(zb);this._state=5}WAb(Ca){this.addHandler(fc.NU,Ca)}$Ob(Ca){this.removeHandler(fc.NU,Ca)}get user(){return this.rlh}get state(){return this._state}dispose(){this.element&&(this.ig.sc(hd.a.click,this.element,Object(e.a)(this,this.onClick,"onClick")),
this.ig.sc(hd.a.vB,this.element,Object(e.a)(this,this.pka,"stopPropagationAndPreventDefaultBehavior")),this.Bs.sc(hd.a.pointerDown,this.element,Object(e.a)(this,this.gD,"onPointerDown")),this.Bs.sc(hd.a.pointerOut,this.element,Object(e.a)(this,this.SJ,"onPointerOut")),this.Bs.sc(hd.a.pointerOver,this.element,Object(e.a)(this,this.KP,"onPointerOver")),this.yE.sc(this.element,Object(e.a)(this,this.pka,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}fC(Ca){this.ig=Ca.get(10);this.ig.ob(hd.a.click,
this.element,Object(e.a)(this,this.onClick,"onClick"));this.ig.ob(hd.a.vB,this.element,Object(e.a)(this,this.pka,"stopPropagationAndPreventDefaultBehavior"));this.Bs=Ca.get(9);this.Bs.ob(hd.a.pointerOver,this.element,Object(e.a)(this,this.KP,"onPointerOver"));this.Bs.ob(hd.a.pointerOut,this.element,Object(e.a)(this,this.SJ,"onPointerOut"));this.Bs.ob(hd.a.pointerDown,this.element,Object(e.a)(this,this.gD,"onPointerDown"));this.yE=Ca.get(13);this.yE.ob(this.element,Object(e.a)(this,this.pka,"stopPropagationAndPreventDefaultBehavior"))}hide(Ca=
null,zb=0,pc=0){this.kok&&Ca?this.hxo(Ca,zb,pc):(3===this.state&&this.kaj(),this.visible=!1,this._state=5)}hxo(Ca,zb,pc=0){this.show(Ca,zb,15,4,void 0,pc)}Vrj(Ca,zb,pc=!1,Dc=!1,dc=!1,he=0){this.show(Ca,zb,20,pc?2:Dc?1:0,dc,he)}Fwo(Ca,zb,pc,Dc=!1,dc=0){this.show(Ca,zb,pc+20,3,Dc,dc)}show(Ca,zb,pc,Dc=3,dc=!1,he=0){!Ca||Dc===this.state&&this.ftm(zb,pc)||(this.Crk(Dc,dc,he),this.rga(Ca,Dc,he),this._state=Dc,4===he||0===he&&!this.nNa?this.element.style.left=zb+"px":this.element.style.right=zb+"px",this.element.style.top=
pc+"px",this.visible=!0)}rga(Ca,zb,pc){this.rlh=Ca;Me.a.KC(this._span);Ke.a.qZk(this._span);this._span.id="fly_"+Ca.clientId;this._span.style.backgroundColor=Ca.color;4!==zb?(this._span.style.height=this.Gab+"px",this._span.style.lineHeight=this.Gab+"px",Ke.a.BQb(this._span,"border-radius",this.Gab+"px")):4===pc||0===pc&&!this.nNa?this._span.style.left="0px":this._span.style.right="0px";2!==zb&&(4===zb?Me.a.vv(this._span,""):1===zb?this._span.appendChild(this.I1j):(this._span.setAttribute("dir","auto"),
pc=yb.a.q1l(Ca.userName),(!Ca.isAnonymous||m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1))&&pc||0!==zb?(Ca=Ca.userName,0===zb&&(Ca=pc,Ke.a.BQb(this._span,"text-align","center")),Me.a.vv(this._span,Ca)):(this._img||(this._img=this.z9k()),this._span.appendChild(this._img),Ke.a.BQb(this._span,"text-align","start"))))}onClick(Ca){if(0===this.state)return this.raiseEvent(fc.NU,new fc(1,Ca)),!0;3===this.state&&k.ULS.sendTraceTag(50436114,
302,50,"User clicked on presence pill.");return!1}SJ(Ca){3===this.state&&this.raiseEvent(fc.NU,new fc(3,Ca));return!1}KP(Ca){3!==Ca.kg&&this.raiseEvent(fc.NU,new fc(2,Ca));return!1}gD(Ca){if(3!==Ca.kg)return!0;this.raiseEvent(fc.NU,new fc(4,Ca));return!1}z9k(){const Ca=document.createElement("img");Ca.src=id.a.Tba("doughperson_white_glyph.svg");Ca.setAttribute("Unselectable","on");Be.a.lr(Ca,Be.a.uh,Be.a.wz);return ld.createClusteredImageFromClusterWithImageClass(this.Gab,this.Gab,null,null,jf.qHl,
"",!1,"",this.element.ownerDocument,Ca)}Crk(Ca,zb=!1,pc=0){if(!this.eWc(this.state)||!this.eWc(Ca))switch(Sys.UI.DomElement.removeCssClass(this.element,this.hwe),this.state){case 4:3===Ca?this.s_a(jf.Slf,jf.O1h):this.eWc(Ca)&&this.s_a(jf.Qlf,jf.O1h);break;case 3:4===Ca?this.s_a(jf.Vlf,jf.N1h):this.eWc(Ca)&&(zb&&this.kaj(),this.s_a(jf.Qlf,jf.N1h,zb?jf.pHl:""));break;case 0:case 1:case 2:4===Ca?this.s_a(jf.Vlf,jf.Tlf):3===Ca&&(zb&&this.Ksk(),this.s_a(jf.Slf,jf.Tlf,zb?jf.P1h:"",3===pc?jf.tHl:jf.rHl));
break;default:4===Ca?this.s_a(jf.Vlf):3===Ca?this.s_a(jf.Slf):this.eWc(Ca)&&this.s_a(jf.Qlf)}}s_a(...Ca){this.hwe=Ca.join(" ");Sys.UI.DomElement.addCssClass(this.element,this.hwe)}Ksk(){this.ZUg=window.setTimeout(()=>{this.element&&(this.abb=this.element.cloneNode(!0),this.element.parentNode.appendChild(this.abb),this.element.style.zIndex="2",this.abb.style.zIndex="1")},300)}kaj(){window.clearTimeout(this.ZUg);this.abb&&(Sys.UI.DomElement.removeCssClass(this.abb,jf.Tlf+" "+jf.P1h),Sys.UI.DomElement.addCssClass(this.abb,
jf.oHl),H.Task.delay(300).continueWith(()=>{this.element&&this.element.parentNode===this.abb.parentNode&&this.element.parentNode.removeChild(this.abb)}),Ke.a.sjc(this.element,"z-index"))}eWc(Ca){return 0===Ca||1===Ca||2===Ca}ftm(Ca,zb){const pc=Ke.a.YY(this.element.style.top);return Ke.a.YY(this.element.style.left)===Ca&&pc===zb}e$f(Ca){3===Ca&&Ke.a.Mba(this.element,"left")?(Ca=Ke.a.YY(this.element.style.left),Ke.a.sjc(this.element,"left"),this.element.style.right=-1*Ca+"px"):4===Ca&&Ke.a.Mba(this.element,
"right")&&(Ca=Ke.a.YY(this.element.style.right),Ke.a.sjc(this.element,"right"),this.element.style.left=-1*Ca+"px")}}jf.Rlf="prModernFlyout UIFont";jf.Vlf="flyoutIdle";jf.Slf="flyoutExpanded";jf.Qlf="flyoutCollapsed";jf.O1h="flyoutFromIdle";jf.N1h="flyoutFromExpanded";jf.Tlf="flyoutFromCollapsed";jf.P1h="flyoutStacked";jf.pHl="flyoutFromStacked";jf.oHl="flyoutFadeOut";jf.qHl="cui-img-cont-float cui-img-20by20";jf.rHl="flyoutLtrDir";jf.tHl="flyoutRtlDir";Object(l.a)(jf,"ModernPresenceTooltipFlyoutControl",
Jf,[]);class kg{constructor(Ca,zb,pc=2,Dc=4){this.offsetTop=Ca;this.offsetLeft=zb;this.gKj=pc;this.kpi=Dc}}Object(l.a)(kg,"FlyoutsPositioningInfo",null,[]);var sf=c(39);class Wg{constructor(Ca=!1,zb=!1){this.om=Ca;this.MBe=zb}E2l(Ca,zb,pc,Dc,dc){const he=dc.y,Rc=dc.height;var qe=this.UPl(Dc);const bf=qe+zb,Cf=Ca*pc+2*(Ca-1);pc=null;1===Ca||this.QSk(qe,Cf,he,Rc)?Ca=new kg(0,0,2):(Ca=this.Blf(bf,Cf,he,Rc),Ca.offsetTop-=qe);this.MBe?pc=new kg(0,0,void 0,this.om?4:3):(Dc=this.TPl(Dc,dc),qe=Math.max(0,
dc.x),dc=dc.width,zb=Dc+zb,this.RSk(Dc,qe,dc)?pc=new kg(0,0,void 0,this.om?3:4):this.SSk(zb,qe)&&(pc=new kg(0,0,void 0,this.om?4:3)),pc||(pc=this.$Fl(Dc,zb,qe,dc)));return new kg(Ca.offsetTop,pc.offsetLeft,Ca.gKj,pc.kpi)}UPl(Ca){return sf.a.lFa(Ca)}TPl(Ca,zb){return this.om?zb.width-sf.a.c6h(Ca):sf.a.Eof(Ca)}QSk(Ca,zb,pc,Dc){return Ca+zb<=pc+Dc}Blf(Ca,zb,pc,Dc){let dc=1,he=Math.max(pc,Ca-zb);zb>Ca-pc&&(dc=2,he=zb<Dc?Dc-zb:pc);return new kg(he,0,dc)}RSk(Ca,zb,pc){return Ca+150<=zb+pc}SSk(Ca,zb){return 150<=
Ca-zb}$Fl(Ca,zb,pc,Dc){Dc-zb>=Ca-pc?Ca=4:(zb=Ca,Ca=3);return new kg(0,zb,void 0,Ca)}}Object(l.a)(Wg,"ModernPresenceTooltipPositioner",null,[]);class Db{constructor(Ca,zb,pc,Dc,dc,he,Rc){this.Caa=Ca;this._parent=zb;this.wPg=pc;this.uZj=Dc;this.x6j=dc;this.W0b=he;this.nNa=Rc;this._element=document.createElement("div");this.element.className="prTouchTarget"}get element(){return this._element}update(Ca,zb){if(3!==Ca)if(5!==Ca&&this.Caa&&this.Caa.length){if(4===Ca){var pc=this.x6j;var Dc=(this.W0b-pc)/
2;this.element.style.height=this.W0b+"px";this.element.style.width=this.W0b+"px";Ca=Ke.a.YY(this.Caa[0].element.style.top);zb=Ke.a.YY(this.nNa?this.Caa[0].element.style.right:this.Caa[0].element.style.left)}else pc=this.wPg,Dc=(this.W0b-pc)/2,this.element.style.height=this.W0b+"px",this.element.style.width=this.SRl()+2*Dc+"px",Ca=Ke.a.YY(this.Caa[this.Caa.length-1].element.style.top),zb=this.VRk(this.Caa[this.Caa.length-1].element,pc,zb);Ke.a.BQb(this.element,"border-radius",this.W0b+"px");this.element.style.top=
Ca-Dc-pc+"px";this.nNa?this.element.style.right=zb-Dc+"px":this.element.style.left=zb-Dc+"px";this.element.parentNode||this._parent.insertBefore(this.element,this._parent.firstChild)}else this.element.parentNode&&this.element.parentNode.removeChild(this.element)}VRk(Ca,zb,pc){return this.nNa&&!pc?Ke.a.YY(Ca.style.right):this.nNa||pc?this.nNa&&pc?-Ke.a.YY(Ca.style.left)-zb:-Ke.a.YY(Ca.style.right)-zb:Ke.a.YY(Ca.style.left)}SRl(){return this.Caa&&this.Caa.length?this.wPg+Math.min(this.Caa.length-1,
2)*this.uZj:0}}Object(l.a)(Db,"ModernPresenceTooltipTarget",null,[]);var Gb=c(127),$c=c(194);class Bd extends Jf{constructor(Ca,zb,pc){super(Ca);this.w_b=this.ZLa=this.b_g=this.hvb=!1;this.Bq=[];this.Bnd={};this.Wf=pc;this.om=pc.get(8,!1);this.RYg=pc.get(15,!1);this.A0j=pc.get(12,0);this.Dfb=pc.get(6,0);this.tma=zb;this.Olh=pc.get(16);this.MBe=pc.get(17,!1);this.B6j=pc.get(19,!1);this.Hfk=pc.get(20,!1);this.vqd=0;this.Bfk=new Wg(this.om,this.MBe);this.Hqc=this.I8h();this.dyb=!1;this.pUb=[];this.Hwc=
[];this.element.id=Bd.Aib();this.element.className=Jf.PNh(this.om);this.e1a&&(this.zIndex=this.e1a);this.rtl=this.om;this.hdg(zb);this.e7=this.createElement("div");this.e7.className="prFlyoutContainer";this.element.appendChild(this.e7);this.Caa=[];this.Bbb=new Db(this.x4,this.element,this.Dfb,4,6,32,this.om);this.Bs=pc.get(9);this.Bs.ob(hd.a.pointerDown,this.Bbb.element,Object(e.a)(this,this.Pgc,"onHitTarget"));this.Bs.ob(hd.a.pointerOver,this.Bbb.element,Object(e.a)(this,this.Pgc,"onHitTarget"));
this.Bs.ob(hd.a.pointerOut,this.Bbb.element,Object(e.a)(this,this.Pgc,"onHitTarget"))}get zae(){return $c.a.clone(this.Bq)}get x4(){return this.Caa}get e1a(){return this.A0j}get Y1a(){return this.x4?this.x4.length:0}get mSb(){return 0<this.Y1a?this.x4[0].state:5}get XEf(){return 3===this.mSb&&!this.hvb}WAb(Ca){this.addHandler(fc.NU,Ca)}$Ob(Ca){this.removeHandler(fc.NU,Ca)}dispose(){if(this.XEf)this.dyb=!0;else{if(this.x4)for(const Ca of this.x4)Ca.$Ob(Object(e.a)(this,this.QSa,"onInteractivityChanged")),
Jd.a.jC(Ca);this.Caa=null;this.Bs.sc(hd.a.pointerDown,this.Bbb.element,Object(e.a)(this,this.Pgc,"onHitTarget"));this.Bs.sc(hd.a.pointerOver,this.Bbb.element,Object(e.a)(this,this.Pgc,"onHitTarget"));this.Bs.sc(hd.a.pointerOut,this.Bbb.element,Object(e.a)(this,this.Pgc,"onHitTarget"));super.dispose()}}$lc(){this.X4b();this.visible=!0}X$c(){this.visible=!0;this.lZh();this.hvb=!0}$gg(){this.X$c()}hide(){this.Raj();this.w3a();this.Bbb.update(this.mSb,this.w_b)}rga(Ca){const zb=this.mSb,pc=this.hvb;Ca.clientId||
(Ca.clientId=(Bd.axc++).toString());if(Ca.clientId in this.Bnd){var Dc=this.$Eb(Ca.clientId);if(0<=Dc){Dc=this.Bq[Dc];if(Dc.color===Ca.color&&Dc.userName===Ca.userName)return;this.j7a(Ca.clientId)}}this.hide();Dc=new jf(this.createElement("div"),this.Wf);Dc.WAb(Object(e.a)(this,this.QSa,"onInteractivityChanged"));this.e7.insertBefore(Dc.element,this.e7.firstChild);this.Bnd[Ca.clientId]=Dc;Array.add(this.Bq,Ca);Array.add(this.x4,Dc);this.rIj(zb,pc);this.visible=!0}j7a(Ca){if(this.XEf)Array.add(this.Hwc,
Ca);else{var zb=this.mSb,pc=this.hvb;this.hide();this.S6c(Ca);this.rIj(zb,pc)}}uQi(Ca){const zb=this.$Eb(Ca);if(!(0>=zb)){var pc=this.Bq[zb];Ca=this.Bnd[Ca];Array.removeAt(this.Bq,zb);Array.insert(this.Bq,0,pc);Array.removeAt(this.x4,zb);Array.insert(this.x4,0,Ca);this.e7.removeChild(Ca.element);this.e7.appendChild(Ca.element);this.X4b()}}rIj(Ca,zb){0>=this.Bq.length?this.hide():3===Ca&&zb?this.X$c():this.$lc()}sjf(Ca){if(this.XEf&&this.B6j)return!1;Ca=Bd.$tf(Ca);if(this.e7!==Ca&&Me.a.jRa(this.e7,
Ca))return!0;for(const zb of this.x4)if(Me.a.jRa(zb.element,Ca))return!0;return!1}position(Ca,zb){this.element.style.top=zb+"px";this.element.style.left=Ca+"px"}X4b(Ca=!1){if(!Ca||this.ZLa){this.b_g&&this.Gnj(!0);var zb=Math.min(3,this.Y1a)-1;Ca=0;var pc=1,Dc=0;this.w_b&&(Ca=this.Hqc,pc=-1,Dc=-this.Dfb);for(let dc=this.Y1a-1;dc>zb;dc--)this.x4[dc].Vrj(this.Bq[dc],-4*zb*pc+Dc,!0,!1,!0,Ca);for(;0<=zb;zb--)this.x4[zb].Vrj(this.Bq[zb],-4*zb*pc+Dc,0<zb,Array.contains(this.pUb,this.Bq[zb].clientId),zb!==
this.vqd,Ca);this.vqd=0;this.Bbb.update(0,this.w_b);this.zIndex=this.e1a;this.hvb=!1;this.Raj(0);this.dyb&&this.dispose()}}lZh(){this.b_g&&this.Gnj(!1);this.zIndex=this.e1a+1;let Ca,zb,pc;({offsetX:zb,offsetY:Ca,jpi:pc}=this.vko());for(let Dc=0;Dc<this.Y1a;Dc++)this.x4[Dc].Fwo(this.Bq[Dc],zb,Ca+(this.Dfb+2)*Dc,Dc!==this.vqd,pc)}w3a(){let Ca=0,zb=0;this.w_b&&(Ca=this.Hqc,zb=-6);for(let pc=0;pc<this.Y1a;pc++)this.x4[pc].hide(this.Bq[pc],zb,Ca);this.zIndex=this.e1a;this.visible=this.hvb=!1;this.dyb&&
this.dispose()}$8e(Ca=0){Ca?(this.ZLa=!0,H.Task.delay(Ca).continueWith(()=>{this.RYg?this.Uum():this.X4b(!0);this.ZLa=!1})):this.RYg?this.hide():this.X4b()}Uum(){this.ZLa&&this.hide()}YKk(){if(m.AFrameworkApplication.ua&&m.AFrameworkApplication.ua.Kb.Npa&&Gb.c()){const Ca=appChrome.selectors.getShyState();return Ca.isActive&&0!==Ca.state}return!1}QSa(Ca,zb){Ca=this.mSb;this.YKk()||2!==zb.type&&(4!==zb.type||3===Ca)?4===zb.type&&3===Ca?(this.ZLa&&(this.ZLa=!1),this.$8e()):3!==zb.type||3!==Ca||this.hvb||
(1<this.Y1a?(this.ZLa=!0,H.Task.delay(250).continueWith(()=>{this.X4b(!0);this.ZLa=!1})):this.$8e()):(this.ZLa&&(this.ZLa=!1),3!==Ca&&(this.lZh(),3===zb.Qo.kg&&this.$8e(2E3)));this.raiseEvent(fc.NU,zb)}Pgc(Ca){3===Ca.kg?this.QSa(this,new fc(4,Ca)):Ca.eventName===hd.a.pointerOver?this.QSa(this,new fc(2,Ca)):Ca.eventName===hd.a.pointerOut&&this.QSa(this,new fc(3,Ca));return!1}hdg(Ca){this.element.style.width=Ca+"px";this.element.style.height=this.Dfb+"px"}S6c(Ca){this.nZn(Ca);Ca=this.$Eb(Ca);if(!(0>
Ca)){var zb=this.Bq[Ca];Array.removeAt(this.Bq,Ca);delete this.Bnd[zb.clientId];zb=this.x4[Ca];this.e7.removeChild(zb.element);this.Wf.get(18,!1)&&zb.$Ob(Object(e.a)(this,this.QSa,"onInteractivityChanged"));Array.removeAt(this.x4,Ca);zb.dispose()}}Raj(Ca=5){if(this.Hwc.length){this.visible&&this.w3a();for(let zb=0;zb<this.Hwc.length;zb++)this.S6c(this.Hwc[zb]);Array.clear(this.Hwc);0>=this.Bq.length||5===Ca?this.hide():0===Ca&&this.$lc()}}$Eb(Ca){for(let zb=0;zb<this.Bq.length;zb++)if(this.Bq[zb].clientId===
Ca)return zb;return-1}nZn(Ca){-1===this.$Eb(Ca)?k.ULS.sendTraceTag(41706452,302,50,"Cannot remove active editor because client id is invalid"):Array.contains(this.pUb,Ca)&&(Array.remove(this.pUb,Ca),this.Bq[0].clientId===Ca&&0<this.pUb.length&&this.uQi(this.pUb[this.pUb.length-1]),this.Bq[0].clientId===Ca&&1===this.mSb&&this.X4b())}Gnj(Ca){Ca?Sys.UI.DomElement.addCssClass(this.e7,"prBackgroundSelection"):Sys.UI.DomElement.removeCssClass(this.e7,"prBackgroundSelection")}vko(){let Ca,zb;zb=Ca=0;var pc=
this.Hqc;if(this.Olh){const Dc=this.Olh(this);if(!Dc)return{offsetX:Ca,offsetY:zb,jpi:pc};const dc=4===this.mSb;pc=this.Bfk.E2l(this.Y1a,dc?6:this.Dfb,this.Dfb,this.element,Dc);zb=pc.offsetTop;this.vqd=this.f1l(pc.gKj,pc.offsetTop);pc=pc.kpi;pc!==this.Hqc&&(this.e$f(pc),this.element.dir=3===pc?"rtl":"ltr",this.Hqc=pc);pc!==this.I8h()?(Ca=this.Hfk?-2:dc?-6:-this.Dfb,this.w_b=!0):this.w_b=!1}return{offsetX:Ca,offsetY:zb,jpi:pc}}f1l(Ca,zb){if(1===Ca)return this.Y1a-1;Ca=Math.abs(zb);return 0<Ca?Ca/(this.Dfb+
2):0}e$f(Ca){for(let zb=0;zb<this.Y1a;zb++)this.x4[zb].e$f(Ca)}I8h(){return this.om?3:4}static Aib(){return String.format("{0}-{1}","presencetooltip",Bd.axc++)}static $tf(Ca){return Ca.Hb.rawEvent.relatedTarget}}Bd.axc=0;Object(l.a)(Bd,"ModernPresenceTooltipControl",Jf,[1068,9]);var we=c(232),He=c(274);class Se{constructor(Ca){this.Wf=Ca;this.Wf.VNa(10,we.a.instance);this.Wf.VNa(9,Qd.a.instance);this.Wf.VNa(6,20);this.Wf.VNa(13,He.a.instance);this.Wf.VNa(17,!1)}Raf(Ca,zb=!1){this.Wf.VNa(15,zb);return new Bd(Ca,
20,this.Wf)}}Object(l.a)(Se,"ModernPresenceTooltipFactory",null,[1067]);class jg extends Jf{constructor(Ca,zb){super(Ca);this.Bq=null;this.nNa=zb.get(8,!1);this.Gab=zb.get(6,0);this.element=Ca;this.element.className=jg.Rlf;this._ul=this.createElement("ul");this.element.appendChild(this._ul);this.ig=zb.get(10);this.ig.ob(hd.a.click,this.element,Object(e.a)(this,this.onClick,"onClick"));this.Bs=zb.get(9);this.Bs.ob(hd.a.pointerOut,this.element,Object(e.a)(this,this.SJ,"onPointerOut"));this.Bs.ob(hd.a.pointerDown,
this.element,Object(e.a)(this,this.pka,"stopPropagationAndPreventDefaultBehavior"));this.yE=zb.get(13);this.yE.ob(this.element,Object(e.a)(this,this.pka,"stopPropagationAndPreventDefaultBehavior"))}WAb(Ca){this.addHandler(fc.NU,Ca)}$Ob(Ca){this.removeHandler(fc.NU,Ca)}get users(){return this.Bq}dispose(){this.element&&(this.ig.sc(hd.a.click,this.element,Object(e.a)(this,this.onClick,"onClick")),this.Bs.sc(hd.a.pointerDown,this.element,Object(e.a)(this,this.pka,"stopPropagationAndPreventDefaultBehavior")),
this.Bs.sc(hd.a.pointerOut,this.element,Object(e.a)(this,this.SJ,"onPointerOut")),this.yE.sc(this.element,Object(e.a)(this,this.pka,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}hide(){this.visible=!1}show(Ca,zb,pc){this.hide();!Ca||0>=Ca.length||(this.nNa?this.element.style.right=zb+"px":this.element.style.left=zb+"px",this.element.style.top=pc+"px",this.owk(Ca),this.visible=!0)}owk(Ca){this.Bq=Ca;Me.a.KC(this._ul);for(let zb=Ca.length-1;0<=zb;zb--)this.rga(Ca[zb])}rga(Ca){const zb=
document.createElement("li");zb.style.backgroundColor=Ca.color;zb.style.height=this.Gab+"px";zb.id="fly_"+Ca.clientId;zb.style.lineHeight=this.Gab+"px";Me.a.vv(zb,Ca.userName);zb.setAttribute("dir","auto");this._ul.appendChild(zb)}onClick(){this.hide();return!1}SJ(Ca){this.raiseEvent(fc.NU,new fc(3,Ca));return!1}}jg.Rlf="prFlyout UIFont";Object(l.a)(jg,"PresenceTooltipFlyoutControl",Jf,[]);class Hi extends Jf{constructor(Ca,zb,pc){super(Ca);this._img=null;this.Bq=[];this.element.className="prGlyph";
this.Wf=zb;this.d_b=this.Wf.get(9);this.Qq=this.Wf.get(10);this.yE=this.Wf.get(13);this.qvm();this.rga(pc);this.jGe=!1}get $5a(){return this.Bq.length}get users(){return this.Bq}WAb(Ca){this.addHandler(fc.NU,Ca)}$Ob(Ca){this.removeHandler(fc.NU,Ca)}dispose(){this.ZRo();super.dispose()}rga(Ca){Array.add(this.Bq,Ca);2===this.$5a?this.Ika(!0):1===this.$5a?this.Ika(!1):this.Ika(this.jGe)}j7a(Ca){this.uDl(Ca)&&(1<this.$5a&&this.Ika(!0),1===this.$5a?this.Ika(!1):1>this.$5a&&this.hide())}show(){this.Ika(2<=
this.$5a);this.visible=!0}hide(){this.visible=!1}Q0l(Ca){return Ca?this.g7h(0,5):this.g7h(1,4)}uDl(Ca){for(let zb=0;zb<this.$5a;zb++)if(this.Bq[zb].clientId===Ca)return Ca=this.Bq[zb],Array.removeAt(this.Bq,zb),Ca;return null}Ika(Ca){this.jGe!==Ca&&(this._img&&this.element.removeChild(this._img),this._img=this.Q0l(Ca),this.element.appendChild(this._img),this.jGe=Ca);this._img.childNodes[0].style.backgroundColor=this.Bq[this.Bq.length-1].color}g7h(Ca,zb){const pc=this.Wf.get(6,0),Dc=this.Wf.get(14);
return ld.createClusteredImageFromClusterWithImageClass(pc,pc,this.Wf.get(Ca),this.Wf.get(zb),"cui-img-cont-float cui-img-16by16","",!1,"",this.element.ownerDocument,Dc?Dc.cloneNode(!0):null)}KP(Ca){3!==Ca.kg&&this.raiseEvent(fc.NU,new fc(2,Ca));return!1}onClick(Ca){this.raiseEvent(fc.NU,new fc(1,Ca));return!0}SJ(Ca){3!==Ca.kg&&this.raiseEvent(fc.NU,new fc(3,Ca));return!1}ZRo(){this.element&&(this.d_b.sc(hd.a.pointerDown,this.element,Object(e.a)(this,this.pka,"stopPropagationAndPreventDefaultBehavior")),
this.d_b.sc(hd.a.pointerOver,this.element,Object(e.a)(this,this.KP,"onPointerOver")),this.d_b.sc(hd.a.pointerOut,this.element,Object(e.a)(this,this.SJ,"onPointerOut")),this.Qq.sc(hd.a.vB,this.element,Object(e.a)(this,this.pka,"stopPropagationAndPreventDefaultBehavior")),this.Qq.sc(hd.a.click,this.element,Object(e.a)(this,this.onClick,"onClick")),this.yE.sc(this.element,Object(e.a)(this,this.pka,"stopPropagationAndPreventDefaultBehavior")))}qvm(){this.element&&(this.d_b.ob(hd.a.pointerDown,this.element,
Object(e.a)(this,this.pka,"stopPropagationAndPreventDefaultBehavior")),this.d_b.ob(hd.a.pointerOver,this.element,Object(e.a)(this,this.KP,"onPointerOver")),this.d_b.ob(hd.a.pointerOut,this.element,Object(e.a)(this,this.SJ,"onPointerOut")),this.Qq.ob(hd.a.vB,this.element,Object(e.a)(this,this.pka,"stopPropagationAndPreventDefaultBehavior")),this.Qq.ob(hd.a.click,this.element,Object(e.a)(this,this.onClick,"onClick")),this.yE.ob(this.element,Object(e.a)(this,this.pka,"stopPropagationAndPreventDefaultBehavior")))}}
Object(l.a)(Hi,"PresenceTooltipGlyph",Jf,[]);class ii extends Jf{constructor(Ca,zb,pc){super(Ca);this.Bq=[];this.NK=[];this.FMa=0;this.tDc=this.qXb=!1;this.bLg=null;this.Cnd={};this.Wf=pc;this.om=pc.get(8,!1);this.Rla=pc.get(11,!1);Ca=pc.get(12,0);this.imageDimension=pc.get(6,0);this.tma=zb;this.element.id=ii.Aib();this.element.className=Jf.PNh(this.om);Ca&&(this.zIndex=Ca);this.rtl=this.om;this.hdg(zb);this.ABa=this.createElement("div");this.ABa.className=this.Rla?"prContainerV":"prContainerHr";
this.element.appendChild(this.ABa);this.iWg=Array(this.FMa);for(zb=0;zb<this.FMa;zb++)this.qca[zb]=new jg(this.createElement("div"),this.Wf),this.qca[zb].WAb(Object(e.a)(this,this.QSa,"onInteractivityChanged")),this.element.appendChild(this.qca[zb].element)}get zae(){return $c.a.clone(this.Bq)}get qca(){return this.iWg}get Knh(){return this.bLg}get Tje(){return this.imageDimension+2}get width(){return this.Rla?this.Tje:this.tma}get height(){return this.Rla?this.tma:this.Tje}WAb(Ca){this.addHandler(fc.NU,
Ca)}$Ob(Ca){this.removeHandler(fc.NU,Ca)}dispose(){if(this.qca)for(const Ca of this.qca)Ca.$Ob(Object(e.a)(this,this.QSa,"onInteractivityChanged")),Jd.a.jC(Ca);Jd.a.Pag(this.NK);this.NK=this.iWg=null;super.dispose()}$lc(){this.w3a();this.mhg();this.visible=!0;this.qXb=!1}X$c(){!this.NK||1>this.NK.length||(this.w3a(),this.visible=!0,this.mhg(),this.qae(this.NK[this.NK.length-1]),this.qXb=!0)}$gg(){if(this.NK&&!(1>this.NK.length)){this.visible=!0;this.mhg();var Ca=0;for(const zb of this.NK)this.qae(zb,
Ca++);this.qXb=!1;this.tDc=!0}}hide(){this.visible=!1;this.w3a();for(let Ca=0;Ca<this.NK.length;Ca++)this.NK[Ca].hide();this.qXb=!1}KDh(){if(!this.tDc)return!1;let Ca=0;for(const zb of this.qca)zb.visible&&Ca++;return this.tDc=0<Ca&&(this.Bq.length<=this.FMa?Ca===this.Bq.length:Ca===this.FMa)}rga(Ca){if(!(0>=this.FMa)){Ca.clientId||(Ca.clientId=(ii.axc++).toString());if(Ca.clientId in this.Cnd){var zb=this.$Eb(Ca.clientId);if(0<=zb){zb=this.Bq[zb];if(zb.color===Ca.color&&zb.userName===Ca.userName)return;
this.j7a(Ca.clientId)}}zb=this.KDh();var pc=0;if(this.Bq.length<this.FMa){var Dc=new Hi(this.createElement("div"),this.Wf,Ca);Dc.WAb(Object(e.a)(this,this.QSa,"onInteractivityChanged"));this.om&&!this.Rla&&0<this.Bq.length?this.ABa.insertBefore(Dc.element,this.ABa.firstChild):(this.ABa.appendChild(Dc.element),pc=this.NK.length);Array.add(this.NK,Dc)}else this.om&&!this.Rla?Dc=this.NK[0]:(pc=this.NK.length-1,Dc=this.NK[pc]),Dc.rga(Ca);Dc.show();this.Cnd[Ca.clientId]=Dc;Array.add(this.Bq,Ca);this.bGj(Dc,
pc);zb&&this.$gg()}}j7a(Ca){const zb=this.KDh();zb&&this.w3a();this.S6c(Ca);this.Bq.length>=this.FMa&&this.NK.length<this.FMa&&this.NQn();0>=this.Bq.length?this.hide():zb&&this.$gg()}uQi(){}S6c(Ca){var zb=this.$Eb(Ca);0>zb||(Ca=this.Bq[zb],Array.removeAt(this.Bq,zb),zb=this.Cnd[Ca.clientId],delete this.Cnd[Ca.clientId],zb.j7a(Ca.clientId),this.bGj(zb),0>=zb.$5a&&(this.ABa.removeChild(zb.element),Array.remove(this.NK,zb),zb.dispose()))}NQn(){var Ca=this.f8l();!Ca||1>=Ca.users.length||(Ca=Array.clone(this.Bq),
Ca.forEach(zb=>{this.S6c(zb.clientId)}),Ca.forEach(zb=>{this.rga(zb)}))}$Eb(Ca){for(let zb=0;zb<this.Bq.length;zb++)if(this.Bq[zb].clientId===Ca)return zb;return-1}f8l(){return this.om&&!this.Rla?this.NK[0]:this.NK[this.NK.length-1]}position(Ca,zb){this.element.style.top=zb+"px";this.element.style.left=Ca+"px"}mhg(){for(let Ca=0;Ca<this.NK.length;Ca++)this.NK[Ca].show()}w3a(){for(let Ca=0;Ca<this.FMa;Ca++)this.qca[Ca].hide();this.tDc=!1}qae(Ca,zb=0){if(Ca)if(this.bLg=Ca,this.Rla){const pc=this.imageDimension;
if(1<Ca.users.length)this.qca[zb].show(Ca.users,pc,this.height-this.imageDimension);else{const Dc=this.ABa.children.length;for(let dc=0;dc<this.ABa.children.length;dc++)Ca.element===this.ABa.children[dc]&&this.qca[zb].show(Ca.users,pc,this.height-(Dc-dc)*this.Tje+2)}}else this.qca[zb].show(Ca.users,this.width,0)}QSa(Ca,zb){var pc=Object(y.a)(Hi,Ca);pc=pc?this.g0h(pc):-1;if(2===zb.type||1===zb.type&&-1!==pc&&!this.qca[pc].visible)this.qae(Ca);else if(1===zb.type)this.w3a(),this.qXb=!1;else if(3===
zb.type){if(this.sjf(zb.Qo))return;this.qXb||this.w3a()}this.raiseEvent(fc.NU,zb)}sjf(Ca){Ca=ii.$tf(Ca);let zb=!1;for(const pc of this.qca)if(Me.a.jRa(pc.element,Ca)){zb=!0;break}return this.ABa!==Ca&&Me.a.jRa(this.ABa,Ca)||zb}bGj(Ca,zb=0){const pc=this.zHm(Ca);pc&&0>=Ca.$5a?this.qca[zb].hide():pc?this.qae(Ca):this.qca[zb].hide()}g0h(Ca){let zb=0;for(const pc of this.NK){if(Ca===pc)return zb;zb++}return-1}zHm(Ca){const zb=this.g0h(Ca);return!!this.Knh&&Ca===this.Knh&&-1!==zb&&this.qca[zb].visible}hdg(Ca){this.FMa=
Ca===this.imageDimension?1:Math.floor(Ca/this.Tje);this.Rla?(this.element.style.height=Ca+"px",this.element.style.width=this.imageDimension+"px"):(this.element.style.width=Ca+"px",this.element.style.height=this.imageDimension+"px")}static Aib(){return String.format("{0}-{1}","presencetooltip",ii.axc++)}static $tf(Ca){Ca=Ca.Hb.rawEvent;return Ca.relatedTarget||Ca.toElement}}ii.axc=0;Object(l.a)(ii,"PresenceTooltipControl",Jf,[1068,9]);class Zh{constructor(Ca){this.Wf=Ca;this.Wf.VNa(10,we.a.instance);
this.Wf.VNa(9,Qd.a.instance);this.Wf.VNa(6,16);this.Wf.VNa(13,He.a.instance)}Raf(Ca){return new ii(Ca,16,this.Wf)}}Object(l.a)(Zh,"PresenceTooltipFactory",null,[1067]);var vg=c(257),vf=c(115),Lf=c(55),Cg=c(6),bg=c(106),eg=c(5),sh=c(18),nh=c(78),Sh=c(517),Xk=c(308),rl=c(112);class sl extends Sys.EventArgs{constructor(Ca,zb){super();this.paragraphId=Ca;this.G0m=zb}}Object(l.a)(sl,"PresenceControlRenderedEventArgs",Sys.EventArgs,[]);class Xf extends Jf{constructor(Ca,zb,pc,Dc,dc,he=null,Rc=null){super(null);
this.und=this.hn=null;this.PZc=!1;this.Qra=0;this.Dp=Ca;this.vEc=zb;this.Bs=pc;this.vj=Dc;this.MKa=dc;Xf.Dvb=0;this.dth=new Yb.a;this.Qej=new Yb.a;this.SW=he;this.Ca=Rc;this.w3j=this.Ca.mc("PresenceIpRenderedFloodgateTimeLapseSec",30);this.tnk=this.Ca.mc("PresenceIpRenderedFloodgateTriggerThreshold",3);this.Gsa=0}get P5a(){return m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")}$wk(Ca){this.addHandler("CR",Ca)}Abj(Ca){this.removeHandler("CR",Ca)}Jce(){this.raiseEvent("CR",new sl(this.Dp.ip.paragraphId,
this.PZc))}DQf(){if(Object(rl.a)(Bd,this.hn)){const Ca=Object(y.a)(Bd,this.hn);Xf.Dvb=0<Xf.Dvb?Xf.Dvb+1:Ca.e1a+1;Ca.zIndex=Xf.Dvb;this.element.style.zIndex=String(Xf.Dvb)}}I6n(){if(Object(rl.a)(Bd,this.hn)){const Ca=Object(y.a)(Bd,this.hn);Xf.Dvb=Ca.e1a;Ca.zIndex=Ca.e1a;this.element.style.zIndex=String(Ca.e1a)}}nLi(){this.SW&&!this.pOo()&&this.SW.continueWith(()=>{this.SW.result.logActivity("PresenceIpRendered","PresenceIpRenderedFloodgateEnabled",this.w3j)&&this.Gsa++})}pOo(){return this.Gsa>=this.tnk}static HKi(){Xf.VVg||
(Xf.VVg=!0,k.ULS.sendTraceTag(4006594,302,50,"First presence ip rendered on the page"))}static Aib(Ca){return Xf.Gwm+Ca.Z$h()}}Xf.Q3i="data-presence-control";Xf.G_i="OverlayControlElementOwner";Xf.Gwm="ipId_";Xf.R3i="WacPresence";Xf.Ryn="PresenceIpPaddingDiv";Xf.VVg=!1;Xf.Dvb=0;Object(l.a)(Xf,"APresenceControl",Jf,[1264,9]);class Dl{constructor(){this.rotation=this.height=this.width=this.top=this.left=0;this.d8a=!1}}Object(l.a)(Dl,"PresenceImageControlStyle",null,[1263]);class rg extends Xf{constructor(Ca,
zb,pc,Dc,dc,he=null,Rc=null){super(Ca,zb,pc,Dc,dc,he,Rc);this.SJ=()=>{this.APi();return!1};this.W8d=qe=>{this.hn&&3===qe.kg&&(2!==this.Qra?(this.DQf(),this.nRb()):this.APi());return!1}}j7a(Ca){this.hn&&this.hn.j7a(Ca)}cpe(){return this.hn?this.hn.zae.length:0}updatePosition(Ca){if(this.element&&this.element.parentNode){var zb=this.wai(Ca);if(zb){var pc=Sys.UI.DomElement.getBounds(this.element.parentNode),Dc,dc;({left:pc,top:Dc,height:dc,width:zb}=this.K$l(zb,pc,this.element.parentNode,this.vj.instance));
this.element.style.top=Dc+"px";this.element.style.left=pc+"px";this.element.style.height=dc+"px";this.element.style.width=zb+"px";pc=this.Eai(Ca);Ke.a.P5(this.element,pc);Ca=this.Brf(Ca,this.Dp.ip.shapeId);this.koj(pc,zb,this.isSelected(Ca),m.AFrameworkApplication.isRtl);this.nRb()}}}gZ(){this.element&&(Me.a.qx(this.element),this.hn.j7a(this.Dp.user.clientId),this.Jce())}dIh(Ca,zb,pc,Dc){zb=new Dl;if(!Dc||!pc)return zb;pc=this.wai(Ca);if(!pc)return zb;zb.top=pc.y;zb.left=pc.x;zb.height=pc.height;
zb.width=pc.width;zb.rotation=this.vcm(Ca);zb.d8a=!0;return zb}zcj(Ca,zb,pc,Dc){Xf.HKi();this.und=Ca;if(Dc){const dc=this.Brf(Ca,this.Dp.ip.shapeId);if(!dc)return;const he=!this.element;he&&this.Vaf(zb.ownerDocument,Ca);he||!this.element.parentNode?dc.appendChild(this.element):this.element.parentNode!==dc&&(this.element.parentNode.removeChild(this.element),dc.appendChild(this.element));this.hn.rga(this.Dp.user);this.element.style.borderColor=this.Dp.user.color;this.element.id=Xf.Aib(this.Dp);pc.d8a&&
(this.element.style.height=pc.height+"px",this.element.style.top=pc.top+"px",this.element.style.left=pc.left+"px",this.element.style.width=pc.width+"px",Ke.a.P5(this.element,pc.rotation),Ke.a.P5(this.hn.element,-1*pc.rotation),this.koj(pc.rotation,pc.width,this.isSelected(dc),m.AFrameworkApplication.isRtl),this.nRb())}this.PZc=!Dc;this.Jce()}vcm(Ca){return this.element&&this.element.parentNode&&this.Dgi(Ke.a.getTransform(this.element.parentNode))?this.Dgi(Ke.a.getTransform(this.element)):this.Eai(Ca)}Dgi(Ca){return Ca&&
-1<Ca.indexOf("deg")&&(Ca=parseInt(Ca.substring(Ca.indexOf("(")+1,Ca.indexOf("deg"))),!isNaN(Ca))?Ca:0}AFj(Ca){this.element.style.borderColor=this.Dp.user.color;this.element.id=Xf.Aib(this.Dp);this.updatePosition(Ca)}Vaf(Ca,zb){this.element=Ca.createElement("div");this.element.setAttribute(Xf.Q3i,!0);vf.a.Sl(this.element,Xf.G_i,this);this.element.className=rg.$Gn;(Ca=zb.Cb)&&Ca.ZQ&&(this.element.style.pointerEvents="none");this.element.dir=m.AFrameworkApplication.isRtl?"rtl":"ltr";this.hn=this.vEc.Raf(this.createElement("div"),
!0);this.hn.rga(this.Dp.user);this.hn.hide();this.Bs.ob(hd.a.pointerOut,this.hn.element,this.SJ);this.Bs.ob(hd.a.pointerDown,this.hn.element,this.W8d);this.hn.element.classList.add(Xf.R3i);this.element.appendChild(this.hn.element)}K$l(Ca,zb,pc,Dc){let dc=Ca.y,he=Ca.x,Rc=Ca.height;Ca=Ca.width;(1<Math.abs(zb.width-pc.offsetWidth)||1<Math.abs(zb.height-pc.offsetHeight))&&Dc&&(dc=Math.round(dc/Dc.nj),he=Math.round(he/Dc.nj),Rc=Math.round(Rc/Dc.nj),Ca=Math.round(Ca/Dc.nj));return{left:he,top:dc,height:Rc,
width:Ca}}isSelected(Ca){return Ca.classList.contains(Xk.a.H6b)}koj(Ca,zb,pc,Dc){this.hn.element.style.left="auto";this.hn.element.style.top="auto";this.hn.element.style.right="auto";this.hn.element.style.bottom="auto";pc=pc?Math.round(.5*rg.Pra)+rg.$Lo:0;0<=Ca&&90>Ca||360===Ca?(this.hn.element.style.top=-.5*rg.Pra-pc+"px",Dc?this.hn.element.style.right=zb-.5*rg.Pra+"px":this.hn.element.style.left=zb-.5*rg.Pra+"px"):90<=Ca&&180>Ca?(this.hn.element.style.left=-.5*rg.Pra-pc+"px",Dc?this.hn.element.style.bottom=
-.5*rg.Pra+"px":this.hn.element.style.top=-.5*rg.Pra+"px"):180<=Ca&&270>Ca?(this.hn.element.style.bottom=-.5*rg.Pra-pc+"px",Dc?this.hn.element.style.left=zb-.5*rg.Pra+"px":this.hn.element.style.right=zb-.5*rg.Pra+"px"):(this.hn.element.style.right=-.5*rg.Pra-pc+"px",Dc?this.hn.element.style.top=-.5*rg.Pra+"px":this.hn.element.style.bottom=-.5*rg.Pra+"px")}Gl(Ca,zb){const pc=this.hSd(Ca,zb);return pc?pc.properties:(Ca=this.Cai(Ca,zb))?Ca.properties:null}Brf(Ca,zb){var pc=this.hSd(Ca,zb);return pc&&
(pc=pc.Swa(Ca.Fg,Ca))?pc.element:(zb=this.Cai(Ca,zb))?Object(y.a)(Sh.a,zb).te(Ca.$b).htmlElement:null}hSd(Ca,zb){Ca=nh.i(Ca.Cb,5);for(const pc of Ca)if(pc.properties.getValue(Cg.a.qhb)===zb)return pc;return null}Cai(Ca,zb){Ca=eg.GraphIterator.eb(Ca.Cb);let pc=Ca.Ub(6);for(;pc;){const Dc=pc.properties.getValue(Cg.a.qhb);if(sh.ImageReader.Mt(pc)&&Dc===zb)return pc;pc=Ca.Mf(6)}return null}E0l(Ca){const zb=Lf.a.nf(sh.ImageReader.oF(Ca),0);Ca=Lf.a.nf(sh.ImageReader.JG(Ca),1);return{Rka:zb,hum:Ca}}Eai(Ca){Ca=
this.Gl(Ca,this.Dp.ip.shapeId);return sh.ImageReader.o0(Ca)}wai(Ca){var zb=this.Dp.ip;if(!zb||!zb.shapeId)return null;var pc=this.Gl(Ca,zb.shapeId);const Dc=this.Brf(Ca,zb.shapeId);if(!pc||!Dc)return null;const dc=sh.ImageReader.ui(pc);let he=Ca=1,Rc;({Rka:zb,hum:Rc}=this.E0l(pc));Ma.App.instance&&Ma.App.instance.HR(dc)?(pc=sh.ImageReader.zoa(pc),Ca=Lf.a.nf(pc[bg.a.left],0),he=Lf.a.nf(pc[bg.a.top],1)):pc.hasProperty(Cg.a.Tda)?(pc=pc.getValue(Cg.a.Tda),Ca+=Lf.a.nf(pc[bg.a.left],0),he+=Lf.a.nf(pc[bg.a.top],
1)):(Ca+=0<Dc.offsetWidth?(Dc.offsetWidth-zb)/2:2,he+=0<Dc.offsetHeight?(Dc.offsetHeight-Rc)/2:2);return new Sys.UI.Bounds(Math.round(Ca),Math.round(he),Math.round(zb),Math.round(Rc))}APi(){this.hn&&(this.hn.$lc(),this.Qra=1)}nRb(){for(const Ca of this.hn.zae)if(Ca.clientId===this.Dp.user.clientId&&!Ca.equals(this.Dp.user)){this.hn.rga(this.Dp.user);break}if(this.Dp.IUa||2===this.Qra)this.hn.X$c(),this.Dp.IUa=!1,this.Dp.jda=!0,this.Qra=2;this.Dp.jda&&1!==this.Qra||(this.hn.$lc(),this.Dp.jda=!0,this.Qra=
1)}}rg.$Gn="WACImgPresenceHighlight";rg.Pra=20;rg.$Lo=6;Object(l.a)(rg,"PresenceImageControl",Xf,[]);var Hm=c(278);class pf{constructor(){this.height=this.top=this.left=this.$ui=0;this.d8a=!1;this.bC=this.Lh=null}}Object(l.a)(pf,"PresenceIpControlStyle",null,[1263]);var vh=c(62);class ri extends Xf{constructor(Ca,zb,pc,Dc,dc,he=null,Rc=null,qe=null){super(Ca,zb,pc,Dc,dc,he,Rc);this.BDc=this.NXa=this.w0b=null;this.KP=bf=>{!this.hn||this.P5a&&!this.hn.sjf(bf)||(this.DQf(),this.Cfe(bf));this.AFj(this.und);
return!1};this.SJ=()=>{this.hn&&this.zR();return!1};this.W8d=bf=>{this.hn&&3===bf.kg&&(2!==this.Qra?(this.DQf(),this.Cfe(bf)):this.zR());return!1};this.ED=qe}Vaf(Ca){this.element=Ca.createElement("div");this.element.setAttribute(Xf.Q3i,!0);vf.a.Sl(this.element,Xf.G_i,this);this.element.className=Xf.Ryn;this.element.dir=m.AFrameworkApplication.isRtl?"rtl":"ltr";this.Bs.ob(hd.a.pointerOver,this.element,this.KP);this.P5a&&(this.Bs.ob(hd.a.pointerOut,this.element,this.SJ),this.Bs.ob(hd.a.pointerDown,
this.element,this.W8d));this.NXa=this.createElement("div");this.NXa.className=ri.aHn;this.P5a||(this.BDc=this.createElement("div"),this.BDc.className=ri.dHn,this.NXa.appendChild(this.BDc));this.hn=this.vEc.Raf(this.createElement("div"),this.P5a);Ca=this.Ca.$("NoPresenceUserLookUpBeforeRender");this.ED&&!Ca&&(this.Dp.user=this.ED.ZNf(this.Dp.user.clientId)||this.Dp.user);this.hn.rga(this.Dp.user);this.hn.hide();this.hn.element.classList.add(this.P5a?Xf.R3i:ri.kCn);this.NXa.appendChild(this.hn.element);
this.element.appendChild(this.NXa)}Okl(){this.w0b&&(cc.a.instance.ff(this.w0b),this.w0b=null)}nRb(Ca){for(var zb of this.hn.zae)if(zb.clientId===this.Dp.user.clientId&&!zb.equals(this.Dp.user)){this.hn.rga(this.Dp.user);break}zb=!1;ri.Cil===this.Dp.user.color?({value:zb}=this.dth.Fc(this.Dp.user.clientId,!1),zb||(this.dth.Z(this.Dp.user.clientId,!0),k.ULS.sendTraceTag(17954772,302,50,'{ "ClientID" : "'+this.Dp.user.clientId+'" , "Event" : "RenderGrayPawn"}'))):({value:zb}=this.Qej.Fc(this.Dp.user.clientId,
!1),zb||(this.Qej.Z(this.Dp.user.clientId,!0),k.ULS.sendTraceTag(17954773,302,50,'{ "ClientID" : "'+this.Dp.user.clientId+'" , "Event" : "RenderColoredPawn"}')));return Ca||this.Dp.IUa||2===this.Qra?(this.nLi(),this.hn.X$c(),this.Dp.IUa=!1,this.Dp.jda=!0,this.Qra=2,ri.HKo):this.Dp.jda&&1!==this.Qra?0:(this.nLi(),this.hn.$lc(),this.Dp.jda=!0,this.Qra=1,ri.GKo)}Cfe(Ca=null){this.Okl();const zb=this.nRb(!!Ca);this.P5a&&Ca&&Ca.eventName===hd.a.pointerOver||this.pbo(zb)}zR(){this.hn&&this.Qra&&(this.I6n(),
this.hn.hide(),this.Qra=0)}pbo(Ca){this.w0b=new qa.a(2,1,Ca,()=>{this.w0b=null;this.zR()},56);cc.a.instance.Wb(this.w0b)}updatePosition(Ca){if(this.element&&this.element.parentNode){var zb=this.lbi(Ca);if(zb){Ca=Sys.UI.DomElement.getBounds(this.element.parentNode);zb=new Sys.UI.Bounds(zb.x-Ca.x,zb.y-Ca.y,ri.dvi,zb.height);var pc;({left:Ca,top:zb,height:pc}=this.N$l(zb,Ca,this.element.parentNode,this.vj.instance));this.element.style.height=2*ri.Ahc+pc+"px";this.element.style.top=zb-ri.Ahc+"px";this.element.style.left=
Ca-ri.Ahc+"px";this.NXa.style.height=Math.max(ri.pPi,pc)+"px";this.Cfe()}}}gZ(){this.element&&(Me.a.qx(this.element),this.Jce())}dIh(Ca,zb,pc,Dc,dc){const he=new pf;if(!Dc||!pc)return he;Dc=this.lbi(Ca);if(!Dc)return he;var Rc=pc;pc=Ca;if(Ca.gk){var qe=Ca.nc;Rc=Ca.Xg.T$b(this.Dp.ip.o$.cp);0>Rc&&0==Rc;Ca.nc.Bxa?Me.a.jRa(qe.editingElement,Ca.Xg.hj.J(Rc))||(pc=vh.InteractiveViewManager.instance.yd.zj(Ca.source),zb=pc.Xg.hj.J(Rc)):zb=pc.Xg.hj.J(Rc);Rc=zb.getBoundingClientRect()}Rc=new Sys.UI.Bounds(Dc.x-
Rc.x,Dc.y-Rc.y,ri.dvi,Dc.height);Ca=Rc.y;Dc=Rc.x;Rc=Rc.height;qe=this.vj.instance;dc&&qe&&(dc=qe.nj,Ca=Math.round(Ca/dc),Dc=Math.round(Dc/dc),Rc=Math.round(Rc/dc));he.top=Ca-ri.Ahc;he.left=Dc-ri.Ahc;he.height=2*ri.Ahc+Rc;he.$ui=Math.max(ri.pPi,Rc);he.d8a=!0;he.Lh=zb;he.bC=pc;return he}zcj(Ca,zb,pc,Dc){Xf.HKi();this.und=Ca;Ca=pc.Lh;zb=pc.bC;if(Ca&&zb){if(Dc){const dc=!this.element;dc&&this.Vaf(Ca.ownerDocument);dc||!this.element.parentNode?Ca.appendChild(this.element):this.element.parentNode!==Ca&&
(this.element.parentNode.removeChild(this.element),Ca.appendChild(this.element));this.und=zb;Ca=this.Dp.user.color;this.NXa.style.borderColor=Ca;this.P5a||(this.BDc.style.borderColor=Ca);this.element.id=Xf.Aib(this.Dp);pc.d8a&&(this.element.style.height=pc.height+"px",this.element.style.top=pc.top+"px",this.element.style.left=pc.left+"px",this.NXa.style.height=pc.$ui+"px",this.Cfe())}this.PZc=!Dc;this.Jce()}else k.ULS.sendTraceTag(520950942,302,50,`Skip IpControl rendering due to paragraphElement is null:${!Ca} or paragraphViewElement is null:${!zb}`)}dispose(){this.element&&
(this.gZ(),this.Bs.sc(hd.a.pointerOver,this.element,this.KP),this.P5a&&(this.Bs.sc(hd.a.pointerOut,this.element,this.SJ),this.Bs.sc(hd.a.pointerDown,this.element,this.W8d)),Jd.a.jC(this.hn),this.element=this.hn=null);super.dispose()}AFj(Ca){const zb=this.Dp.user.color;this.NXa.style.borderColor=zb;this.P5a||(this.BDc.style.borderColor=zb);this.element.id=Xf.Aib(this.Dp);this.updatePosition(Ca)}N$l(Ca,zb,pc,Dc){let dc=Ca.y,he=Ca.x;Ca=Ca.height;(1<Math.abs(zb.width-pc.offsetWidth)||1<Math.abs(zb.height-
pc.offsetHeight))&&Dc&&(dc=Math.round(dc/Dc.nj),he=Math.round(he/Dc.nj),Ca=Math.round(Ca/Dc.nj));return{left:he,top:dc,height:Ca}}lbi(Ca){const zb=this.Dp.ip;if(!zb)return null;let pc;try{const Dc=zb.o$.cp;pc=Hm.a.O_(Dc,Ca,0<Dc,!1,!1,!1)}catch(Dc){k.ULS.sendTraceTag(4301318,302,15,"Could not determine the bounds of IP: isYielding={0} message={1} stack={2}",cc.a.instance.Rv,Dc.message,Dc.stack),pc=null}return pc}}ri.kCn="WacPawn";ri.dvi=2;ri.GKo=7E3;ri.HKo=2E3;ri.Ahc=5;ri.aHn="presenceIp";ri.dHn="PresenceSmallBox";
ri.pPi=10;ri.Cil="0xcccccc";Object(l.a)(ri,"PresenceIpControl",Xf,[]);class tl{constructor(Ca,zb,pc,Dc,dc=null,he=null,Rc=null){this.ltc={};this.jtc={};this.cPg={};this.vEc=Ca;this.Bs=zb;this.kn=pc;this.MKa=Dc;this.SW=dc;this.Ca=he;this.ED=Rc}get ghl(){return this.ltc}get jPh(){return this.jtc}J$l(Ca){const zb=!!this.Ca&&this.Ca.$("PeoplesWellExtraButtonInfoIsEnabled");return Ca.ip.shapeId&&zb?this.O$l(Ca):this.P$l(Ca)}O$l(Ca){const zb=Ca.ip.shapeId.toString();this.cPg[Ca.user.clientId]=zb;const pc=
this.jtc[zb];return pc?(pc.Dp=Ca,{returnValue:pc,ape:!0}):{returnValue:this.jtc[zb]=new rg(Ca,this.vEc,this.Bs,this.kn,this.MKa,this.SW,this.Ca),ape:!1}}P$l(Ca){const zb=Ca.user.clientId,pc=this.ltc[zb];return pc&&pc.Dp.user.equals(Ca.user)?(pc.Dp=Ca,{returnValue:pc,ape:!0}):{returnValue:this.ltc[zb]=new ri(Ca,this.vEc,this.Bs,this.kn,this.MKa,this.SW,this.Ca,this.ED),ape:!1}}mbi(Ca){return this.ltc[Ca]}A0l(Ca){return(Ca=this.jtc[this.cPg[Ca]])&&!Ca.cpe()?Ca:null}lql(){var Ca=this.ltc;for(const zb in Ca)Ca[zb].dispose();
Ca=this.jtc;for(const zb in Ca)Ca[zb].dispose()}}Object(l.a)(tl,"PresenceControlProvider",null,[]);var ci=c(163);class Li{constructor(){this.Tcb=0}cdi(){this.Tcb++;this.Tcb===Number.MAX_VALUE&&(this.Tcb=1);return this.Tcb}static get instance(){return Li.GAc}}Li.GAc=new Li;Object(l.a)(Li,"PacketIdGenerator",null,[198]);class kj{constructor(Ca,zb,pc){this.Cbo=Ca;this.iym=zb;this.aGi=pc}}Object(l.a)(kj,"SuccessfulInboundReplicationCallbackData",null,[]);class El{constructor(Ca,zb,pc,Dc,dc,he,Rc){this.j$n=
(qe,bf)=>{bf.type||(qe=this.Wk.WVh>=this.M1j,this.Imk&&qe?(qe=this.MCe())?qe.NXh():k.ULS.sendTraceTag(19682513,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt."):this.kF())};this.Xun=qe=>{if(qe=Object(y.a)(kj,qe)){var bf=qe.iym.oi.toString(),Cf=this.MCe(),bh=Cf.Pu,Lg="";bh!==qe.aGi&&(k.ULS.sendTraceTag(19964236,500,50,"Time saved due to force inbound on update notification message = {0} ms",qe.Cbo.toString()),Lg=this.b6l(Cf,bh,qe.aGi));k.ULS.sendTraceTag(19964237,
500,50,"Revisions: {0}, InboundDuration: {1}",Lg,bf)}else k.ULS.sendTraceTag(19964235,500,10,"The callback data was null")};this.b$n=Ca;this.MCe=zb;this.Wk=pc;this.Imk=dc;this.M1j=he;this.zYb=Dc;this.eq=Rc;this.b$n.T3(this.j$n)}kF(){const Ca=this.MCe();if(!Ca)k.ULS.sendTraceTag(19682514,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt.");else if(!this.zYb()&&Ca.aSa){let zb=-1;null!=Ca&&(zb=Ca.nza());const pc=this.eq.Zf("Task","ShoulderTapInboundReplicationTimer");
Ca.kF(this.Xun,null,new kj(zb,pc,Ca.Pu))}}b6l(Ca,zb,pc){const Dc=new Sys.StringBuilder;Ca=Ca.node.xd.store.getRevision(zb);if(!Ca)return k.ULS.sendTraceTag(19964238,500,10,"The revision we got from the last replicator revisionId was null - {0}",{["lastRevisionId"]:zb}),"";for(Dc.append(Ca.id.guid);zb!==pc;){Dc.append(", ");Dc.append(zb.guid);Ca=Ca.Fn;if(!Ca)break;zb=Ca.id}return Dc.toString()}}Object(l.a)(El,"ContentNotificationManager",null,[]);class Ph extends El{constructor(Ca,zb,pc,Dc,dc,he,Rc){super(Ca,
zb,pc,Dc,dc,he,Rc)}static get jra(){return null!=Ph.CGg?Ph.CGg:Ph.CGg=Ra.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}static init(){if(Ma.App.za){var Ca=Ma.App.za.jb;Ca&&(Ca.sga(Ph.V1c),Ca=Ca.Zc)&&(Ph.yH=Ca.contentReplicator,Ph.yH&&Ma.App.Uoa().continueWith(Ph.XVf))}}static XVf(){Ph.gid=Ma.App.Uoa().result;Ph.gid&&Ph.gid.Uo&&Ph.jra.aE().continueWith(Ph.F2c)}static F2c(){Ph.kj=Ph.jra.aE().result;if(Ph.kj){var Ca=m.AFrameworkApplication.K,zb=Ca.$("Box4ThrottleInboundRequests");Ca=Ca.mc("Box4ThrottleInboundsAtUserCount",
20);Ph.yH.kUd=()=>Ph.kj.oSa;Ph.did=Ph.did||new Ph(Ph.kj,()=>Ph.yH,Ph.gid,()=>m.AFrameworkApplication.Rk,zb,Ca,Ma.App.za.Lq);Ph.did.kF()}}static V1c(Ca){Ph.did||(Ca.gpb(Ph.V1c),Ph.init())}}Ph.did=null;Ph.kj=null;Ph.yH=null;Ph.gid=null;Object(l.a)(Ph,"WordContentNotificationManager",El,[]);var ji=c(57);class ej{constructor(Ca,zb,pc,Dc,dc,he){this.gjd=null;this.Gbh=Ca;this.ud=pc;this.JMa=Dc;this.jz=dc;this.Ah=he;this.qsb=zb}clone(){return new ej(this.Gbh,this.qsb.clone(),this.ud,this.JMa,this.jz,this.Ah)}get cp(){if(null!=
this.gjd)return this.gjd;var Ca=this.Gbh.paragraphId;if(Ca.equals(Wc.a.nil))return 0;var zb=this.JMa();if(!zb)return 0;Ca=zb.Eb(Ca);if(!Ca)return k.ULS.sendTraceTag(7685326,302,15,"Paragraph Node is null so returning a CP with value 0"),0;zb=this.ud.ZCb(this.ud.eTa(Ca.characterData,Ca.qa),this.qsb);if(ji.a.Xj&&this.jz){var pc=Vb.a.Rc(Ca,zb);this.Ah&&Ca.Ms&&(pc.Fb=this.Ah.eTd(Ca,zb,this.qsb.vva));zb=this.jz.Zba(pc,!0)}else this.jz&&this.Ah&&Ca.Ms&&(pc=Vb.a.Rc(Ca,zb),pc.Fb=this.Ah.eTd(Ca,zb,this.qsb.vva),
zb=this.jz.Zba(pc,!0));return zb}hYf(){null==this.gjd&&(this.gjd=this.cp)}equals(Ca){return Ca?this.qsb.isEqual(Ca.qsb,!1):!1}}Object(l.a)(ej,"WordPresenceCp",null,[174,72,175]);class Hk{constructor(Ca,zb){this.jz=Ca;this.Ah=zb}create(Ca,zb,pc,Dc){return new ej(Ca,zb,pc,Dc,this.jz,this.Ah)}}Object(l.a)(Hk,"Factory",null,[148]);class Yk extends Sys.EventArgs{constructor(Ca,zb,pc){super();this.paragraphId=Ca;this.presence=zb;this.rDf=pc}}Object(l.a)(Yk,"ParagraphChangedEventArg",Sys.EventArgs,[]);class nn{constructor(Ca){this.cp=
Ca}equals(Ca){return Ca?this.cp===Ca.cp:!1}clone(){return new nn(this.cp)}}Object(l.a)(nn,"PresenceCp",null,[174,72]);class Yl{constructor(Ca,zb,pc,Dc,dc){this.paragraphId=Ca;this.cp=zb;this.length=pc;this.shapeId=Dc;this.dryDeletion=dc}}Object(l.a)(Yl,"SerializablePresenceIpData",null,[]);class Hh{constructor(Ca,zb,pc,Dc=0,dc=0){this.Kta=null;Ca&&(this.Kta=Wc.a.If(Ca));this.Fbh=new nn(zb);this.SHa=pc;this.igh=Dc;this.GTg=dc}get paragraphId(){return this.Kta}get o$(){return this.Fbh}get shapeId(){return this.igh}get dryDeletion(){return this.GTg}isValid(){return 0<=
this.o$.cp&&!!this.paragraphId&&!this.paragraphId.equals(Wc.a.nil)}getData(){return new Yl(this.paragraphId.toString(),this.o$.cp,this.SHa,this.shapeId,this.dryDeletion)}clone(){const Ca=new Hh;Ca.Kta=this.paragraphId;Ca.Fbh=this.o$?this.o$.clone():null;Ca.SHa=this.SHa;Ca.igh=this.shapeId;Ca.GTg=this.dryDeletion;return Ca}static dDb(Ca){return Ca.paragraphId&&void 0!==Ca.cp&&null!==Ca.cp&&void 0!==Ca.length&&null!==Ca.length?new Hh(Ca.paragraphId,Ca.cp,Ca.length,void 0,Ca.dryDeletion):null}}Object(l.a)(Hh,
"PresenceIp",null,[172,72]);class bn{constructor(Ca,zb){this.ip=Ca;this.user=zb}}Object(l.a)(bn,"SerializablePresenceData",null,[]);class lj{constructor(Ca,zb){this.IUa=this.jda=this.Jfc=!1;this.MXa=zb;this.user=Ca}get ip(){return this.MXa}Buf(){return new bn(this.ip?this.ip.getData():null,this.user.getData())}Z$h(){return this.user.clientId+(this.MXa?this.MXa.paragraphId.toString():Wc.a.nil.toString())}isValid(){const Ca=!!this.user&&this.user.isValid(),zb=!this.ip||this.ip.isValid();return Ca&&
zb}clone(){const Ca=new lj;Ca.user=this.user?this.user.clone():null;Ca.MXa=this.MXa?this.MXa.clone():null;Ca.jda=this.jda;Ca.Jfc=this.Jfc;Ca.IUa=this.IUa;return Ca}static dDb(Ca){return Ca?new lj(Xa.dDb(Ca.user),Ca.ip?Hh.dDb(Ca.ip):null):null}}Object(l.a)(lj,"PresenceInfo",null,[192,72]);class il extends Fa.a{constructor(){super();this.SAc={};this.yWa={};this.PVg=!1}get Wzn(){return this.SAc}get OAi(){return!!m.AFrameworkApplication.K&&m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")}Grh(Ca){this.addHandler("PPC",
Ca)}fcj(Ca){this.removeHandler("PPC",Ca)}xRc(Ca){return Ca.ip.paragraphId.toString()}r_e(Ca,zb=!1){this.PVg||(this.PVg=!0,k.ULS.sendTraceTag(4289312,302,50,"First presence added to data manager"));var pc=({bHn:Dc}=this.ZWm(Ca)).returnValue;if(Dc&&!zb)(pc=this.yWa[Ca.user.clientId])&&0<=pc.length&&(pc[pc.length-1].ip.SHa=Ca.ip.SHa);else{pc||this.Vaj(Ca.user.clientId);this.OAi&&pc&&this.gXo(Ca);zb=this.xRc(Ca);var Dc=Ca.user.clientId;var dc=this.SAc[zb]||[],he=this.yWa[Dc]||[];he.length>=il.$Ni&&(he=
he.splice(-il.ujn,il.$Ni));pc||dc.push(Dc);he.push(Ca);this.SAc[zb]=dc;this.yWa[Dc]=he;Ca.ip.paragraphId.equals(Wc.a.nil)||this.z5f(Ca.ip.paragraphId,Ca,!0)}}ZWm(Ca){var zb=this.yWa[Ca.user.clientId];const pc=!zb||0>=zb.length?null:zb[zb.length-1],Dc=!!pc&&this.xRc(pc)===this.xRc(Ca);zb=Dc&&pc.ip.o$.equals(Ca.ip.o$)&&pc.user.equals(Ca.user);this.OAi&&zb&&pc.ip.shapeId&&Ca.ip.shapeId&&pc.ip.shapeId!==Ca.ip.shapeId&&(zb=!1);return{returnValue:Dc,bHn:zb}}gXo(Ca){const zb=this.thl(Ca);zb&&zb.ip.shapeId&&
(Ca.ip.shapeId&&Ca.ip.shapeId===zb.ip.shapeId||this.z5f(zb.ip.paragraphId,zb,!1))}thl(Ca){Ca=this.yWa[Ca.user.clientId];return!Ca||0>=Ca.length?null:Ca[Ca.length-1]}Vaj(Ca){const zb=this.yWa[Ca];if(zb&&0<zb.length){const pc=zb[0].ip.paragraphId,Dc=this.xRc(zb[0]);delete this.yWa[Ca];this.$_n(Dc,Ca);pc.equals(Wc.a.nil)||this.z5f(pc,zb[0],!1)}}$6h(Ca){return this.SAc[Ca]}wPc(Ca,zb,pc,Dc=!1){const dc=[],he=this.$6h(Ca);if(!he)return dc;for(let Rc=0;Rc<he.length;Rc++){const qe=he[Rc],bf=this.yWa[qe];
let Cf=!1;for(let bh=bf.length-1;0<=bh;bh--){const Lg=bf[bh];if(Dc){if(Lg.jda&&Lg.ip.paragraphId.equals(Wc.a.If(Ca))){Cf=!0;dc.push(Lg);break}}else if(Object(rl.a)(lj,Lg)?Lg.ip.SHa===zb:Lg.ip.SHa===pc){Cf=!0;Lg.Jfc=!0;dc.push(Lg);this.yWa[qe]=bf.splice(bh,bf.length);break}}!Cf&&0<bf.length&&bf[0].Jfc&&bf[0].ip.paragraphId.equals(Wc.a.If(Ca))&&dc.push(bf[0])}return dc}zNl(Ca){if(!Ca||!Ca.Pa||!Ca.Pa.node)return null;Ca=this.wPc(Ca.Pa.node.id.toString(),0,0,!0);Ca=this.hkm(Ca);Ca.sort((zb,pc)=>{if(!(zb&&
zb.userName&&pc&&pc.userName))return k.ULS.sendTraceTag(542165082,302,15,"Missing presence user info for user in PresenceInfos"),0});return Ca}hkm(Ca){if(!Ca||!Ca.length)return[];const zb=[],pc=new M.a(K.a.ih());for(let Dc=0;Dc<Ca.length;Dc++){const dc=Ca[Dc].user;dc.isAnonymous&&pc.contains(dc.clientId)||!dc.isAnonymous&&dc.email&&pc.contains(dc.email)||(zb.push(dc),pc.add(dc.isAnonymous?dc.clientId:dc.email))}return zb}z5f(Ca,zb,pc){this.raiseEvent("PPC",new Yk(Ca,zb,pc))}$_n(Ca,zb){Array.remove(this.SAc[Ca],
zb)}}il.$Ni=10;il.ujn=2;Object(l.a)(il,"PresenceDataManager",Fa.a,[1216]);class zk extends il{constructor(Ca){super();this.wH=Ca}r_e(Ca,zb=!1){super.r_e(Ca,zb)}xRc(Ca){return Ca.ip.Wc.toString()}$6h(Ca){Ca=this.wH.Eb(Wc.a.If(Ca));if(!Ca)return null;Ca=Ca.ja(Cg.a.Wc,0);return this.Wzn[Ca.toString()]}}Object(l.a)(zk,"WordPresenceDataManager",il,[]);var Im=c(1504),zd=c(1085),hf=c(1895),Mi=c(17);class Rl{constructor(Ca,zb,pc,Dc,dc,he,Rc,qe,bf,Cf,bh,Lg,Th,ak,Ih,xj,Uh,ul,ti,Vh,Ad,Id,xe,ke){this.INa=Array(5);
this.sXe=this._started=this.sSe=!1;this.UOe=null;this.gch=new M.a(K.a.ih());this.Gtd={};this.oHe=!1;this.Czn=()=>{if(!this.sXe&&!this.Zl.Ny){var Gj=new qa.a(0,1,20,()=>{const Ni=new R.a;var Bh=this.bdb.ghl;for(var Nk in Bh){const Nh=Bh[Nk];Nh.PZc&&Ni.add(Nh.Dp.ip.paragraphId)}if(this.y6d){Bh=this.bdb.jPh;for(const Nh in Bh)Nk=Bh[Nh],Nk.PZc&&!Ni.contains(Nk.Dp.ip.paragraphId)&&Ni.add(Nk.Dp.ip.paragraphId)}this.k5h(Ni);this.sXe=!1},72);this.Ib.Wb(Gj);this.sXe=!0}};this.HVi=()=>{this.sSe&&(this.ccg(),
this.sSe=!1)};this.t5=(Gj,Ni)=>{this.Ojj(Ni.yl.lb)};this.r5=(Gj,Ni)=>{Gj=Ni.Zra;for(var Bh in Gj){const Nk=Gj[Bh];this.Ca.$("CashTelemetryIsEnabled")&&this.lNc(Nk,new Date,null);Nk.ip?this.k_e(Nk):this.T6c(Nk.user.clientId)}Ni=Ni.vLd;for(Bh=0;Bh<Ni.length;++Bh)this.Dll(Ni[Bh]);this.Ude()};this.iYf=(Gj,Ni)=>{Ni.paragraphId?this.jZo(Ni.paragraphId.toString(),Ni.G0m,this.Gtd):k.ULS.shipAssertTag(8758481,302,!1,"null paraid")};this.S3i=(Gj,Ni)=>{Ni.paragraphId&&(Gj=this.XF.Eb(Ni.paragraphId))&&((Object(rl.a)(lj,
Ni.presence)?this.CCe(Gj):this.DCe(Gj))===Ni.presence.ip.SHa&&this.vbo(Ni.paragraphId),this.y6d&&this.cHn(Ni))};this.hw=Ca;this.hb=Dc;this.ED=dc;this.kyb=he;this.Zl=bf;this.K1j=Cf;this.bdb=bh;this.XF=pc;this.MXg=Lg;this.CCe=Th;this.DCe=ak;this.LUj=Rc;this.N1j=qe;this.DMa=Ih;this.Sq=xj;this.Lc=Uh;this.Ib=ul;this.sjh=Id;this.Kgk=ke;this.VOe=Vh;this.Ca=Ad;this.jtd=zb;Rl.nud=new Yb.a;for(Ca=0;Ca<this.jtd.length;Ca++)this.jtd[Ca].pXn(this);this.kyb.Grh(this.S3i);this.hw.D_a(this.r5);xe&&this.Zl.tga(this.Czn);
this.hw.nde(this)}get y6d(){return!!this.Ca&&this.Ca.$("PeoplesWellExtraButtonInfoIsEnabled")}Ude(Ca=!1){this.sjh&&!Ca||this.vcj()}vcj(){const Ca=new R.a,zb=this.Gtd;for(const pc in zb)Ca.add(Wc.a.If(pc));this.k5h(Ca);this.Gtd={}}ccg(){this.hb.ib&&this.Ojj(this.hb.ib.lb,!0)}Ojj(Ca,zb=!1){this.Kgk||(this.XF.Am.Cia||zb?Ca?(zb=this.Kdl(Ca))?this.hw.kcg(zb):(this.hw.kcg(null),k.ULS.sendTraceTag(4281418,302,50,"Not supported selection context {0}",Ca.Pa.contextId)):this.hw.kcg(null):this.sSe=!0)}Kdl(Ca){if(!this.y6d||
!Ca.Vlb)if(Ca=Mi.SelectionEditor.Jj(Ca,!0,!1),!Mi.SelectionEditor.Pl(Ca))return null;return this.tzh(Ca)}tzh(Ca){const zb=Ca.Pa.cpBegin,pc=Ca.Pa.node.id;Ca=this.CCe(Ca.Pa.node);return new Hh(pc.toString(),zb,Ca)}lNc(Ca,zb,pc){if(this.VOe)if(Ca&&Ca.user&&Ca.user.clientId){var Dc=Ca.user.clientId;this.gch.contains(Dc)||(this.UOe?(this.UOe.lNc(Dc,zb,null,Rl.Fcm(pc||Ca.user.client)),this.gch.add(Dc)):this.VOe.continueWith(()=>{this.UOe=this.VOe.result;this.lNc(Ca,zb,pc)}))}else k.ULS.sendTraceTag(42262876,
302,15,"invalid presence")}L$l(Ca){const zb=new R.a;for(let pc=0;pc<Ca.length;pc++)zb.add(this.Yjm(Ca[pc]));return zb}k_e(Ca){var zb=null;Ca&&Ca.user&&(zb=Ca.user.client);Ca=Ca.clone();Ca.user=this.ED.ZNf(Ca.user.clientId)||Ca.user;this.Ca.$("CashTelemetryIsEnabled")&&this.lNc(Ca,new Date,zb);Ca.isValid()&&!Ca.user.qL()&&(zb=Ca.user.clientId,Rl.nud.nb(zb)||this.bmi(zb),this.YYo(zb),Ca.user.userName=CommonUIStrings.l_AnonymousUserName);this.kyb.r_e(Ca,!1)}YYo(Ca){const {value:zb}=Rl.nud.Fc(Ca,!1);
zb||(Rl.nud.Z(Ca,!0),k.ULS.sendTraceTag(17954774,302,50,'{ "ClientID" : "'+Ca+'" , "Event" : "CreateAnonymousGrayPawn"}'))}bmi(){}T6c(Ca){this.kyb.Vaj(Ca)}Dll(Ca){this.T6c(Ca);const zb=this.bdb.mbi(Ca);zb&&(zb.Abj(this.iYf),zb.dispose());this.y6d&&(Ca=this.bdb.A0l(Ca))&&(Ca.Abj(this.iYf),Ca.dispose())}u$b(Ca){if(12!==Ca.type)return new R.a;Ca=this.kyb.wPc(Ca.id.toString(),this.CCe(Ca),this.DCe(Ca));return 0>=Ca.length?new R.a:this.L$l(Ca)}jZo(Ca,zb,pc){!zb&&Ca in pc&&delete pc[Ca]}dispose(){this.stop();
this.kyb.fcj(this.S3i);this.hw.dPb(this.r5);this.hw.Rog(this);for(let Ca=0;Ca<this.jtd.length;Ca++)this.jtd[Ca].TSo(this);Jd.a.Pag([this.LUj,this.N1j,this.hw]);this.bdb.lql()}Yjm(Ca){let zb=!1;Ca=({ape:zb}=this.bdb.J$l(Ca)).returnValue;zb||Ca.$wk(this.iYf);return Ca}iki(Ca){Ca=this.XF.Eb(Ca);if(!Ca)return this.INa[0]||(k.ULS.sendTraceTag(4281420,302,50,"Could not find the node in object space"),this.INa[0]=!0),null;if(!Qb.ParagraphReader.Xb(Ca))return this.INa[1]||(k.ULS.sendTraceTag(4281421,302,
50,"Not a paragraph node"),this.INa[1]=!0),null;if(!Ca.te(this.Zl.$b))return this.INa[2]||(k.ULS.sendTraceTag(4281422,302,50,"No ViewElement found for this node"),this.INa[2]=!0),null;if(!Ca.anchor)return this.INa[3]||(k.ULS.sendTraceTag(4281423,302,50,"node is not anchored"),this.INa[3]=!0),null;this.INa[4]||(k.ULS.sendTraceTag(4564931,302,50,"Valid paragraph node found for rendering ip"),this.INa[4]=!0);return Ca}Aaj(Ca){Ca=this.kyb.wPc(Ca.toString(),-1,-1,!0);if(!$c.a.af(Ca))for(const zb of Ca)(Ca=
this.bdb.mbi(zb.user.clientId))&&Ca.element&&Ca.gZ()}k5h(Ca){if(Ca.count){var zb=new R.a;for(var pc of Ca)(Ca=this.iki(pc))?zb.add(Ca):this.Aaj(pc);if(zb.count){pc=this.Lc.Pc(2);try{pc.set(this.Sq);for(const Dc of zb)this.fUh(Dc)}finally{pc&&pc.dispose()}}}}fUh(Ca){Ca.pL(this.Zl.$b,32,!0);Ca.pL(this.K1j,32,!0)}vbo(Ca){this.Gtd[Ca.toString()]=null;this.sjh&&!this.oHe&&(Ca=new qa.a(0,1,200,()=>{this.oHe=!1;this.vcj()},70),this.Ib.Wb(Ca),this.oHe=!0)}cHn(Ca){if(Ca.presence.ip.shapeId&&!Ca.rDf){var zb=
this.bdb.jPh[Ca.presence.ip.shapeId.toString()];zb&&zb.j7a(Ca.presence.user.clientId)}}stop(){this._started&&(this._started=!1,this.hb.hZ(this.t5),this.MXg.R1n(this.HVi))}start(){if(!this._started){this._started=!0;this.hb.Ww(this.t5);this.MXg.qrh(this.HVi);var Ca=this.hw.CFb();delete Ca[this.DMa.clientId];this.r5(null,new hf.a(Ca,[]));this.ccg()}}mje(Ca){if(Ca&&Ca.isValid()&&Ca.ip){var zb=this.kyb.wPc(Ca.ip.paragraphId.toString(),-1,-1),pc=!1,Dc=null;for(let dc=0;dc<zb.length;dc++)if(Dc=zb[dc],Dc.user.clientId===
Ca.user.clientId){pc=Dc.IUa=!0;break}if(pc)if(zb=Dc.ip.paragraphId,Ca=this.iki(zb)){zb=this.Lc.Pc(2);try{zb.Db(Ca),this.fUh(Ca)}finally{zb&&zb.dispose()}}else this.Aaj(zb)}}static Fcm(Ca){return Ca?Ca?1===Ca?1:2===Ca?2:0:2:0}}Rl.nud=null;Object(l.a)(Rl,"PresenceManager",null,[1212,9,122,1213,1214,1215]);class me{constructor(Ca,zb,pc,Dc){this.UVb=null;this._started=this.OFe=!1;this.lAb=null;this.xqa=(dc,he)=>{if(!m.AFrameworkApplication.Rk&&(dc=this.CGj(he.yl),this.UVb&&dc)){dc=this.rye.wPc(this.UVb.toString(),
-1,-1,!0);for(he=0;he<dc.length;he++)this.lAb[dc[he].user.clientId]=dc[he];0>=dc.length||(dc=this.kal(dc),this.Xo.sendNotification(dc,!0))}};this.wXi=(dc,he)=>{this.hb.ib&&!m.AFrameworkApplication.Rk&&this.OFe&&this.UVb&&this.UVb.equals(he.paragraphId)&&(dc=null,!he.rDf||he.presence.user.clientId in this.lAb?he.rDf||(dc=this.yNh(he.presence.user.userName,!1),delete this.lAb[he.presence.user.clientId]):(dc=this.yNh(he.presence.user.userName,!0),this.lAb[he.presence.user.clientId]=he.presence),dc&&
this.Xo.sendNotification(dc,!0))};this.kj=Dc;this.hb=zb;this.rye=Ca;this.Xo=pc;this.kj.nde(this)}start(){this._started||(this._started=!0,this.lAb={},this.rye.Grh(this.wXi),this.hb.Ww(this.xqa),this.CGj(this.hb.ib))}stop(){this._started&&(this._started=!1,this.lAb=null,this.rye.fcj(this.wXi),this.hb.hZ(this.xqa))}kal(Ca){if(1===Ca.length)return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphSingle,Ca[0].user.userName);const zb=[],pc=Ca.length;for(let Dc=0;Dc<pc;Dc++)zb.push(Ca[Dc].user.userName);
return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphMany,zb.join(Box4Intl.Box4Strings.l_DisplayNameSeparator))}yNh(Ca,zb){return String.format(zb?Box4Intl.Box4Strings.l_UserJoiningParagraph:Box4Intl.Box4Strings.l_UserLeavingParagraph,Ca)}dispose(){this.kj.Rog(this);this.stop()}CGj(Ca){if(!Ca)return!1;Ca=Ca.lb;if(!Ca)return!1;Ca=Ca.Pa;if(!Ca)return!1;this.OFe=Mi.SelectionEditor.Ze(Ca);Ca=Ca.node.id;if(Ca.equals(this.UVb)||!this.OFe)return!1;this.UVb=Ca;this.lAb={};return!0}}Object(l.a)(me,
"PresenceAccessibilityManager",null,[9,122]);class qd{constructor(Ca,zb){this._started=!1;this.vK=null;this.Dod=!1;this.i2c=()=>{this._started&&this.yjj()};this.kj=Ca;zb&&(this.vK=zb,this.vK.Seb(this.i2c));this.kj.nde(this)}start(){this._started||(this._started=!0,this.vK?this.yjj():this.kj.qN(1,this.dMh()))}yjj(){const Ca=this.Dod;(this.Dod=!!this.vK.Vx)&&!Ca&&this.kj.qN(1,this.dMh())}dMh(){const Ca={};Ca.Id="{"+m.AFrameworkApplication.userSessionId.toUpperCase()+"}";Ca.HQ=!1;Ca.NT=1;Ca.WEB=!0;return Ca}stop(){this._started&&
(this._started=this.Dod=!1)}dispose(){this.kj.Rog(this);this.vK&&this.vK.Cbj(this.i2c)}}Object(l.a)(qd,"EditorsTableNotifier",null,[9,122]);var Yj=c(372),af=c(15);class Xe extends Rl{constructor(Ca,zb,pc,Dc,dc,he,Rc,qe,bf,Cf,bh,Lg,Th,ak,Ih,xj,Uh,ul,ti,Vh,Ad,Id,xe,ke,Gj,Ni,Bh,Nk,Nh,Vd,$p){super(Ca,zb,pc,Dc,dc,he,Rc,qe,bf,Cf,bh,Th,ak,Ih,xj,ti,Vh,Ad,Id,xe,ke,Gj,Ni,Nh);this.Wk=null;this.rul=kf=>{const kh=!!this.Wk.mC.z9b(kf);k.ULS.sendTraceTag(579179741,302,50,"ClientId:{0} isPresentAfterPoll:{1}",kf,
kh)};this.qul=(kf,kh)=>{k.ULS.sendTraceTag(579179742,302,15,"EditorsReplicator failed with {0} when looking for ClientId {1}",kh,kf)};this.fja=()=>{if(2===Xe.kj.connectionState&&!Oa.SessionStatusManager.instance.fda){const kf={};kf.qs=m.AFrameworkApplication.rootQuerySignature;Xe.kj.Prb(kf)}};Lg.fb(af.a.Qxo,Jb.a.application,Xe.xuk,64);Lg.fb(af.a.n8f,Jb.a.application,Xe.n8f,64);Lg.fb(af.a.Y4f,Jb.a.application,Xe.Y4f,96);Lg.fb(ob.a.mje,Jb.a.application,Xe.Pxo,64);this.XI=Uh;this.ud=ul;this.CAb=Bh;this.DMa.wic=
Nk;this.DMa.wic.hzk(Xe.xXi);Vd.continueWith(()=>{this.Wk=Vd.result});k.ULS.sendTraceTag(4006600,302,50,"WordPresenceManager Initialized");(this.w3=$p)&&this.w3.execute(kf=>{kf.A_a(this.fja)})}z$b(Ca){if(!Ca||!Ca.anchor)return null;for(Ca=Ca.anchor.Vp;Ca;Ca=Ca.NA)if(Ca.CGa)return Ca.us.node;return null}tzh(Ca){var zb=null;zb=m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled");var pc=Ca.Pa.cpBegin,Dc=Ca.Pa.node;zb&&sh.ImageReader.Mt(Dc)&&(Dc=this.z$b(Dc));if(!Dc)return k.ULS.sendTraceTag(51242309,
302,15,"selectedNode is null"),null;Dc=this.DCe(Dc);const dc=Ca.Pa.node.ja(Cg.a.Wc,0);if(!this.XI)return k.ULS.sendTraceTag(35997152,302,15,"paragraphWordIdMapping is null"),null;var he=this.XI.value.qjb(dc);const Rc=Xe.wH.Eb(he);if(!Rc)return k.ULS.sendTraceTag(16791249,302,15,"Can't find pid "+he),null;pc=this.ud.Gpc(this.ud.eTa(Rc.characterData,Rc.qa),pc);pc.vva=-1===Ca.Pa.Fb?0:Ca.Pa.Fb;he=0;zb&&Ca.Vlb&&(he=this.nem(Ca));return zb=new $e(this.XI.value,dc,Dc,pc,this.ud,()=>Xe.wH,this.CAb,he)}nem(Ca){const zb=
sh.ImageReader.vFa(Ca.Pa);return zb?zb.properties.ja(Cg.a.qhb,0):Ca.Pa.node.properties.ja(Cg.a.qhb,0)}bmi(Ca){this.Wk&&this.Wk.aoa&&this.Wk.aoa.kF(this.rul,this.qul,Ca)}dispose(){this.w3&&this.w3.execute(Ca=>{Ca.cPb(this.fja)});super.dispose()}static get Gv(){return Ra.a.instance.resolve("Common.Utils.IAriaNotifier")}static aE(){return Xe.bxc.task}static get_instance(){return Xe.mud.task}static Q$l(){return Xe.Hbh.task}static get jra(){return null!=Xe.BGg?Xe.BGg:Xe.BGg=Ra.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}static init(){Xe.mud||
(Xe.mud=new x.a);Xe.bWg&&(k.ULS.sendTraceTag(4256585,302,50,"WordPresenceManager Init"),Xe.bWg=!1);if(Ma.App.za){var Ca=Ma.App.za.jb;Ca?(Ca.sga(Xe.V1c),Xe.NAc=Ca.rc,Ca.Fpa()?(Xe.aO=Ca.Zc.contentReplicator,Xe.aO?(Xe.wH=Ca.Zc.xd,Xe.wH?Xe.jra.aE().continueWith(Xe.Ktn):k.ULS.sendTraceTag(4006599,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to content ObjectSpace of the app")):k.ULS.sendTraceTag(4252228,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to the GraphSpaceReplicator object")):
k.ULS.sendTraceTag(4006598,302,50,"PageView doesn't seem to have been initialized yet. Will try again once we know it's initialized")):k.ULS.sendTraceTag(4006597,302,15,"Can't initialize the WordPresenceManager because workspace is not initialized")}else k.ULS.sendTraceTag(4006596,302,15,"Can't initialize the WordPresenceManager because active AppFrame is not initialized")}static Ktn(){Xe.kj=Xe.jra.aE().result;if(Xe.kj){var Ca=[Xe.NAc.b3c,Xe.NAc.xe.b3c],zb=Va.a.instance,pc=Ra.a.instance.resolve("Box4.Presence.WordPresenceDataManager"),
Dc=new me(pc,zb,Xe.Gv,Xe.kj),dc=m.AFrameworkApplication.K.$("DoNotAddToEditorsTableOnFrameIsEnabled")?Ma.App.zd.mC:null;dc=new qd(Xe.kj,dc);var he=Ra.a.instance.Ve("WordEditor.IParagraphWordIdMapping"),Rc=Ra.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),qe=Ra.a.instance.resolve("Common.IPeopleInfoProvider");Xe._instance=new Xe(Xe.kj,Ca,Xe.wH,zb,qe,pc,Dc,dc,Xe.NAc,Xe.NAc.xe.$b,Ra.a.instance.resolve("Box4.Presence.PresenceControlProvider"),m.AFrameworkApplication.va,
Xe.aO,Qb.ParagraphReader.textLength,Qb.ParagraphReader.boa,Ra.a.instance.resolve("Box4.Presence.MyPresenceUser"),he,Rc,Ma.App.si.Il,new Yj.a,cc.a.instance,Im.a.get_instance(),Ga.a.Gp(Ra.a.instance.Ta("Common.App.CoauthTelemetry.IPresenceBootTelemetry")),m.AFrameworkApplication.K,m.AFrameworkApplication.K.$("Box4ThrottleAndBatchPresenceRendering"),m.AFrameworkApplication.K.$("Box4DoNotRenderPresenceOutOfView"),Ra.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),Ra.a.instance.resolve("Common.IPresenceStatusProvider"),
!Ma.App.Fs&&!Ma.App.Dm,Ma.App.Uoa(),Ra.a.instance.Ta("Common.ISessionExpirationManager"));k.ULS.sendTraceTag(23196878,302,50,"WordPresenceManager instance created");Xe.mud.Dg(Xe._instance);Xe.bxc.Dg(Xe._instance);Xe.Hbh.Dg(Xe._instance);Ca=Ra.a.instance;Ca.ia("WordEditor.Presence.WordPresenceManager",()=>Xe._instance).as("Common.IPresenceRemover").as("Common.IPresenceSender").ha();Ca.resolve("WordEditor.Presence.WordPresenceManager")}else k.ULS.sendTraceTag(4203468,302,15,"Can't initialize the WordPresenceManager because can't get a handle to RtcProxy")}static V1c(Ca){Xe._instance||
(k.ULS.sendTraceTag(4006601,302,50,"WordPresenceManager.OnAppIsInteractive: Trying to initialize again"),(Ca=Object(y.a)(16,Ca))&&Ca.gpb(Xe.V1c),Xe.init())}static xXi(){Xe._instance.ccg()}static xuk(Ca,zb,pc,Dc,dc){pc=dc.split(",");if(!pc||3!==pc.length)return 8;Ca=pc[0].trim();zb=pc[1].trim();pc=Number.parseInvariant(pc[2].trim());Ca=new lj(new Xa(Ca),new Hh(zb,pc,-1));if(!Xe.bxc.task.isCompleted)return 8;zb=Xe.aE().result;zb.k_e(Ca);zb.Ude();return 32}static n8f(Ca,zb,pc,Dc,dc){if(!Xe.bxc.task.isCompleted)return 8;
Ca=Xe.aE().result;Ca.T6c(dc);Ca.Ude();return 32}static Pxo(Ca,zb,pc,Dc,dc){if(!Xe.bxc.task.isCompleted)return 8;Ca=Xe.aE().result;if(!Ca)return 8;Ca.mje(dc);return 32}static Y4f(Ca,zb,pc,Dc,dc){if(1===pc)return 32;if(!Xe.jra.aE().isCompleted)return 8;Ca=Xe.jra.aE().result;if(!Ca)return k.ULS.sendTraceTag(4301136,302,10,"rtcProxy is null when trying to display RTC connection status"),8;dc[zd.a.Value]=2===Ca.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnected:1===Ca.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnecting:
"";return 32}}Xe._instance=null;Xe.bWg=!0;Xe.mud=new x.a;Xe.bxc=new x.a;Xe.Hbh=new x.a;Xe.wH=null;Xe.NAc=null;Xe.aO=null;Xe.kj=null;Object(l.a)(Xe,"WordPresenceManager",Rl,[]);class ho{constructor(Ca){this.sa=new Fa.a;this.PZ=Ca;this.PZ.CWR(()=>this.PZ.result.bxk(()=>{this.sa.raiseEvent("X")}))}hzk(Ca){this.sa.addHandler("X",Ca)}n2n(Ca){this.sa.removeHandler("X",Ca)}getStatus(){return this.PZ.isCompleted&&this.PZ.result?this.PZ.result.bKd.toString():"0"}}Object(l.a)(ho,"WordPresenceStatusProvider",
null,[147]);class ki{constructor(Ca,zb,pc,Dc){this.kj=null;this.UVg=this.gKe=!1;this.Ltn=()=>{this.m_.isCompleted&&this.m_.result?(this.kj=this.m_.result,this.kj.D_a(this.r5),k.ULS.sendTraceTag(5604372,302,50,"Presence Update Monitor is ready.")):k.ULS.sendTraceTag(5604373,302,15,"RtcTask did not complete successfully. No monitoring")};this.r5=(dc,he)=>{dc=he.Zra;for(const Rc in dc)if(he=dc[Rc],!this.gKe&&he.user.zP&&he.user.zP!==this.o3.zP){k.ULS.sendTraceTag(5604375,302,15,"Presence received from different local cobalt session Mine:{0} Theirs:{1}",
this.o3.zP,he.user.zP);this.gKe=!0;break}this.gKe&&this.kj.dPb(this.r5);this.UVg||(k.ULS.sendTraceTag(5604374,302,50,"First presence received"),this.UVg=!0)};this.Wk=Ca;this.o3=zb;this.m_=pc;pc.continueWith(this.Ltn);this.Ebk=Dc;this.Ebk.JMf=this.o3}}Object(l.a)(ki,"WordPresenceUpdateMonitor",null,[]);var qm=c(415),Fj=c(1562),rm=c(225),Tf=c(1897),Fl=c(1898),Hf=c(1787);class Ed{constructor(Ca,zb,pc,Dc,dc,he,Rc){this.sa=new Fa.a;this.C1g=this.v3g=this.lIe=this.e6g=!1;this.xXe=this.aAd=0;this.E1b=null;
this.DMa=he;this.DMa.clientId=Ca.clientId;this.Ll=Ca;this.paa=zb;this.Oaa=Dc;this.J3j=dc;this.Ib=pc;this.Bab=new rm.a;this.Jp=Rc;this.paa&&this.paa.continueWith(()=>{this.paa.Io||this.paa.Gi||this.paa.result.yqh(Object(e.a)(this,this.KTi,"onAmIAloneChanged"))})}get connectionState(){return this.Ll.connectionState}D_a(Ca){this.sa.addHandler("PU",Ca)}dPb(Ca){this.sa.removeHandler("PU",Ca)}Iua(Ca){this.sa.addHandler("CSC",Ca)}ujc(Ca){this.sa.removeHandler("CSC",Ca)}fGc(Ca){this.sa.addHandler("PSU",Ca)}$6c(Ca){this.sa.removeHandler("PSU",
Ca)}pCd(Ca){this.sa.addHandler("PSC",Ca)}Qde(Ca){this.sa.removeHandler("PSC",Ca)}Jjj(){}get clientId(){return this.Ll.clientId}T3(Ca){this.sa.addHandler("UN",Ca)}ePb(Ca){this.sa.removeHandler("UN",Ca)}bAm(){this.E1b=Array(12);for(let Ca=0;12>Ca;Ca++)this.E1b[Ca]=0;this.v3g=this.Jp?this.Jp.$("UpdateNotificationTaskExperimentIsEnabled"):!0;m.AFrameworkApplication.qI(()=>{this.r8m()})}init(){this.Ll.Iua(Object(e.a)(this,this.aja,"onConnectionStateChanged"));this.Ll.D_a(Object(e.a)(this,this.r5,"onPresenceUpdated"));
this.Ll.fGc(Object(e.a)(this,this.TSa,"onPersistentStateUpdated"));this.Ll.pCd(Object(e.a)(this,this.Ygc,"onPersistentStateCleared"));this.Ll.T3(Object(e.a)(this,this.m1,"onUpdateNotificationReceived"));this.rIh();this.bAm()}nde(Ca){this.Bab.contains(Ca,(zb,pc)=>zb===pc)||(this.Bab.add(Ca),2===this.connectionState&&Ca.start())}Rog(Ca){for(let zb=0;zb<this.Bab.length;zb++)if(this.Bab.J(zb)===Ca){this.Bab.zG(zb);break}}connect(){this.lIe||this.Ll.connect()}disconnect(){this.Ll.disconnect()}get efe(){return this.Ll}VRh(Ca){return lj.dDb(Ca)}Acg(Ca,
zb){return(new lj(Ca,zb)).Buf()}kcg(Ca){Ca&&Ca.isValid()&&!this.Oaa()?this.Ll.Jjj(this.Acg(this.DMa.G5l(),Ca)):H.Task.A4(null)}Hkc(Ca,zb){return this.Ll.Hkc(Ca,zb)}i9b(Ca){return this.Ll.i9b(Ca)}yPc(){return this.Ll.yPc()}qN(Ca,zb,pc=!1){return this.Ll.qN(Ca,zb,pc)}CFb(){return this.VLh(this.Ll.CFb())}Prb(Ca){const zb=new x.a;Hf.a.getInstance().l7i(Ca,zb);return zb.task}get oSa(){return this.Ll.oSa}aja(Ca,zb){2===zb.newState&&this.Bab.forEach(pc=>{pc.start();return!0});zb.newState||this.Jp.$("SendRTCMessagesWhileDisconnectedIsEnabled")&&
!this.lIe||this.Bab.forEach(pc=>{pc.stop();return!0});this.sa.raiseEvent("CSC",zb)}Dlf(Ca){return Ca.toLowerCase()}r5(Ca,zb){if(!this.Oaa()){Ca=this.VLh(zb.Zra);zb=this.XLh(zb.vLd);var pc=new hf.a(Ca,zb);zb=new qa.a(0,1,0,()=>{this.sa.raiseEvent("PU",pc)},57);this.Ib.Wb(zb)}}VLh(Ca){const zb={};for(const Dc in Ca){var pc=Dc;const dc=this.VRh(Ca[Dc]);dc&&dc.isValid()?zb[this.Dlf(pc)]=dc:k.ULS.sendTraceTag(562661590,302,50,"No Valid User {0}",pc)}return zb}XLh(Ca){const zb=Array(Ca.length);for(let pc=
0;pc<Ca.length;pc++)zb[pc]=this.Dlf(Ca[pc]);return zb}TSa(Ca,zb){if(!this.Oaa()){var pc={};Ca=zb.Zra;for(var Dc in Ca)pc[this.Dlf(Dc)]=Ca[Dc];Dc=new qa.a(0,1,0,()=>{this.sa.raiseEvent("PSU",new Tf.a(zb.type,pc))},80);this.Ib.Wb(Dc)}}Ygc(Ca,zb){if(!this.Oaa()){Ca=this.XLh(zb.DGd);var pc=new Fl.a(Ca);Ca=new qa.a(0,1,0,()=>{this.sa.raiseEvent("PSC",pc)},81);this.Ib.Wb(Ca)}}m1(Ca,zb){this.v3g?this.vZi(zb):(Ca=new qa.a(0,1,0,()=>{this.vZi(zb)},58),this.Ib.Wb(Ca))}vZi(Ca){var zb=Date.now();this.sa.raiseEvent("UN",
Ca);zb=Date.now()-zb;500<=zb&&(this.aAd++,k.ULS.sendTraceTag(42563487,302,15,"Update Notification Heuristics: UpdateNotification Type {0} took {1} ms",Ca.type,zb),this.pFl(Ca));this.xXe++}pFl(Ca){0>Ca.type||21<=Ca.type?k.ULS.sendTraceTag(42541602,302,15,"Update Notification Heuristics: UpdateNotification Type out of range {0}",Ca.type):this.E1b[Ca.type]++}r8m(){if(!this.C1g){var Ca={};Ca.TC=this.xXe;Ca.HRC=this.aAd;this.E1b&&0<this.aAd&&(Ca.TBC=this.E1b);this.aAd=this.xXe=0;this.E1b=null;k.ULS.sendTraceTag(42541603,
302,50,"UpdateNotificationHeuristics: {0}",Ca);this.C1g=!0}}dispose(){this.Bab=new rm.a;this.Ll.ujc(Object(e.a)(this,this.aja,"onConnectionStateChanged"));this.Ll.dPb(Object(e.a)(this,this.r5,"onPresenceUpdated"));this.Ll.$6c(Object(e.a)(this,this.TSa,"onPersistentStateUpdated"));this.Ll.Qde(Object(e.a)(this,this.Ygc,"onPersistentStateCleared"));this.Ll.ePb(Object(e.a)(this,this.m1,"onUpdateNotificationReceived"));this.paa&&this.paa.continueWith(()=>{this.paa.Io||this.paa.Gi||this.paa.result.j1n(Object(e.a)(this,
this.KTi,"onAmIAloneChanged"))});this.Ll.disconnect();k.ULS.sendTraceTag(4564935,302,50,"Disposing of rtcProxyCompleted")}KTi(){this.rIh()}rIh(){let Ca=!1;this.paa?this.paa.continueWith(()=>{this.paa.Io||this.paa.Gi||(Ca=!this.paa.result.amIAlone);this.Ll.connectionState||!Ca&&!this.J3j()?2!==this.Ll.connectionState||Ca||(this.disconnect(),k.ULS.sendTraceTag(4564937,302,50,"Disconnecting because there are no other users in the doc")):(this.connect(),k.ULS.sendTraceTag(4564936,302,15,"Connecting because there are other authors in the doc"));
!this.e6g&&Ca&&(k.ULS.sendTraceTag(4203466,302,50,"There are other real-time authors in this session"),this.e6g=!0)}):(this.connect(),k.ULS.sendTraceTag(589321547,302,50,"Connecting to rtc because Rtc Always On is enabled"))}bMc(){this.lIe=!0;this.disconnect();k.ULS.sendTraceTag(4564938,302,50,"DisconnectForever")}}Object(l.a)(Ed,"RtcProxy",null,[1196,9,865,1197]);class Zl extends Ed{constructor(Ca,zb,pc,Dc,dc,he,Rc,qe,bf,Cf,bh,Lg,Th){super(Ca,zb,pc,Dc,dc,he,Th);this.bga=null;this.XI=Rc;this.ud=qe;
this.JMa=bf;this.GAc=Cf;this.jUe=bh;this.CAb=Lg}get cK(){return this.bga||(this.bga=this.jUe())}aja(Ca,zb){2===zb.newState&&k.ULS.sendTraceTag(4315102,302,50,"RTC Connected");this.zZo();super.aja(Ca,zb)}zZo(){this.cK&&this.cK.nV("RtcConnectionStatusLabel")}VRh(Ca){return se.jbf(pd(Ca),this.XI,this.ud,this.JMa,this.CAb)}Acg(Ca,zb){return Object(rl.a)($e,zb)?(Ca=new se(this.GAc.cdi(),Ca,zb),Tc(Ca.Buf())):super.Acg(Ca,zb)}}Object(l.a)(Zl,"WordRtcProxy",Ed,[]);class ed{constructor(Ca,zb,pc,Dc,dc,he,Rc,
qe,bf,Cf,bh,Lg,Th){this.jq=new x.a;this.Qgh=!0;this.je=zb;this.Ib=pc;this.Oaa=Dc;this.DMa=dc;this.XI=he;this.wua=Rc;this.JMa=qe;this.GAc=bf;this.jUe=Cf;this.w3=bh;this.CAb=Lg;this.Ca=Th}aE(){this.WOo();return this.jq.task}XQc(){return qm.a.then(this.aE(),Ca=>Ca)}WOo(){if(this.Qgh)if(this.Qgh=!1,Ma.App.ZHf()&&Ma.App.XFf()){var Ca=m.AFrameworkApplication.He;if(Ca){Ca=Fj.RealtimeChannel.createInstance("{"+m.AFrameworkApplication.userSessionId+"}",m.AFrameworkApplication.userSessionId,m.AFrameworkApplication.Dgj,
Ca,this.w3,1,this.je,this.Ca.kb("RtcEndpointUrl"),void 0,void 0,null,this.Ca.$("FindSessionOnBootIsEnabled")?Ra.a.instance.resolve("Common.IFindSessionUtils"):null,this.Ca.kb("RtcBootToken"));var zb=this.Ca.$("RtcAlwaysOnEnabled"),pc=new Zl(Ca,zb?null:Ma.App.Uoa(),this.Ib,this.Oaa,ed.JIl,this.DMa,this.XI,this.wua,this.JMa,this.GAc,this.jUe,this.CAb,m.AFrameworkApplication.K);Ma.App.Jmo(pc);this.gXn(pc);pc.init();ci.App.C7a=pc;this.w3.execute(Dc=>{Dc.Ueb(()=>{pc.bMc()})});this.jq.Dg(pc)}else k.ULS.sendTraceTag(8206365,
302,15,"Can't initialize the RtcProxy because ClientRequestManager is null")}else k.ULS.sendTraceTag(8206362,302,10,"Can't initialize the RtcProxy because dependent scripts are not loaded")}gXn(Ca){const zb=Ra.a.instance;zb.ia("WordEditor.Presence.WordRtcProxy",()=>Ca).as("Box4.Presence.IRtcProxy").as("Common.IRealtimeChannelBasic").ha();zb.resolve("Common.IRealtimeChannelBasic")}static JIl(){return!1}}Object(l.a)(ed,"WordRtcProxyProvider",null,[144,145]);class Bf{constructor(){this.W=null;this.lm=
!1}get name(){return"WordEditor.Presence"}init(){k.ULS.sendTraceTag(50995799,302,50,"PresencePackage Init");Ma.App.GLj&&(this.W.resolve("WordEditor.Presence.WordRtcProxyProvider").aE(),Xe.init(),this.W.resolve("WordEditor.Presence.WordPresenceUpdateMonitor"));Ma.App.RJc&&Ph.init();this.W.resolve("Common.App.Presence.AwayManager");this.W.resolve("Common.IPeopleInfoProvider");if(Bf.p1g){const Ca=this.W.resolve("WordEditor.IMainViewModeManager");Ca.XAb(this.nZf);Bf.TGe=1===Ca.nu}}dispose(){if(!this.lm){this.lm=
!0;Xe.aE().continueWith(()=>{Jd.a.jC(Xe.aE().result)});var Ca=this.W.resolve("Box4.Presence.MyPresenceUser");Ca&&Ca.wic&&Ca.wic.n2n(Xe.xXi)}}wc(Ca){this.W=Ca;this.W.ia("Box4.Presence.MyPresenceUser",()=>new kb).as("Box4.Presence.IMyPresenceUser").as("Common.IPresenceUser").as("Common.IPresenceConverter").ha();Ca.ia("WordEditor.Presence.IWordPresenceCpFactory",()=>new Hk(Ca.resolve("Box4.CpConversionManagerImpl"),Ca.resolve("Box4.IContentControlReader"))).ha();Ca.ia("WordEditor.Presence.WordPresenceUpdateMonitor",
()=>new ki(new W.a(()=>Ma.App.zd),vg.a.instance,Ca.resolve("WordEditor.Presence.WordRtcProxyProvider").XQc(),Ca.resolve("Box4.Presence.IMyPresenceUser"))).ha();Ca.ia("WordEditor.Presence.WordRtcProxyProvider",()=>new ed(m.AFrameworkApplication.buildVersion,Ma.App.za.Lq,cc.a.instance,()=>m.AFrameworkApplication.Rk,Ra.a.instance.resolve("Box4.Presence.IMyPresenceUser"),Ra.a.instance.Oa("WordEditor.ParagraphWordIdMapping"),Ra.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),
()=>m.AFrameworkApplication.ua&&Ma.App.za.jb&&Ma.App.za.jb.Zc?Ma.App.za.jb.Zc.xd:null,Li.instance,()=>Ra.a.instance.Oa("WordEditor.IStatusBarUser"),Ra.a.instance.Ta("Common.ISessionExpirationManager"),Ra.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),m.AFrameworkApplication.K)).ha().as("Box4.Presence.IRtcProxyProvider").as("Common.Interface.IRtcBasicProvider");Ca.ia("Box4.Presence.PresenceControlProvider",()=>new tl(Bf.Kfl(),Qd.a.instance,Ra.a.instance.Ta("Common.IZoomManager"),
Ra.a.instance.resolve("Box4.ICoauthCashTelemetry"),Ga.a.Gp(Ra.a.instance.Ta("Common.ISystemInitiatedFeedbackWithTimeLapse")),m.AFrameworkApplication.K,Ca.resolve("Common.IPeopleInfoProvider"))).ha();Ca.ia("Common.App.Presence.AwayManager",()=>new yd(Ra.a.instance.resolve("Common.IPresenceUser"),Ra.a.instance.resolve("WordEditor.Presence.WordRtcProxyProvider").XQc(),Xe.Q$l(),Ra.a.instance.resolve("Common.IPresenceConverter"),cc.a.instance,m.AFrameworkApplication.K.$("AwayStatusOneMinuteTimeoutIsEnabled")?
6E4:m.AFrameworkApplication.K.mc("AwayCoauthorThresholdMs",9E5),Object(e.a)(m.AFrameworkApplication.va,m.AFrameworkApplication.va.processAction,"processAction"),Ma.App.za.notificationBar,m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"))).ha();Ca.ia("WordEditor.Presence.WordPresenceStatusProvider",()=>new ho(Ga.a.Gp(Ra.a.instance.Ta("Common.ICurrentPageCalculator")))).as("Common.IPresenceStatusProvider").ha();Ca.ia("Common.App.Presence.PeopleInfoProvider",()=>new Qg(Ca.resolve("WordEditor.Presence.WordRtcProxyProvider").XQc(),
Ma.App.Uoa().CWR(()=>Ma.App.Uoa().result.mC),Ca.resolve("Common.App.People.IPeopleColorUtils"),Ca.resolve("Common.IPresenceConverter"),Ga.a.Gp(Ca.Ta("Common.App.Presence.AwayManager")))).as("Common.IPeopleInfoProvider").ha();Ca.ia("Box4.Presence.WordPresenceDataManager",()=>new zk(Ma.App.za.jb.Zc.xd)).as("Box4.IPresenceDataManager").ha()}nZf(Ca,zb){Ma.App.za&&Ma.App.za.tE&&(Bf.gtd=null,Bf.TGe=1===zb.hnb)}static get w_i(){if(!Bf.gtd&&Ma.App.za&&Ma.App.za.tE){const Ca=ci.App.nn.tE;Bf.gtd=Bf.TGe&&Bf.p1g?
Ca.getElementsByClassName("PaginatedContentContainerDisplayWrapper")[0]:Ca.getElementsByClassName("OutlineContainerDisplayWrapper")[0]}return Bf.gtd}static Kfl(){const Ca=m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"),zb=m.AFrameworkApplication.K.$("PresenceIgnoreEventOnExpandedTooltip"),pc=m.AFrameworkApplication.K.$("PresenceIpWidthAdjustForFlyout"),Dc=new zg;Dc.add(Ng.multipleBrowsersImageClassName,ld.getImageClassWithCluster(m.AFrameworkApplication.Oca,"MoreUsersGlyph16"));
Dc.add(Ng.multipleBrowserImageClusterPath,m.AFrameworkApplication.Ns);Dc.add(Ng.peopleImageClassName,ld.getImageClassWithCluster(m.AFrameworkApplication.Oca,Ca?"DoughboyWhiteGlyph_20x20x32":"SingleCollabUserGlyph16"));Dc.add(Ng.peopleImageClusterPath,m.AFrameworkApplication.Ns);Dc.add(Ng.zIndex,1);Dc.add(Ng.rtl,m.AFrameworkApplication.isRtl);Dc.add(Ng.viewportBoundsCallback,Bf.Kkm);Dc.add(Ng.ignoreEventOnExpandedTooltip,zb);Dc.add(Ng.ipWidthAdjustForFlyout,pc);return Ca?new Se(Dc):new Zh(Dc)}static Kkm(){return Bf.w_i?
sf.a.getElementBounds(Bf.w_i):null}}Bf.TGe=!0;Bf.p1g=m.AFrameworkApplication.K.$("FlippedFlyoutForPaginationViewIsEnabled");Bf.gtd=null;Object(l.a)(Bf,"WordPresencePackage",null,[1,2]);var Og=c(1064),Rm=c(1422),Xh=c(1069),rf=c(192);class Ak{constructor(Ca,zb){this.l_e=Ca;this.paragraphId=zb}get opType(){return 2}get operation(){return this.l_e}}Object(l.a)(Ak,"RttAppliedAddParagraphOp",null,[229]);class ye{constructor(Ca,zb){this.s4n=Ca;this.paragraphId=zb}get opType(){return 6}get operation(){return this.s4n}}
Object(l.a)(ye,"RttAppliedReplaceSymbolRangeOp",null,[229]);class rk{constructor(Ca,zb){this.w4n=Ca;this.paragraphId=zb}get opType(){return 1}get operation(){return this.w4n}}Object(l.a)(rk,"RttAppliedReplaceTextRangeOp",null,[229]);class Hn{constructor(Ca,zb,pc){this.ivj=Ca;this.Sje=zb;this.XKc=pc}get opType(){return 4}get operation(){return this.ivj}get Hpk(){return this.ivj.V5b()?this.XKc:this.Sje}}Object(l.a)(Hn,"RttAppliedSplitParagraphOp",null,[229]);class fj{constructor(){this.u$a=new Yb.a}GJf(Ca){return Ca.toString()}JFc(Ca,
zb){Ca=this.GJf(Ca);this.u$a.nb(Ca)||this.u$a.Z(Ca,new R.a);this.u$a.J(Ca).add(zb)}RXf(Ca){switch(Ca.opType){case 1:var zb=Object(y.a)(rk,Ca);this.JFc(zb.paragraphId,Ca);break;case 6:zb=Object(y.a)(ye,Ca);this.JFc(zb.paragraphId,Ca);break;case 4:zb=Object(y.a)(Hn,Ca);this.JFc(zb.Sje,Ca);this.JFc(zb.XKc,Ca);break;case 2:zb=Object(y.a)(Ak,Ca),this.JFc(zb.paragraphId,Ca)}}fpn(Ca){return this.Enb(Ca)}Enb(Ca){Ca=this.GJf(Ca);if(!this.u$a.nb(Ca))return new R.a;const zb=this.u$a.J(Ca);this.u$a.remove(Ca);
for(const pc of zb)pc.operation&&(pc.operation.b8=null);return zb}C7l(Ca){let zb;return({value:zb}=this.u$a.Fc(this.GJf(Ca),zb)).returnValue?zb:new R.a}JMl(Ca){for(const zb of this.u$a.values){if(!zb.count)continue;if(2!==zb.J(0).opType)continue;const pc=zb.J(0);if(pc.l_e.xTf===Ca)return pc}return null}}Object(l.a)(fj,"RttAppliedOpTracker",null,[217]);var Qh=c(250),gh;(function(Ca){Ca[Ca.Vzl=0]="expired";Ca[Ca.Ohp=1]="dried"})(gh||(gh={}));Object(l.b)("RemoveChangeReason",gh);class sk{constructor(){this.zAa=
new Qh.a}xrk(Ca){if(!Ca)return k.ULS.sendTraceTag(7685333,355,15,"Cannot add a null change to RTTStore"),!1;const zb=Ca.Wc,pc=Ca.tj;this.zAa.nb(zb)||this.zAa.add(zb,new Qh.a);this.zAa.J(zb).Z(pc,Ca);return this.Phl(zb,pc)?(k.ULS.sendTraceTag(7619921,355,15,"Detected an infinite loop in paragraph {0}, dropping the last packet!",zb),this.zAa.J(zb).remove(pc),!1):!0}Lsf(Ca,zb){if(!this.zAa.nb(Ca))return null;Ca=this.zAa.J(Ca);return Ca.nb(zb)?Ca.J(zb):null}mTd(Ca){const zb=new R.a;for(const pc of this.zAa.keys){const Dc=
this.zAa.J(pc);for(const dc of Dc.keys){const he=Dc.J(dc);Ca(he)&&zb.add(he)}}return zb}Naj(Ca,zb){let pc=null;({value:pc}=this.zAa.Fc(Ca.Wc,pc)).returnValue?(Ca.activity.QVf(gh[zb]),pc.remove(Ca.tj),pc.count||this.zAa.remove(Ca.Wc)):k.ULS.sendTraceTag(50938848,355,15,"Cannot remove an op that not exist in _changes. WordId: {0}; Reason: {1}",Ca.Wc,zb)}U7f(Ca){this.Naj(Ca,1)}X7f(Ca){this.Naj(Ca,0)}Phl(Ca,zb){if(!this.zAa.nb(Ca))return!1;Ca=this.zAa.J(Ca);if(!Ca.nb(zb))return!1;for(var pc=Ca.J(zb);pc;){pc=
pc.V1;if(pc===zb)return!0;if(!Ca.nb(pc))break;pc=Ca.J(pc)}return!1}}Object(l.a)(sk,"RttDataStore",null,[215,216]);var Xi=c(289),Zk=c(90),ne=c(275),$k=c(310),wf=c(16);class wj{constructor(Ca,zb){this.x7d=(pc,Dc)=>{4===this.Lp.opType?k.ULS.shipAssertTag(9204866,355,12===Dc.node.type||11===Dc.node.type,"Unexpected graph modification detected during RTT edit"):k.ULS.shipAssertTag(9204867,355,!1,"Unexpected graph modification detected during RTT edit")};this.Enb=()=>{k.ULS.shipAssertTag(9204868,355,!1,
"Unexpected graph modification detected during RTT edit")};this.IVi=()=>{k.ULS.shipAssertTag(9204869,355,!1,"Unexpected graph modification detected during RTT edit")};this.Lp=Ca;if(this.xq=zb)Ca=this.xq.Ue(12),Ca.ju(this.x7d),Ca.Vw(this.Enb),Ca.Eo(this.IVi)}dispose(){if(this.xq){const Ca=this.xq.Ue(12);Ca.uV(this.x7d);Ca.Lja(this.Enb);Ca.jS(this.IVi)}}}Object(l.a)(wj,"GraphChangeValidator",null,[9]);class Pe{constructor(Ca,zb,pc,Dc){this.id=Ca;this.cpBegin=zb;this.cpEnd=pc;this.gVk=Dc}i2o(Ca){var zb=
this.id===Ca.id;zb&&(zb=this.gVk.replace("\u00a0"," "),Ca=Ca.characterData.substr(this.cpBegin,this.cpEnd-this.cpBegin).replace("\u00a0"," "),zb=zb===Ca);return zb}}Object(l.a)(Pe,"RttOpValidator",null,[237]);class Kg{constructor(Ca,zb){this.b8=this.mpc=this.activity=null;this.opType=Ca;this.metadata=zb}Bvf(){return""}serialize(){return null}}Object(l.a)(Kg,"RttOp",null,[143]);class em extends Kg{constructor(Ca,zb,pc,Dc,dc,he,Rc,qe,bf){super(bf,qe);this.Wc=Ca;this.tj=zb;this.bS=pc;this.l5=Dc;this.V1=
dc;this.lrb=he;this.QH=Rc}WNh(){return this.bS.isEqual(this.l5,!0)?new Dd.a(0,this.Wc,this.tj,this.bS,void 0,void 0,void 0,this.QH):new Dd.a(1,this.Wc,this.tj,this.bS,this.Wc,this.tj,this.l5,this.QH)}static mCj(Ca){let zb,pc;var Dc=Ca.PT;if(1===Dc.Pce&&(Dc.cTa!==Dc.PHa||Dc.M8a!==Dc.tnc))return k.ULS.sendTraceTag(8914769,355,15,"We received a ReplaceRange operation spanning multiple paragraphs"),pc=zb=null,Ca=Dc=-1,{returnValue:!1,bS:pc,l5:zb,Wc:Ca,tj:Dc};if(Dc.QH)return pc=zb=null,Ca=Dc=-1,{returnValue:!1,
bS:pc,l5:zb,Wc:Ca,tj:Dc};zb=pc=Dc.bS;1===Dc.Pce&&(zb=Dc.l5);Ca=Dc.cTa;Dc=Dc.M8a;return{returnValue:!0,bS:pc,l5:zb,Wc:Ca,tj:Dc}}}Object(l.a)(em,"RttReplaceRangeOp",Kg,[]);var jl=c(1420),io=c(461),Mf=c(1040),nk=c(592),mj=c(530);class Rf extends nk.a{constructor(){super();this.RttStatusRecords=this.FileId=null}nl(){return mj.a.rttStatusReplicator}static Vba(Ca,zb){const pc=new Rf;pc.FileId=Ca;pc.RttStatusRecords=zb;return pc}}Object(l.a)(Rf,"RttStatusRequest",nk.a,[]);class sg{}Object(l.a)(sg,"RttStatusOp",
null,[]);class db{constructor(){this.contentState=this.contentType=this.timeToRender=this.strictlySequentialId=this.packetVersion=this.clientType=this.clientId=this.packetId=null}}Object(l.a)(db,"WireRttStatusOpRecord",null,[]);class Lb extends io.a{constructor(){super();const {App:Ca}=c(163);this.O_b=new R.a;this.xRe=new R.a;this.zk=new jl.a(m.AFrameworkApplication.K.mc("WordEditorRttStatusReplicatorIntervalMs",6E4));this.enabled=1;Ca.W1.register(this)}SRj(){const Ca=Date.now();for(const zb of this.O_b)zb.YMb&&
1===zb.YMb&&(zb.YMb=2,zb.timeToRender=Ca-zb.metadata.ymg)}Aqe(Ca){const zb=new sg;zb.metadata=Ca.operation.metadata;zb.opType=Ca.opType;zb.YMb=1;this.O_b.add(zb)}get Via(){return"RttStatusReplicator"}Jca(){return this.he&&this.he.status===Mf.a.responseReady?!0:1===this.enabled&&this.zk.w0()?this.cE():!1}cE(){for(const Ca of this.O_b)if(Ca.YMb&&2===Ca.YMb)return!0;return!1}RTa(){if(1===this._state){this._state=3;const zb=this.O_b.toArray().filter(pc=>2===pc.YMb);var Ca=this.H$k(zb);Ca=Rf.Vba(m.AFrameworkApplication.rootQuerySignature,
Ca);zb.forEach(pc=>this.O_b.remove(pc));zb.forEach(pc=>this.xRe.add(pc));this.he.Jq=Ca;this.he.YG="RttStatusRequest";this.he.status=Mf.a.requestReady}else 3===this._state&&this.he&&this.he.status===Mf.a.responseReady&&(this.zk.i2(),2!==this.he.statusCode&&this.O_b.aD(0,this.xRe),this.xRe.clear(),this._state=1)}H$k(Ca){const zb=[];Ca.forEach(pc=>{const Dc=new db;Dc.clientId=pc.metadata.clientId;Dc.clientType=pc.metadata.clientType;Dc.packetId=pc.metadata.packetId;Dc.packetVersion=pc.metadata.packetVersion;
Dc.strictlySequentialId=pc.metadata.strictlySequentialId;Dc.contentType=pc.opType;Dc.contentState=pc.YMb;Dc.timeToRender=pc.timeToRender;zb.push(Dc)});return zb}Jlc(){return!0}kF(){}forceOutbound(){}}Object(l.a)(Lb,"RttStatusReplicator",io.a,[]);class kc{constructor(Ca,zb,pc,Dc,dc,he){this.packetId=Ca;this.clientId=zb;this.clientType=pc;this.ymg=Dc;this.packetVersion=dc;this.strictlySequentialId=he}static create(Ca){let zb=null;null!=Ca.strictlySequentialId&&(zb=Ca.strictlySequentialId);return new kc(Ca.packetId,
Ca.clientId,Ca.client,Date.now(),Ca.version,zb)}}Object(l.a)(kc,"RttOpMetadata",null,[]);class Kc extends Kg{constructor(Ca,zb,pc,Dc,dc,he,Rc,qe,bf){super(4,bf);this.V1=0;this.Wc=Ca;this.tj=zb;this.offset=pc;this.QH=Dc;this.Csg=dc;this.dmg=he;this.aqe=Rc;this.emg=qe;this.Csg===this.Wc?this.V1=this.dmg:this.aqe===this.Wc?this.V1=this.emg:(k.ULS.sendTraceTag(8397766,355,10,"Bad data passed to RttSplitParagraphOp"),this.V1=0)}V5b(){return this.Wc===this.aqe}get uJo(){return this.V1}get J5o(){return this.V5b()?
this.Csg:this.aqe}get azj(){return this.V5b()?this.dmg:this.emg}serialize(){const Ca=new Dd.a(3,this.Wc,this.tj,this.offset,null,null,null,this.QH),zb=new lc(this.Csg,this.dmg,this.aqe,this.emg);return new bc(this.metadata.packetId,this.metadata.clientId,1,4,Ca,null,void 0,void 0,void 0,void 0,zb,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ca){const zb=Ca.PT,pc=Ca.uRb;return new Kc(zb.cTa,zb.M8a,zb.bS,zb.QH,pc.z_f,pc.cmg,pc.A_f,pc.fmg,kc.create(Ca))}static Ocm(Ca,zb,pc){if(1!==
Ca.type)return null;const Dc=pc.eTa(Ca.m5.characterData,Ca.m5.qa);return new Kc(Ca.m5.Wc,Ca.m5.tj,pc.Gpc(Dc,Ca.Vuj),Ca.QH,Ca.FAb.Wc,Ca.FAb.tj,Ca.mHc.Wc,Ca.mHc.tj,zb)}}Object(l.a)(Kc,"RttSplitParagraphOp",Kg,[142,143]);class Qc{constructor(Ca,zb,pc,Dc){this.dln=()=>{this.Wyb.SRj()};this.gla=Ca;this.bAc=zb;this.Lla=pc;this.Nzb=Dc;null!=m.AFrameworkApplication.K&&m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.WordEditorRttStatusReplicatorIsEnabled",!1)&&(this.Wyb=new Lb,
Xi.GraphTransactionManager.instance.xqh(this.dln))}GFk(Ca,zb,pc,Dc=null){if(zb.isDirty)return Dc&&Dc.properties.Z(Qc.E0i,"1"),!1;const dc=new wj(Ca,zb.xj);try{if(1===Ca.opType||6===Ca.opType){const qe=Object(y.a)(em,Ca),bf=this.o6k(qe,zb);var he=bf.node.characterData;const Cf=10<=bf.cpBegin?bf.cpBegin-10:0;let bh=bf.cpEnd+10<=he.length?bf.cpEnd+10:he.length;const Lg=he.substr(Cf,bf.cpBegin-Cf),Th=he.substr(bf.cpEnd,bh-bf.cpEnd);bh=bh+qe.lrb.length-(bf.cpEnd-bf.cpBegin);var Rc=new Pe(bf.node.id,Cf,
bh,Lg+qe.lrb+Th);const ak=6===qe.opType;he="";ak&&(he=qe.font);if(!this.d4n(bf,qe.lrb,ak,he,Dc))return!1;let Ih;Ih=1===Ca.opType?new rk(qe,zb.id):new ye(qe,zb.id);zb.boa=Ca.V1;qe.mpc=Rc;Ca.b8=Ih;pc.RXf(Ih);null!=this.Wyb&&this.Wyb.Aqe(Ih)}else return 4===Ca.opType?this.FFk(Ca,zb,pc):!1}finally{dc&&dc.dispose()}return!0}FFk(Ca,zb,pc){const Dc=Object(y.a)(Kc,Ca);var dc=this.Nzb.eTa(zb.characterData,zb.qa);dc=this.Nzb.ZCb(dc,Dc.offset);if(!this.yCi(Vb.a.createTextRange(zb,0,Qb.ParagraphReader.textLength(zb))))return!1;
var he=eg.GraphIterator.eb(zb);he.zb(10);if(this.n0d(he))return!1;let Rc;he=this.Lla.Pc(3);try{he.Db(zb);const qe=zb.sZ();try{const bf=eg.GraphIterator.eb(zb);bf.zb(10);bf.jd(11);let Cf=bf.currentNode;Dc.V5b()&&(bf.bFf?Cf=null:(bf.FJ(),Cf=bf.currentNode));bf.uc();const bh=this.bAc.Jgb();bf.ZH(bh,Cf,89);bf.Aj(bh);Rc=zb.clone();const Lg=Rc.sZ();try{Rc.setValue(Cg.a.Wc,Dc.J5o);Rc.setValue(Cg.a.tj,Dc.azj);Rc.isDirty=!1;bf.Bf(Rc,2);bf.Aj(Rc);this.j8k(zb,Rc);const Th=Dc.V5b()?Rc:zb,ak=Dc.V5b()?zb:Rc;Th.BO=
!0;ak.BO=!0;this.gla.E9f(this.iEa(Th,dc,Qb.ParagraphReader.textLength(Th)),"",!1,"");this.gla.E9f(this.iEa(ak,0,dc),"",!1,"");zb.boa=Dc.uJo;Rc.boa=Dc.azj}finally{Lg&&Lg.dispose()}}finally{qe&&qe.dispose()}he.lUa()}finally{he&&he.dispose()}zb=new Hn(Dc,zb.id,Rc.id);Ca.b8=zb;pc.RXf(zb);null!=this.Wyb&&this.Wyb.Aqe(zb);return!0}n0d(Ca){const zb=new eg.GraphIterator;zb.kd(Ca);zb.jd(11);return Zk.ListItemReader.lg(zb)?(k.ULS.sendTraceTag(16868566,355,50,"Blocked RTT para operation: in a list"),!0):!1}uEl(Ca,
zb,pc){var Dc=zb.qjb(Ca.Wc);if(Dc.equals(Wc.a.nil))return null;Dc=pc.Eb(Dc);if(!Dc||!Qb.ParagraphReader.Xb(Dc)||!Dc.isConnected)return null;const dc=eg.GraphIterator.eb(Dc);if(!dc.zb(23))return null;if(Ca.Bsg){Ca=zb.qjb(Ca.Bsg);if(Ca.equals(Wc.a.nil))return null;pc=pc.Eb(Ca);if(!pc||!Qb.ParagraphReader.Xb(pc)||!pc.isConnected)return null;pc=eg.GraphIterator.eb(pc);if(!pc.zb(23))return null;pc.jd(11);pc.FJ();pc.Rd();if(pc.currentNode!==Dc)return null}return this.n0d(dc)?null:dc}POo(Ca,zb,pc,Dc){const dc=
zb.currentNode,he=this.Lla.Pc(3);try{he.Db(dc);zb.jd(11);const Rc=zb.currentNode;zb.uc();const qe=this.bAc.Jgb();zb.ZH(qe,Rc,89);zb.Aj(qe);const bf=ne.a.instance.createInstance(393230),Cf=bf.sZ();try{bf.setValue(wf.a.wo,""),bf.DGa=!0,Dc.ZOb(bf),Dc=[0],bf.setValue(Cg.a.vq,Dc),bf.setValue(Cg.a.nt,Dc),bf.DGa=!1,bf.setValue(Cg.a.Wc,Ca.xTf),bf.setValue(Cg.a.tj,Ca.wTf),bf.isDirty=!1,zb.Bf(bf,2),bf.BO=!0,bf.boa=Ca.wTf}finally{Cf&&Cf.dispose()}he.lUa();Ca.b8=new Ak(Ca,bf.id);pc.RXf(Ca.b8);null!=this.Wyb&&
this.Wyb.Aqe(Ca.b8)}finally{he&&he.dispose()}return!0}iEa(Ca,zb,pc){return zb===pc?Vb.a.Rc(Ca,zb):Vb.a.createTextRange(Ca,zb,pc)}d4n(Ca,zb,pc,Dc,dc=null){const he=Ca.node;if(Ca.cpBegin!==Ca.cpEnd&&!this.yCi(Ca))return dc&&dc.properties.Z(Qc.pEj,"1"),!1;dc=this.Lla.Pc(3);try{dc.Db(he);const Rc=he.sZ();try{he.BO=!0,this.gla.E9f(Ca,zb,pc,Dc)}finally{Rc&&Rc.dispose()}dc.lUa()}finally{dc&&dc.dispose()}return!0}j8k(Ca,zb){zb.DGa=!0;zb.qra(Ca.characterData);zb.boa=Ca.boa;zb.qa.clear();for(var pc=0;pc<Ca.qa.length;pc++){const Dc=
Ca.qa.J(pc).rna(zb);zb.qa.add(Dc)}zb.Wl();if(zb.ye.length)for(Ca=0;Ca<zb.qa.length;Ca++){if((pc=zb.qa.J(Ca).formatting)&&-1!==pc.qe)for(;zb.ye.length<=pc.qe;)zb.ye.uY(zb.ye.length-1,256)}else k.ULS.sendTraceTag(9204881,355,15,"Cannot update WordRunProperties after splitting paragraph");zb.DGa=!1}eJf(Ca){Ca=eg.GraphIterator.eb(Ca);Ca.zb(23);Ca.uc();return{returnValue:89===Ca.role,iterator:Ca}}F8f(Ca){const zb=new eg.GraphIterator;zb.kd(Ca);zb.uc();const pc=this.Lla.Pc(3);try{pc.Db(zb.currentNode),
Ca.zg()}finally{pc&&pc.dispose()}}yZn(Ca){if(Ca.anchor)if(({iterator:zb}=this.eJf(Ca)).returnValue)this.F8f(zb);else{var zb=Ca.Mc.Am;var pc=this.Lla.Pc(3);try{pc.Db(Ca),Ca.load(Object($k.a)(zb).Eb(Ca.id)),Ca.anchor.vY(4)}finally{pc&&pc.dispose()}}}cag(Ca,zb,pc){for(let he=zb.count-1;0<=he;he--){var Dc=zb.J(he);switch(Dc.opType){case 4:Dc=Object(y.a)(Hn,Dc);if(!Ca.id.equals(Dc.Sje)){k.ULS.shipAssertTag(9204885,355,Ca.id.equals(Dc.XKc));continue}Dc=pc.Eb(Dc.XKc);if(!Dc)break;if(!Dc||!Qb.ParagraphReader.Xb(Dc)){k.ULS.shipAssertTag(9204886,
355,!1);break}if(!Dc.isConnected)continue;var dc=({iterator:Dc}=this.eJf(Dc)).returnValue;k.ULS.shipAssertTag(9204887,355,dc);dc&&this.F8f(Dc);break;case 2:(Dc=Object(y.a)(Ak,Dc),Ca.id.equals(Dc.paragraphId))?Ca.isConnected&&(dc=({iterator:Dc}=this.eJf(Ca)).returnValue,k.ULS.shipAssertTag(16820002,355,dc),dc&&this.F8f(Dc)):k.ULS.shipAssertTag(16820001,355,!1)}}}o6k(Ca,zb){const pc=this.Nzb.eTa(zb.characterData,zb.qa),Dc=this.Nzb.ZCb(pc,Ca.bS);Ca=this.Nzb.ZCb(pc,Ca.l5);return Dc===Ca?Vb.a.Rc(zb,Dc):
Vb.a.createTextRange(zb,Dc,Ca)}yCi(Ca){const zb=Ca.node.qa,pc=Ca.cpBegin;Ca=Ca.cpEnd;for(let Dc=0;Dc<zb.length;Dc++){const dc=zb.J(Dc);if(dc.cp>=Ca)break;if(dc.cp>=pc){if(dc.Te)return k.ULS.sendTraceTag(8242647,355,15,"Rejected unsafe wet change: range contains comment"),!1;if(dc.blob)return k.ULS.sendTraceTag(8242648,355,15,"Rejected unsafe wet change: range contains blob"),!1;if(dc.Hc||dc.LRa||dc.Icc)return k.ULS.sendTraceTag(8242649,355,15,"Rejected unsafe wet change: range contains field"),!1}}return!0}}
Qc.E0i="ParagraphAlreadyDirty";Qc.pEj="UnsafeWetChange";Object(l.a)(Qc,"RttEditor",null,[214]);var md=c(20),Hd=c(1468),Ne=c(255);class Cc{constructor(){this.xgd=new R.a}add(Ca){this.xgd.add(Ca);return!0}mTd(Ca){const zb=new R.a;for(const pc of this.xgd)Ca(pc)&&zb.add(pc);return zb}U7f(Ca){Ca.activity.QVf("dried");this.xgd.remove(Ca)}X7f(Ca){Ca.activity.QVf("expired");this.xgd.remove(Ca)}}Object(l.a)(Cc,"RttAddParagraphDataStore",null,[]);class oe extends Kg{constructor(Ca,zb,pc,Dc,dc,he,Rc,qe){super(2,
qe);this.Wc=Ca;this.tj=zb;this.V1=pc;this.Bsg=Dc;this.xTf=dc;this.wTf=he;this.QH=Rc}serialize(){const Ca=new Dd.a(2,this.Wc,this.tj,null,this.Bsg,null,null,this.QH),zb=new ib(this.V1,this.xTf,this.wTf);return new bc(this.metadata.packetId,this.metadata.clientId,1,3,Ca,null,void 0,void 0,zb,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ca){const zb=Ca.PT,pc=Ca.z2b;let Dc=null;null!=Ca.PT.PHa&&(Dc=Ca.PT.PHa);return new oe(zb.cTa,zb.M8a,pc.gmg,Dc,pc.C_f,pc.V1,zb.QH,kc.create(Ca))}static Kcm(Ca,
zb){return 3!==Ca.type?null:new oe(Ca.sqa.Wc,Ca.sqa.tj,Ca.Ign.tj,Ca.JSa?Ca.JSa.Wc:null,Ca.nya.Wc,Ca.nya.tj,Ca.QH,zb)}}Object(l.a)(oe,"RttAddParagraphOp",Kg,[]);class gc{constructor(Ca){this.WV=Ca}A8i(){this.WV&&this.WV.properties.Z(gc.OZh,"1")}eRn(Ca){this.WV&&(this.WV.properties.nb(gc.PQf)||this.WV.properties.Z(gc.PQf,(Ca-this.WV.startTime).toString()))}QVf(Ca){this.WV&&(this.WV.properties.Z(gc.jcj,Ca),this.WV.end())}ESn(Ca){this.WV&&this.WV.properties.Z(gc.M_i,Ca.toString())}DSn(Ca){this.WV&&this.WV.properties.Z(gc.i_i,
Ca)}static nBf(Ca){Ca.K5(af.a.IPb,gc.OZh,Hd.a.jxj);Ca.K5(af.a.IPb,gc.kBl,Hd.a.jxj);Ca.K5(af.a.IPb,gc.PQf,Hd.a.sJk);Ca.K5(af.a.IPb,gc.jcj,Hd.a.zva);Ca.K5(af.a.IPb,gc.M_i,Hd.a.zva);Ca.K5(af.a.IPb,gc.i_i,Hd.a.zva)}static create(Ca){if(!Ca)return null;Ca=Ca.Fp(af.a.IPb,gc.z4o);return new gc(Ca)}}gc.OZh="FailedToFindInitialParaID";gc.kBl="FailedToFindInitialTextID";gc.PQf="MsecUntilApplied";gc.jcj="RemovedBecause";gc.M_i="PacketVersions";gc.i_i="OperationType";gc.z4o=48E4;Object(l.a)(gc,"RttOpActivity",
null,[]);var eh;(function(Ca){Ca[Ca.unknown=0]="unknown";Ca[Ca.rqp=1]="replaceTextRangeOp";Ca[Ca.Bep=2]="addParagraphOp";Ca[Ca.khp=3]="deleteParagraphOp";Ca[Ca.dtp=4]="splitParagraphOp";Ca[Ca.dnp=5]="mergeParagraphOp";Ca[Ca.qqp=6]="replaceSymbolRangeOp"})(eh||(eh={}));Object(l.b)("RttOpType",eh);var nj=c(124);class vi extends em{constructor(Ca,zb,pc,Dc,dc,he,Rc,qe,bf,Cf,bh){super(Dc,dc,he,Rc,qe,bf,Cf,bh,6);this.font=Ca;this.legacy=zb}Bvf(){return"OffsetStart: "+this.bS+"OffsetEnd: "+this.l5}serialize(){const Ca=
this.WNh();return new bc(this.metadata.packetId,this.metadata.clientId,1,7,Ca,null,this.V1,this.lrb,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ca){let zb,pc,Dc,dc;if(!({bS:zb,l5:pc,Wc:Dc,tj:dc}=em.mCj(Ca)).returnValue)return null;let he,Rc;if(1===Ca.text.length)he=!1,Rc=nj.AParagraphNode.RC;else if(2===Ca.text.length)if(yb.a.Uyi(Ca.text,0)&&yb.a.Kz(Ca.text,1))he=!0,Rc=Ca.text;else return k.ULS.sendTraceTag(8914772,355,15,"RTT symbol packet has text length 2 but is not a valid surrogate pair",
Ca.mt),null;else return k.ULS.sendTraceTag(8914773,355,15,"RTT symbol packet text is of unsupported length (length must be 1 or 2)",Ca.mt),null;const qe=Ca.rbd,bf=kc.create(Ca);return new vi(qe.Gkg,qe.Hkg,he,Dc,dc,zb,pc,Ca.bSb,Rc,Ca.PT.QH,bf)}}Object(l.a)(vi,"RttReplaceSymbolRangeOp",em,[142,143]);class ge extends em{constructor(Ca,zb,pc,Dc,dc,he,Rc,qe){super(Ca,zb,pc,Dc,dc,he,Rc,qe,1)}Bvf(){return"OffsetStart: "+this.bS+"OffsetEnd: "+this.l5+"TextAddedLength: "+this.lrb.length}serialize(){const Ca=
this.WNh();return new bc(this.metadata.packetId,this.metadata.clientId,1,2,Ca,null,this.V1,this.lrb,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ca){let zb,pc,Dc,dc;if(!({bS:zb,l5:pc,Wc:Dc,tj:dc}=em.mCj(Ca)).returnValue)return null;let he="";Ca.text&&(he=Ca.text);const Rc=kc.create(Ca);return new ge(Dc,dc,zb,pc,Ca.bSb,he,Ca.PT.QH,Rc)}static Kbm(Ca,zb,pc){if(Ca.type)return null;const Dc=pc.eTa(Ca.m5.characterData,Ca.m5.qa);return new ge(Ca.m5.Wc,Ca.m5.tj,pc.Gpc(Dc,
Ca.cpBegin),pc.Gpc(Dc,Ca.cpEnd),Ca.nya.tj,Ca.T9,Ca.QH,zb)}}Object(l.a)(ge,"RttReplaceTextRangeOp",em,[142,143]);class wg{constructor(Ca,zb,pc,Dc,dc,he,Rc,qe,bf,Cf,bh,Lg,Th,ak,Ih,xj,Uh,ul,ti){this.Ll=null;this.pHe=this.jmh=!1;this.Akd=!0;this.g9g=0;this.Ffh=this.tSe=this.Hfh=this.Efh=this.Gfh=!1;this.yYf=()=>{k.ULS.sendTraceTag(7685328,355,50,"All prerequisite ready for RttManager");this.Ll=this.m_.result;k.ULS.sendTraceTag(7685330,355,50,"Subscribing to presence updates");this.Ll.T3(this.m1)};this.m1=
(Vh,Ad)=>{if(3===Ad.type||10===Ad.type)if(10===Ad.type)this.g9g="boolean"===typeof Ad.NL?Ad.NL?1:0:Ad.NL;else if(this.hZb.value&&!this.hZb.value.nWd)k.ULS.sendTraceTag(8454939,355,15,"RTT channel did not get disconnected on lock release");else if(Ad.NL){if(this.RSn(),(Vh=this.Wll(Ad.NL))&&1!==Vh.metadata.clientType){this.QSn();if(!(!this.Zo||this.Zo.lda||md.a.hRa||md.a.kda||(m.AFrameworkApplication.oe("1i00j689;ba0dg262"),md.a.hRa||md.a.kda)))return;if(2!==this.g9g)switch(this.Akd&&(this.N_b.J8i(),
this.Akd=!1),this.jmh||this.dAm(),Vh.opType){case 1:case 6:case 4:if(!({Bg:Vh}=this.yrk(Vh)).returnValue)break;this.tjh?this.Thj(Vh):this.tDj(Vh);break;case 2:this.Oqc.add(Vh),this.Hri(Vh),this.tjh?this.Thj(Wc.a.nil):this.sDj(Vh)}}}else k.ULS.sendTraceTag(7685331,355,15,"RTT packet was empty")};this.Uzl=()=>{const Vh=this.ji.value;if(Vh){var Ad=this.yD()-wg.KZn,Id=this.cub.mTd(ke=>ke.metadata.ymg<Ad);0<Id.count&&this.fRn();var xe=new Ne.a;for(const ke of Id)if(this.cub.X7f(ke),ke.b8)switch(ke.b8.opType){case 1:xe.add(ke.b8.paragraphId.toString());
break;case 6:xe.add(ke.b8.paragraphId.toString());break;case 4:xe.add(ke.b8.Sje.toString()),xe.add(ke.b8.XKc.toString())}Id=this.Oqc.mTd(ke=>ke.metadata.ymg<Ad);for(const ke of Id)this.Oqc.X7f(ke),ke.b8&&xe.add(ke.b8.paragraphId.toString());for(const ke of xe)(xe=Vh.Eb(Wc.a.If(ke)))?xe.BO?(this.Vyb.yZn(xe),xe.BO||this.Pyc.value.ybj(xe)):k.ULS.sendTraceTag(8765829,355,15,"Expiring wet change from paragraph with no applied changes"):k.ULS.sendTraceTag(8765828,355,15,"Expiring wet change with invalid object ID")}else this.ji.pzf&&
k.ULS.sendTraceTag(7685332,355,10,"Failed to find the IObjectSpace! Wet changes will never expire")};this.Vyb=Ca;this.cub=zb;this.Pyc=pc;this.hZb=Dc;this.XI=dc;this.m_=he;this.ji=Rc;this.Ib=qe;this.yD=bf;this.Nzb=Cf;this.Ad=bh;this.YOe=Th;this.Lc=ak;this.tjh=Ih;this.N_b=xj;this.ctb=Uh;this.EYe=ul;this.TAc=new M.a(K.a.ih());this.Oqc=new Cc;Lg.execute(wg.nBf);this.Zo=ti}dAm(){const Ca=new qa.a(3,2,wg.P0n,this.Uzl);this.Ib.Wb(Ca);this.jmh=!0}init(){return this.m_?this.m_.continueWith(this.yYf):H.Task.A4(!1)}Wll(Ca){Ca=
pd(Ca);if(!Ca)return null;switch(Ca.mt){case 2:return ge.create(Ca);case 7:return vi.create(Ca);case 4:return Kc.create(Ca);case 3:return oe.create(Ca);default:return k.ULS.sendTraceTag(8459668,355,50,"RTT packet is of unexpected operationType {0}",Ca.mt),null}}yrk(Ca){let zb=Wc.a.nil;if(!this.cub.xrk(Ca))return{returnValue:!1,Bg:zb};this.Hri(Ca);if(!this.XI)return{returnValue:!1,Bg:zb};const pc=this.XI.qjb(Ca.Wc);if(pc.equals(Wc.a.nil)||!this.ji.value.Eb(pc))return Ca.activity.A8i(),{returnValue:!1,
Bg:zb};this.L8i();return{returnValue:!0,Bg:pc}}Thj(Ca){Ca.equals(Wc.a.nil)||this.TAc.add(Ca.toString());this.pHe||(Ca=new qa.a(0,1,200,()=>{this.GQo();this.pHe=!1},71),this.Ib.Wb(Ca),this.pHe=!0)}lbo(Ca){Ca=new qa.a(0,1,0,Ca,71);this.Ib.Wb(Ca)}Hri(Ca){Ca.activity=gc.create(this.Ad);Ca.activity.ESn(Ca.metadata.packetVersion);Ca.activity.DSn(eh[Ca.opType])}GQo(){var Ca=this.Oqc.mTd(pc=>!pc.b8);for(const pc of Ca)this.sDj(pc);if(this.TAc.count){Ca=null;for(var zb of this.TAc){zb=Wc.a.If(zb);Ca=this.ji.value.Eb(zb);
break}zb=this.Lc.Pc(3);try{zb.Db(Ca);for(const pc of this.TAc)this.tDj(Wc.a.If(pc))}finally{zb&&zb.dispose()}this.TAc.clear()}}tDj(Ca){Ca=this.ji.value.Eb(Ca);let zb;const pc=this.Lc.Pc(3);try{pc.Db(Ca);zb=this.Ad.Fp(af.a.Uuh);const Dc=this.Zuh(Ca,zb);zb.end();Dc&&this.wuk(Dc)}finally{pc&&pc.dispose(),this.N_b.m6f(1),this.Akd=!0}}sDj(Ca){var zb=this.Vyb.uEl(Ca,this.XI,this.ji.value);zb&&(this.L8i(),this.Vyb.POo(Ca,zb,this.ctb,Ra.a.instance.resolve("Box4.IParagraphEditor"))&&(zb=this.ji.value.Eb(Ca.b8.paragraphId),
this.qvh(zb,Ca),this.N_b.m6f(1),this.Akd=!0))}wuk(Ca){this.YOe.continueWith(()=>{if(1===Ca.opType){var zb=this.M$l(Ca);zb&&(this.YOe.result.k_e(zb),this.YOe.result.Ude(!0))}})}M$l(Ca){const zb=Ca.serialize();if(2!==zb.mt||zb.PT.PHa&&zb.PT.cTa!==zb.PT.PHa)return null;const pc=Ca.bS.clone();0<Ca.lrb.length&&(pc.rFh(),pc.cp+=Ca.lrb.length);zb.mt=0;zb.text=null;zb.PT.Pce=0;zb.PT.bS=pc;zb.PT.M8a=zb.bSb;zb.PT.PHa=null;zb.PT.tnc=null;zb.PT.l5=null;zb.bSb=null;return se.jbf(zb,this.XI,this.Nzb,()=>this.ji.value,
this.EYe.instance)}qvh(Ca,zb){return this.Pyc.value?this.Pyc.value.jqk(Ca,zb.metadata.clientId).returnValue?!0:(k.ULS.sendTraceTag(7866379,355,15,"Unable to apply a wet change lock"),!1):(k.ULS.shipAssertTag(7866378,355,!!this.Pyc.value,"Unable to apply wet changes as LockManager unavailable"),!1)}Yuh(Ca,zb){this.Zuh(Ca,zb)}Zuh(Ca,zb){if(!Ca)return null;if(!Ca.anchor)return zb&&zb.properties.Z(wg.URi,"1"),null;if(!Ca.hasProperty(Cg.a.Wc))return k.ULS.sendTraceTag(7619922,355,15,"Paragraph is missing the WordId property"),
null;if(!Ca.hasProperty(Cg.a.tj))return k.ULS.sendTraceTag(8197722,355,15,"Paragraph is missing the TextId property"),null;if(Ca.hasProperty(Cg.a.kTh)&&Ca.getValue(Cg.a.kTh))return k.ULS.sendTraceTag(16815506,355,50,"RTT edit disabled in paragraph"),null;const pc=Ca.getValue(Cg.a.Wc);var Dc=Ca.boa;zb&&(zb.properties.Z(wg.Fhn,Dc.toString()),zb.properties.Z(wg.Hhn,pc.toString()));Dc=this.cub.Lsf(pc,Dc);if(!Dc)return zb&&zb.properties.Z(wg.GRi,"1"),null;if(!this.qvh(Ca,Dc))return zb&&zb.properties.Z(wg.TKh,
"1"),null;let dc=0,he=null;for(;Dc;){if(!this.Vyb.GFk(Dc,Ca,this.ctb,zb)){zb&&zb.properties.Z(wg.TKj,"1");break}dc++;Dc.activity.eRn(this.yD());he=Dc;Dc=Ca.boa;Dc=this.cub.Lsf(pc,Dc)}0<dc&&this.g8i();zb&&zb.properties.add(wg.UKj,dc.toString());return he}Bde(Ca){if(Ca.hasProperty(Cg.a.Wc)&&Ca.hasProperty(Cg.a.tj)){var zb=Ca.getValue(Cg.a.Wc),pc=Ca.ja(Cg.a.tj,0),Dc=this.Ad.Fp(af.a.B$i),dc=this.ctb.fpn(Ca.id);0<dc.count&&(this.Vyb.cag(Ca,dc,this.ji.value),this.h_n(Ca,dc,pc));var he=this.ctb.JMl(zb);
if(he&&!Ca.id.equals(he.paragraphId)){const Rc=this.ji.value;this.lbo(()=>{const qe=this.ctb.Enb(he.paragraphId),bf=Rc.Eb(he.paragraphId);k.ULS.shipAssertTag(16820032,355,!!bf,"Could not find added graph node");bf&&(this.Vyb.cag(bf,qe,Rc),this.Oqc.U7f(he.l_e))})}this.cub.Lsf(zb,pc)||this.Pyc.value.ybj(Ca);this.Yuh(Ca,Dc);Dc.end()}}h_n(Ca,zb,pc){let Dc=!1;for(let he=zb.count-1;0<=he;he--){var dc=zb.J(he);switch(dc.opType){case 1:case 6:case 4:dc=Object(y.a)(142,dc.operation);break;default:continue}dc.V1===
pc&&(Dc=!0,dc.mpc&&!dc.mpc.i2o(Ca)&&k.ULS.sendTraceTag(8765831,355,15,"Validating wet change location failed. Type {0} OffsetInfo {1} NodeId {2} ValidatorNodeId {3} ValidatorNodeCpBegin {4} ValidatorNodeCpEnd {5}",dc.opType,dc.Bvf(),Ca.id,dc.mpc.id,dc.mpc.cpBegin,dc.mpc.cpEnd));Dc&&this.cub.U7f(dc)}Dc&&this.g8i()}t2c(Ca){const zb=this.ctb.Enb(Ca.id);0<zb.count&&(2===zb.J(0).opType&&zb.removeAt(0),this.Vyb.cag(Ca,zb,this.ji.value))}jie(Ca){var zb=this.ctb.C7l(Ca.id);for(const pc of zb)if(4===pc.opType&&
(zb=Object(y.a)(Hn,pc),Ca.id.equals(zb.Hpk)))return!0;return!1}RSn(){this.Gfh||(k.ULS.sendTraceTag(8704354,355,50,"Received a wet change"),this.Gfh=!0)}QSn(){this.Efh||(k.ULS.sendTraceTag(8185606,355,50,"Received a wet change that we could deserialize"),this.Efh=!0)}L8i(){this.Hfh||(k.ULS.sendTraceTag(17147533,355,50,"Received a usable wet change"),this.Hfh=!0)}g8i(){this.tSe||(k.ULS.sendTraceTag(8185607,355,50,"Successfully applied a wet change"),this.tSe=!0)}fRn(){this.tSe||this.Ffh||(k.ULS.sendTraceTag(8185608,
355,15,"Failed to apply any wet changes so far"),this.Ffh=!0)}static nBf(Ca){const zb=[af.a.Uuh,af.a.B$i];for(const pc of zb)Ca.K5(pc,wg.UKj,Hd.a.zva),Ca.K5(pc,wg.GRi,Hd.a.zva),Ca.K5(pc,wg.URi,Hd.a.zva),Ca.K5(pc,wg.TKh,Hd.a.zva),Ca.K5(pc,wg.TKj,Hd.a.zva),Ca.K5(pc,Qc.E0i,Hd.a.zva),Ca.K5(pc,Qc.pEj,Hd.a.zva);gc.nBf(Ca)}}wg.P0n=6E4;wg.KZn=18E4;wg.UKj="WetChangeCount";wg.GRi="NoChangesToApply";wg.URi="NodeNotConnected";wg.TKh="CouldNotGetLock";wg.TKj="WetChangeBlocked";wg.Hhn="NodeWordId";wg.Fhn="NodeTextId";
Object(l.a)(wg,"RttManager",null,[212]);class $f{constructor(Ca,zb){this.Fgj=0;this.pj=Ca;this.l$n=zb}J8i(){this.Fgj=this.pj()}m6f(Ca){const zb=this.pj()-this.Fgj;0<=zb&&this.l$n.track(Math.round(zb),0===Ca?"CTB":"RTP")}}Object(l.a)($f,"RttPerfCounter",null,[213]);var di=c(2001);class ah{constructor(){this.xCc=new di.a}avk(Ca,zb){this.xCc.back()&&zb&&this.xCc.back().egb(Ca)||this.xCc.enqueue(Ca)}f6l(){return this.xCc.isEmpty?null:this.xCc.dequeue()}}Object(l.a)(ah,"RttSendDataStore",null,[211]);class Zj extends Kg{constructor(Ca,
zb,pc,Dc){super(3,Dc);this.Wc=Ca;this.tj=zb;this.QH=pc}get V1(){return 0}serialize(){const Ca=new Dd.a(4,this.Wc,this.tj,null,null,null,null,this.QH);return new bc(this.metadata.packetId,this.metadata.clientId,1,5,Ca,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ca){const zb=Ca.PT;return new Zj(zb.cTa,zb.M8a,zb.QH,kc.create(Ca))}static Lcm(Ca,zb){return 4!==Ca.type?null:new Zj(Ca.M6b.Wc,Ca.M6b.tj,Ca.QH,zb)}}Object(l.a)(Zj,"RttDeleteParagraphOp",
Kg,[142,143]);class ng extends Kg{constructor(Ca,zb,pc,Dc,dc,he,Rc,qe){super(5,qe);this.Asg=Ca;this.$yj=zb;this.I5o=pc;this.vJo=Dc;this.QH=dc;this.JLj=he;this.unc=Rc}get Wc(){return this.Asg}get tj(){return this.$yj}get V1(){return this.Asg===this.JLj?this.unc:0}serialize(){const Ca=new Dd.a(5,this.Asg,this.$yj,null,this.I5o,this.vJo,null,this.QH),zb=new wb(this.JLj,this.unc);return new bc(this.metadata.packetId,this.metadata.clientId,1,6,Ca,null,void 0,void 0,void 0,zb,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ca){const zb=
Ca.PT,pc=Ca.G0c;return new ng(zb.cTa,zb.M8a,zb.PHa,zb.tnc,zb.QH,pc.B_f,pc.unc,kc.create(Ca))}static Mcm(Ca,zb){return 2!==Ca.type?null:new ng(Ca.sqa.Wc,Ca.sqa.tj,Ca.JSa.Wc,Ca.JSa.tj,Ca.QH,Ca.M4d.Wc,Ca.M4d.tj,zb)}}Object(l.a)(ng,"RttMergeParagraphOp",Kg,[142,143]);class Xo{constructor(Ca,zb,pc,Dc,dc,he){this.aDc=this.kj=null;this.Afa=!1;this.vWe=this.Rjh=0;this.gyd=this.flh=!1;this.vRe=0;this.yYf=()=>{k.ULS.sendTraceTag(8245954,355,50,"All prerequisites ready for RttSendManager");this.kj=this.m_.result;
this.kj.nde(this)};this.jXi=(Rc,qe)=>{if(this.kj&&2===this.kj.connectionState&&(Rc=qe.sF,Rc.length))if(qe.g8)100>this.vWe&&(this.vWe++,k.ULS.sendTraceTag(8270467,355,50,"Blocking send. Reason: {0} OverallSends: {1} OverallBlocked: {2}",qe.aLk,this.Rjh,this.vWe));else{for(qe=0;qe<Rc.length;qe++)if(!this.qXm(Rc[qe]))return;for(qe=0;qe<Rc.length;qe++){const bf=Rc[qe];this.Heh.avk(bf,!bf.type&&!qe)}this.aDc||this.MWi(this.aDc,this.kj)}};this.m_=Ca;this.Heh=zb;this.ncb=pc;this.gu=Dc;this.wua=dc;this.N_b=
he}get Tm(){return this.ncb.value}init(){return this.m_?this.m_.continueWith(this.yYf):H.Task.A4(!1)}start(){this.Afa||(this.gu.Zc?(this.gu.Zc.sF.bzk(this.jXi),this.Afa=!0):k.ULS.sendTraceTag(522740420,355,10,"No activePage, RttSendManager not started"))}stop(){this.Afa&&(this.Afa=!1,this.gu.Zc.sF.j2n(this.jXi))}qXm(Ca){return Ca&&-1!==Ca.QH?Ca.type&&3!==Ca.type&&1!==Ca.type?!1:!0:!1}C7m(){this.gyd||(this.flh||(k.ULS.sendTraceTag(8270468,355,50,"Preparing to send RTT change"),this.flh=!0),!this.gyd&&
5>=this.vRe&&this.vRe++)}R7m(){!this.gyd&&5>=this.vRe&&(k.ULS.sendTraceTag(8270469,355,50,"Sent Rtt Message"),this.gyd=!0)}MWi(Ca,zb){this.C7m();Ca&&(Ca.Gi||Ca.Io)&&k.ULS.sendTraceTag(8245956,355,15,"Task is faulted or cancelled with exception {0}",Ca.exception);this.N_b.J8i();(Ca=this.Ncm(this.Heh.f6l()))?(this.Rjh++,this.aDc=zb.qN(3,Tc(Ca.serialize())),this.R7m(),this.N_b.m6f(0),this.aDc.continueWith(pc=>{this.MWi(pc,zb)})):this.aDc=null}Ncm(Ca){if(!Ca)return null;if(!this.Tm)return k.ULS.sendTraceTag(8245957,
355,15,"GetParagraphAnchoredOpFromGraphTransactionOperation: CoAuth manager is null"),null;const zb=new kc(Li.instance.cdi(),this.Tm.qj,1,0,0,Xd.instance.w6l());let pc=null;switch(Ca.type){case 0:pc=ge.Kbm(Ca,zb,this.wua);break;case 4:pc=Zj.Lcm(Ca,zb);break;case 3:pc=oe.Kcm(Ca,zb);break;case 2:pc=ng.Mcm(Ca,zb);break;case 1:pc=Kc.Ocm(Ca,zb,this.wua)}return pc}}Object(l.a)(Xo,"RttSendManager",null,[122]);class Mh{constructor(){this.W=null;this.a4l=()=>Ma.App.zd&&Ma.App.zd.fq?Ma.App.zd.fq:(k.ULS.sendTraceTag(7866377,
304,15,"Unable to get the lock manager"),null)}get name(){return"WordEditor.RealTimeTyping"}wc(Ca){const zb=Ga.a.Gp(Ca.Ta("Box4.IOutlineElementEditor")),pc=Ga.a.Gp(Ca.Ta("Box4.IFeatureHelper")),Dc=Ga.a.Gp(Ca.Ta("Common.IActivityAggregationInfo")),dc=Ga.a.Gp(Ca.Ta("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator")),he=Ga.a.Gp(Ca.Ta("Box4.CompositionStateManager"));this.W=Ca;const Rc=new Yj.a;H.Task.WAA.call(null,zb,pc,Dc,dc,he).continueWith(()=>{Ca.ia("WordEditor.RealTimeTyping.IRttEditor",
()=>new Qc(Ca.resolve("Box4.ICharacterPropertiesEditor"),Ca.resolve("Box4.IOutlineElementEditor"),Rc,Ca.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"))).ha();Ca.register($f,"WordEditor.RttPerfCounter").as("WordEditor.IRttPerfCounter").ha().Ud(()=>new $f(sf.a.$e,Og.a.mF(17,1,new Rm.a(new Xh.a(.25)))));Ca.ia("WordEditor.RealTimeTyping.RttManager",()=>new wg(Ca.resolve("WordEditor.RealTimeTyping.IRttEditor"),new sk(rf.a.instance),new W.a(this.a4l),new W.a(()=>Ma.App.sS),Ca.resolve("WordEditor.ParagraphWordIdMapping"),
Ca.resolve("Box4.Presence.IRtcProxyProvider").aE(),new W.a(()=>Ma.App.za.jb&&Ma.App.za.jb.Zc?Ma.App.za.jb.Zc.xd:(k.ULS.sendTraceTag(522740419,304,10,"No activePage or workspace."),null)),cc.a.instance,()=>Date.now(),Ca.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),rf.a.instance,Ca.Ta("Common.IActivityAggregationInfo"),Xe.aE(),Rc,m.AFrameworkApplication.K.$("WordEditorThrottleAndBatchRTTRendering"),Ca.resolve("WordEditor.IRttPerfCounter"),new fj,Ca.Ta("WordEditor.Presence.IWordPresenceCpFactory"),
Ca.resolve("Box4.CompositionStateManager"))).as("WordEditor.RealTimeTyping.IRttManager").ha();Ca.ia("WordEditor.RealTimeTyping.RttSendManager",()=>new Xo(Ca.resolve("Box4.Presence.IRtcProxyProvider").aE(),new ah,new W.a(()=>Ma.App.zd),Ma.App.za.jb,Ca.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Ca.resolve("WordEditor.IRttPerfCounter"))).ha();this.oBf()})}oBf(){this.W.resolve("WordEditor.RealTimeTyping.RttManager").init();this.W.resolve("WordEditor.RealTimeTyping.RttSendManager").init()}init(){}dispose(){}static main(){Da.a.instance.Gc(new Mh)}}
Object(l.a)(Mh,"WordEditorRealTimeTypingPackage",null,[1,2]);Type.registerNamespace("BPr");Type.registerNamespace("Box4.Presence");Type.registerNamespace("RealtimePresenceUI");Type.registerNamespace("WERTT");Type.registerNamespace("WordEditor.PeoplesWellControl");Type.registerNamespace("WordEditor.Presence");Type.registerNamespace("AppRealtimeChannel");Type.registerNamespace("Common.App.CoauthTelemetry");ta.main();Type.registerNamespace("Common.App.CollabControls");Xa.prototype.toString=fa.a.prototype.toString;
kb.prototype.toString=fa.a.prototype.toString;Da.a.instance.Gc(new Bf);Mh.main();Type.registerNamespace("RealtimePresenceUI");Da.a.instance.Gc(new cd);Type.registerNamespace("Common.App.RtcHostNotificationSubscription");xa.main()}}]);

//# sourceMappingURL=https://res-dev.cdn.officeppe.net/1js/build/20308609/wdjs/WordEditorDSVersionHistoryRemoved.collab.js.map